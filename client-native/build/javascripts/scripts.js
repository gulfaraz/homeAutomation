!function(){angular.module("home",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(e,n){n.otherwise("/"),e.state("home",{url:"/",templateUrl:"home.html",controller:"HomeCtrl"})}]).controller("HomeCtrl",["$scope","$http","TerminalService","$state",function(e,n,t,o){e.fetchTerminals=function(){var n={userName:e.userName,password:e.password};t.fetchTerminals(n).then(function(n){n.data.terminals.length?(t.setTerminals(n.data.terminals),o.go("network")):e.message="No Terminals Available"},function(n){e.message=n.data.message})}}])}(),function(){angular.module("app",["home","manage","network","device"]).controller("AppCtrl",["$scope",function(e){e.title="Setup New Device"}]).factory("TerminalService",["$http",function(e){function n(e){c=e}function t(){return c}function o(n){return e({method:"POST",url:"http://localhost:8080/device/free",data:n})}function r(n,t){return e({method:"POST",url:"http://192.168.4.1/configure",data:{homeCredentials:n,deviceIdList:t}})}function i(){return e({method:"GET",url:"http://192.168.4.1/"})}function s(n){return e({method:"GET",url:"http://192.168.4.1/?i="+n})}var c=[];return{setTerminals:n,getTerminals:t,fetchTerminals:o,configureDevice:r,getDeviceConfiguration:i,testSwitch:s}}]).factory("NetworkService",[function(){function e(e,n,t){if(t||(t=function(){}),"Open"===e.security||n){var i={ssid:e.ssid,password:n};o.connectToAP(i,function(i,s){if(i)t(i);else{var c=o.getIfaceState();s.success&&c.ssid===e.ssid?(e.ssid.indexOf("newDevice-")===-1&&(r={ssid:e.ssid,password:n}),t(null,r)):t("failed")}})}else t("password")}function n(){return r}function t(e,n){o.scanForWiFi(function(t,o){if(t)n(t);else{var r=(o.networks,function(e){var n=[];for(var t in e){var o=!0,r=e[t];for(var i in n){var s=n[i];if(s.ssid===r.ssid){o=!1;break}}o&&n.push(r)}return n}(o.networks));n(null,r.filter(function(n){var t=0===n.ssid.indexOf("newDevice-");return e===t}))}})}var o=require("wifi-control");o.init();var r={ssid:null,password:null};return{find:t,connect:e,getCredentials:n}}])}(),function(){angular.module("device",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(e,n){n.otherwise("/"),e.state("device",{url:"/device",templateUrl:"device.html",controller:"DeviceCtrl"})}]).controller("DeviceCtrl",["$scope","NetworkService","$timeout","$state",function(e,n,t,o){e.scanMessage="Looking for devices...",e.scanDevices=function(){e.scanning=!0,n.find(!0,function(n,o){n&&(e.scanMessage=n,console.error(n)),t(function(){e.scanning=!1,e.devices=o,e.scanMessage="No Devices Found"})})},e.scanDevices(),e.connectDevice=function(r,i){e.connectMessage=null,n.connect(r,i,function(i,s){if(i){"password"===i?e.getPassword===r.ssid?e.connectMessage="Enter device password":e.getPassword=r.ssid:"failed"===i?e.connectMessage="Failed to connect to "+(r.ssid||"device"):(e.connectMessage="Unable to connect to device, verify password",console.error(i));var c=n.getCredentials();n.connect({ssid:c.ssid},c.password)}else t(function(){e.getPassword=null,e.connectMessage=null,o.go("manage")})})}}])}(),function(){angular.module("manage",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(e,n){n.otherwise("/"),e.state("manage",{url:"/manage",templateUrl:"manage.html",controller:"ManageCtrl"})}]).controller("ManageCtrl",["$scope","TerminalService","NetworkService","$timeout","$state",function(e,n,t,o,r){e.terminalList=n.getTerminals(),0===e.terminalList.length&&(alert("You do not have any terminals to configure"),r.go("home")),e.homeCredentials=t.getCredentials(),e.deviceIdList=[],e.switchList=[],n.getDeviceConfiguration().then(function(n){e.switchList.length=n.data.switchCount,e.deviceIdList=n.data.deviceIdList},function(n){e.message="Please check if you have connected to the correct device"}),e.getTerminalProperty=function(n,t){var o=t?t.split("/")[2]:null,r=null;if(o)for(var i in e.terminalList){var s=e.terminalList[i];if(s.terminalId===o){r=s[n];break}}return r},e.setupDevice=function(e,o){o=o.map(function(e,n){return e?e:"//"}),n.configureDevice(e,o).then(function(n){console.log("Configuration Success"),t.connect({ssid:e.ssid},e.password,function(e,n){r.go("home")})},function(e){console.log("Configuration Failed")})},e.toggleSwitch=function(e){n.testSwitch(e).then(function(e){console.log("Switch is turned "+(1===e.data.state?"on":"off"))},function(e){console.log("Unable to access switch")})}}])}(),function(){angular.module("network",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(e,n){n.otherwise("/"),e.state("network",{url:"/network",templateUrl:"network.html",controller:"NetworkCtrl"})}]).controller("NetworkCtrl",["$scope","NetworkService","$timeout","$state",function(e,n,t,o){e.scanMessage="Looking for networks...",e.credentials=n.getCredentials(),e.changeNetwork=function(){e.showNetworkList=!0,e.scanNetworks()},e.scanNetworks=function(){e.scanning=!0,n.find(!1,function(n,o){n&&(e.scanMessage=n,console.error(n)),t(function(){e.scanning=!1,e.networks=o,e.scanMessage="No Networks Found"})})},e.selectNetwork=function(r,i){e.connectMessage=null,n.connect(r,i,function(n,i){n?"password"===n?e.getPassword===r.ssid?e.connectMessage="Enter network password":e.getPassword=r.ssid:"failed"===n?e.connectMessage="Failed to connect to "+(r.ssid||"network"):(e.connectMessage="Unable to connect to network, verify password",console.error(n)):t(function(){e.getPassword=null,e.connectMessage=null,e.credentials=i,e.showNetworkList=!1,o.go("device")})})}}])}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhvbWUuanMiLCJpbmRleC5qcyIsImRldmljZS9kZXZpY2UuanMiLCJtYW5hZ2UvbWFuYWdlLmpzIiwibmV0d29yay9uZXR3b3JrLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCJzdGF0ZVByb3ZpZGVyIiwidXJsUm91dGVyUHJvdmlkZXIiLCJvdGhlcndpc2UiLCJzdGF0ZSIsInVybCIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsInNjb3BlIiwiaHR0cCIsInRlcm1pbmFsU2VydmljZSIsImZldGNoVGVybWluYWxzIiwiY3JlZGVudGlhbHMiLCJ1c2VyTmFtZSIsInBhc3N3b3JkIiwidGhlbiIsInJlc3BvbnNlIiwiZGF0YSIsInRlcm1pbmFscyIsImxlbmd0aCIsInNldFRlcm1pbmFscyIsImdvIiwibWVzc2FnZSIsInRpdGxlIiwiZmFjdG9yeSIsInRlcm1pbmFsc0xpc3QiLCJnZXRUZXJtaW5hbHMiLCJtZXRob2QiLCJjb25maWd1cmVEZXZpY2UiLCJob21lQ3JlZGVudGlhbHMiLCJkZXZpY2VJZExpc3QiLCJnZXREZXZpY2VDb25maWd1cmF0aW9uIiwidGVzdFN3aXRjaCIsImluZGV4IiwiY29ubmVjdCIsIm5ldHdvcmsiLCJjYWxsYmFjayIsInNlY3VyaXR5IiwibmV0d29ya0NyZWRlbnRpYWxzIiwic3NpZCIsIldpRmlDb250cm9sIiwiY29ubmVjdFRvQVAiLCJlcnJvciIsImludGVyZmFjZVN0YXRlIiwiZ2V0SWZhY2VTdGF0ZSIsInN1Y2Nlc3MiLCJpbmRleE9mIiwiZ2V0Q3JlZGVudGlhbHMiLCJmaW5kIiwiaXNEZXZpY2UiLCJzY2FuRm9yV2lGaSIsInVuaXF1ZU5ldHdvcmtzIiwibmV0d29ya3MiLCJuZXR3b3JrSW5kZXgiLCJpc1VuaXF1ZSIsInVuaXF1ZU5ldHdvcmtJbmRleCIsInVuaXF1ZU5ldHdvcmsiLCJwdXNoIiwiZmlsdGVyIiwiaXNEZXZpY2VOZXR3b3JrIiwicmVxdWlyZSIsImluaXQiLCJuZXR3b3JrU2VydmljZSIsInRpbWVvdXQiLCJzY2FuTWVzc2FnZSIsInNjYW5EZXZpY2VzIiwic2Nhbm5pbmciLCJkZXZpY2VzIiwiY29uc29sZSIsImNvbm5lY3REZXZpY2UiLCJjb25uZWN0TWVzc2FnZSIsImdldFBhc3N3b3JkIiwidGVybWluYWxMaXN0IiwiYWxlcnQiLCJzd2l0Y2hMaXN0Iiwic3dpdGNoQ291bnQiLCJnZXRUZXJtaW5hbFByb3BlcnR5IiwicHJvcGVydHkiLCJkZXZpY2VJZCIsInRlcm1pbmFsSWQiLCJzcGxpdCIsInByb3BlcnR5VmFsdWUiLCJ0ZXJtaW5hbEluZGV4IiwidGVybWluYWwiLCJzZXR1cERldmljZSIsIm1hcCIsImRldmljZUlkSW5kZXgiLCJsb2ciLCJ0b2dnbGVTd2l0Y2giLCJjaGFuZ2VOZXR3b3JrIiwic2hvd05ldHdvcmtMaXN0Iiwic2Nhbk5ldHdvcmtzIiwic2VsZWN0TmV0d29yayJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDQUEsUUFBQUMsT0FBQSxRQUFBLGNBQ0FDLFFBQUEsaUJBQUEscUJBQUEsU0FBQUMsRUFBQUMsR0FDQUEsRUFBQUMsVUFBQSxLQUNBRixFQUNBRyxNQUFBLFFBQ0FDLElBQUEsSUFDQUMsWUFBQSxZQUNBQyxXQUFBLGdCQUdBQSxXQUFBLFlBQUEsU0FBQSxRQUFBLGtCQUFBLFNBQUEsU0FBQUMsRUFBQUMsRUFBQUMsRUFBQU4sR0FDQUksRUFBQUcsZUFBQSxXQUNBLEdBQUFDLElBQ0FDLFNBQUFMLEVBQUFLLFNBQ0FDLFNBQUFOLEVBQUFNLFNBRUFKLEdBQUFDLGVBQUFDLEdBQUFHLEtBQUEsU0FBQUMsR0FDQUEsRUFBQUMsS0FBQUMsVUFBQUMsUUFDQVQsRUFBQVUsYUFBQUosRUFBQUMsS0FBQUMsV0FDQWQsRUFBQWlCLEdBQUEsWUFFQWIsRUFBQWMsUUFBQSwwQkFFQSxTQUFBTixHQUNBUixFQUFBYyxRQUFBTixFQUFBQyxLQUFBSyxpQkN6QkEsV0FDQXhCLFFBQUFDLE9BQUEsT0FBQSxPQUFBLFNBQUEsVUFBQSxXQUNBUSxXQUFB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d0QsWUFBQSwwQkFFQXhELEVBQUFJLFlBQUFrRCxFQUFBZixpQkFFQXZDLEVBQUFpRixjQUFBLFdBQ0FqRixFQUFBa0YsaUJBQUEsRUFDQWxGLEVBQUFtRixnQkFHQW5GLEVBQUFtRixhQUFBLFdBQ0FuRixFQUFBMEQsVUFBQSxFQUNBSixFQUFBZCxNQUFBLEVBQUEsU0FBQU4sRUFBQVUsR0FDQVYsSUFDQWxDLEVBQUF3RCxZQUFBdEIsRUFDQTBCLFFBQUExQixNQUFBQSxJQUVBcUIsRUFBQSxXQUNBdkQsRUFBQTBELFVBQUEsRUFDQTFELEVBQUE0QyxTQUFBQSxFQUNBNUMsRUFBQXdELFlBQUEseUJBS0F4RCxFQUFBb0YsY0FBQSxTQUFBekQsRUFBQXJCLEdBQ0FOLEVBQUE4RCxlQUFBLEtBQ0FSLEVBQUE1QixRQUFBQyxFQUFBckIsRUFBQSxTQUFBNEIsRUFBQTlCLEdBQ0E4QixFQUNBLGFBQUFBLEVBQ0FsQyxFQUFBK0QsY0FBQXBDLEVBQUFJLEtBQ0EvQixFQUFBOEQsZUFBQSx5QkFFQTlELEVBQUErRCxZQUFBcEMsRUFBQUksS0FFQSxXQUFBRyxFQUNBbEMsRUFBQThELGVBQUEseUJBQUFuQyxFQUFBSSxNQUFBLFlBRUEvQixFQUFBOEQsZUFBQSxnREFDQUYsUUFBQTFCLE1BQUFBLElBR0FxQixFQUFBLFdBQ0F2RCxFQUFBK0QsWUFBQSxLQUNBL0QsRUFBQThELGVBQUEsS0FDQTlELEVBQUFJLFlBQUFBLEVBQ0FKLEVBQUFrRixpQkFBQSxFQUNBdEYsRUFBQWlCLEdBQUEiLCJmaWxlIjoic2NyaXB0cy5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJob21lXCIsIFsgXCJ1aS5yb3V0ZXJcIiBdKVxuICAgICAgICAuY29uZmlnKFtcIiRzdGF0ZVByb3ZpZGVyXCIsIFwiJHVybFJvdXRlclByb3ZpZGVyXCIsIGZ1bmN0aW9uIChzdGF0ZVByb3ZpZGVyLCB1cmxSb3V0ZXJQcm92aWRlcikge1xuICAgICAgICAgICAgdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKFwiL1wiKTtcbiAgICAgICAgICAgIHN0YXRlUHJvdmlkZXJcbiAgICAgICAgICAgICAgICAuc3RhdGUoXCJob21lXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcIi9cIixcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiaG9tZS5odG1sXCIsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiSG9tZUN0cmxcIlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XSlcbiAgICAgICAgLmNvbnRyb2xsZXIoXCJIb21lQ3RybFwiLCBbIFwiJHNjb3BlXCIsIFwiJGh0dHBcIiwgXCJUZXJtaW5hbFNlcnZpY2VcIiwgXCIkc3RhdGVcIiwgZnVuY3Rpb24gKHNjb3BlLCBodHRwLCB0ZXJtaW5hbFNlcnZpY2UsIHN0YXRlKSB7XG4gICAgICAgICAgICBzY29wZS5mZXRjaFRlcm1pbmFscyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgY3JlZGVudGlhbHMgPSB7XG4gICAgICAgICAgICAgICAgICAgIFwidXNlck5hbWVcIjogc2NvcGUudXNlck5hbWUsXG4gICAgICAgICAgICAgICAgICAgIFwicGFzc3dvcmRcIjogc2NvcGUucGFzc3dvcmRcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHRlcm1pbmFsU2VydmljZS5mZXRjaFRlcm1pbmFscyhjcmVkZW50aWFscykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYocmVzcG9uc2UuZGF0YS50ZXJtaW5hbHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXJtaW5hbFNlcnZpY2Uuc2V0VGVybWluYWxzKHJlc3BvbnNlLmRhdGEudGVybWluYWxzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmdvKFwibmV0d29ya1wiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm1lc3NhZ2UgPSBcIk5vIFRlcm1pbmFscyBBdmFpbGFibGVcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5tZXNzYWdlID0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIiwgWyBcImhvbWVcIiwgXCJtYW5hZ2VcIiwgXCJuZXR3b3JrXCIsIFwiZGV2aWNlXCIgXSlcbiAgICAgICAgLmNvbnRyb2xsZXIoXCJBcHBDdHJsXCIsIFsgXCIkc2NvcGVcIiwgZnVuY3Rpb24gKHNjb3BlKSB7XG4gICAgICAgICAgICBzY29wZS50aXRsZSA9IFwiU2V0dXAgTmV3IERldmljZVwiO1xuICAgICAgICB9XSlcbiAgICAgICAgLmZhY3RvcnkoXCJUZXJtaW5hbFNlcnZpY2VcIiwgWyBcIiRodHRwXCIsIGZ1bmN0aW9uIChodHRwKSB7XG5cbiAgICAgICAgICAgIHZhciB0ZXJtaW5hbHMgPSBbXTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gc2V0VGVybWluYWxzKHRlcm1pbmFsc0xpc3QpIHtcbiAgICAgICAgICAgICAgICB0ZXJtaW5hbHMgPSB0ZXJtaW5hbHNMaXN0O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRUZXJtaW5hbHMoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRlcm1pbmFscztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZmV0Y2hUZXJtaW5hbHMoY3JlZGVudGlhbHMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICAgICAgICAgIHVybDogXCJodHRwOi8vbG9jYWxob3N0OjgwODAvZGV2aWNlL2ZyZWVcIixcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogY3JlZGVudGlhbHNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gY29uZmlndXJlRGV2aWNlKGhvbWVDcmVkZW50aWFscywgZGV2aWNlSWRMaXN0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiaHR0cDovLzE5Mi4xNjguNC4xL2NvbmZpZ3VyZVwiLFxuICAgICAgICAgICAgICAgICAgICBkYXRhIDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJob21lQ3JlZGVudGlhbHNcIiA6IGhvbWVDcmVkZW50aWFscyxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZGV2aWNlSWRMaXN0XCIgOiBkZXZpY2VJZExpc3RcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXREZXZpY2VDb25maWd1cmF0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiaHR0cDovLzE5Mi4xNjguNC4xL1wiXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHRlc3RTd2l0Y2goaW5kZXgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcImh0dHA6Ly8xOTIuMTY4LjQuMS8/aT1cIiArIGluZGV4XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc2V0VGVybWluYWxzOiBzZXRUZXJtaW5hbHMsXG4gICAgICAgICAgICAgICAgZ2V0VGVybWluYWxzOiBnZXRUZXJtaW5hbHMsXG4gICAgICAgICAgICAgICAgZmV0Y2hUZXJtaW5hbHM6IGZldGNoVGVybWluYWxzLFxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyZURldmljZTogY29uZmlndXJlRGV2aWNlLFxuICAgICAgICAgICAgICAgIGdldERldmljZUNvbmZpZ3VyYXRpb246IGdldERldmljZUNvbmZpZ3VyYXRpb24sXG4gICAgICAgICAgICAgICAgdGVzdFN3aXRjaDogdGVzdFN3aXRjaFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pXG4gICAgICAgIC5mYWN0b3J5KFwiTmV0d29ya1NlcnZpY2VcIiwgWyBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIHZhciBXaUZpQ29udHJvbCA9IHJlcXVpcmUoXCJ3aWZpLWNvbnRyb2xcIik7XG5cbiAgICAgICAgICAgIFdpRmlDb250cm9sLmluaXQoKTtcblxuICAgICAgICAgICAgdmFyIGhvbWVDcmVkZW50aWFscyA9IHtcbiAgICAgICAgICAgICAgICBcInNzaWRcIiA6IG51bGwsXG4gICAgICAgICAgICAgICAgXCJwYXNzd29yZFwiIDogbnVsbFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gY29ubmVjdChuZXR3b3JrLCBwYXNzd29yZCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBpZighY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7fTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYobmV0d29yay5zZWN1cml0eSA9PT0gXCJPcGVuXCIgfHwgcGFzc3dvcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ldHdvcmtDcmVkZW50aWFscyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwic3NpZFwiIDogbmV0d29yay5zc2lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJwYXNzd29yZFwiIDogcGFzc3dvcmRcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgV2lGaUNvbnRyb2wuY29ubmVjdFRvQVAobmV0d29ya0NyZWRlbnRpYWxzLCBmdW5jdGlvbiAoZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGludGVyZmFjZVN0YXRlID0gV2lGaUNvbnRyb2wuZ2V0SWZhY2VTdGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlLnN1Y2Nlc3MgJiYgKGludGVyZmFjZVN0YXRlLnNzaWQgPT09IG5ldHdvcmsuc3NpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYobmV0d29yay5zc2lkLmluZGV4T2YoXCJuZXdEZXZpY2UtXCIpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG9tZUNyZWRlbnRpYWxzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3NpZFwiIDogbmV0d29yay5zc2lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicGFzc3dvcmRcIiA6IHBhc3N3b3JkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGhvbWVDcmVkZW50aWFscyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soXCJmYWlsZWRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhcInBhc3N3b3JkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0Q3JlZGVudGlhbHMoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhvbWVDcmVkZW50aWFscztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZmluZChpc0RldmljZSwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBXaUZpQ29udHJvbC5zY2FuRm9yV2lGaShmdW5jdGlvbiAoZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWxsTmV0d29ya3MgPSByZXNwb25zZS5uZXR3b3JrcztcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1bmlxdWVOZXR3b3JrcyA9IChmdW5jdGlvbiAobmV0d29ya3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdW5pcXVlTmV0d29ya3MgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIG5ldHdvcmtJbmRleCBpbiBuZXR3b3Jrcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXNVbmlxdWUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV0d29yayA9IG5ldHdvcmtzW25ldHdvcmtJbmRleF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgdW5pcXVlTmV0d29ya0luZGV4IGluIHVuaXF1ZU5ldHdvcmtzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdW5pcXVlTmV0d29yayA9IHVuaXF1ZU5ldHdvcmtzW3VuaXF1ZU5ldHdvcmtJbmRleF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih1bmlxdWVOZXR3b3JrLnNzaWQgPT09IG5ldHdvcmsuc3NpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzVW5pcXVlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXNVbmlxdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXF1ZU5ldHdvcmtzLnB1c2gobmV0d29yayk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVuaXF1ZU5ldHdvcmtzO1xuICAgICAgICAgICAgICAgICAgICAgICAgfShyZXNwb25zZS5uZXR3b3JrcykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlTmV0d29ya3MuZmlsdGVyKGZ1bmN0aW9uIChuZXR3b3JrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlzRGV2aWNlTmV0d29yayA9IChuZXR3b3JrLnNzaWQuaW5kZXhPZihcIm5ld0RldmljZS1cIikgPT09IDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoaXNEZXZpY2UgPT09IGlzRGV2aWNlTmV0d29yayk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBcImZpbmRcIiA6IGZpbmQsXG4gICAgICAgICAgICAgICAgXCJjb25uZWN0XCIgOiBjb25uZWN0LFxuICAgICAgICAgICAgICAgIFwiZ2V0Q3JlZGVudGlhbHNcIiA6IGdldENyZWRlbnRpYWxzXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICBhbmd1bGFyLm1vZHVsZShcImRldmljZVwiLCBbIFwidWkucm91dGVyXCIgXSlcbiAgICAgICAgLmNvbmZpZyhbXCIkc3RhdGVQcm92aWRlclwiLCBcIiR1cmxSb3V0ZXJQcm92aWRlclwiLCBmdW5jdGlvbiAoc3RhdGVQcm92aWRlciwgdXJsUm91dGVyUHJvdmlkZXIpIHtcbiAgICAgICAgICAgIHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZShcIi9cIik7XG4gICAgICAgICAgICBzdGF0ZVByb3ZpZGVyXG4gICAgICAgICAgICAgICAgLnN0YXRlKFwiZGV2aWNlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcIi9kZXZpY2VcIixcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiZGV2aWNlLmh0bWxcIixcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogXCJEZXZpY2VDdHJsXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfV0pXG4gICAgICAgIC5jb250cm9sbGVyKFwiRGV2aWNlQ3RybFwiLCBbIFwiJHNjb3BlXCIsIFwiTmV0d29ya1NlcnZpY2VcIiwgXCIkdGltZW91dFwiLCBcIiRzdGF0ZVwiLCBmdW5jdGlvbiAoc2NvcGUsIG5ldHdvcmtTZXJ2aWNlLCB0aW1lb3V0LCBzdGF0ZSkge1xuXG4gICAgICAgICAgICBzY29wZS5zY2FuTWVzc2FnZSA9IFwiTG9va2luZyBmb3IgZGV2aWNlcy4uLlwiO1xuXG4gICAgICAgICAgICBzY29wZS5zY2FuRGV2aWNlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBzY29wZS5zY2FubmluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgbmV0d29ya1NlcnZpY2UuZmluZCh0cnVlLCBmdW5jdGlvbiAoZXJyb3IsIGRldmljZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnNjYW5NZXNzYWdlID0gZXJyb3I7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnNjYW5uaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5kZXZpY2VzID0gZGV2aWNlcztcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnNjYW5NZXNzYWdlID0gXCJObyBEZXZpY2VzIEZvdW5kXCI7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2NvcGUuc2NhbkRldmljZXMoKTtcblxuICAgICAgICAgICAgc2NvcGUuY29ubmVjdERldmljZSA9IGZ1bmN0aW9uIChuZXR3b3JrLCBwYXNzd29yZCkge1xuICAgICAgICAgICAgICAgIHNjb3BlLmNvbm5lY3RNZXNzYWdlID0gbnVsbDtcbiAgICAgICAgICAgICAgICBuZXR3b3JrU2VydmljZS5jb25uZWN0KG5ldHdvcmssIHBhc3N3b3JkLCBmdW5jdGlvbiAoZXJyb3IsIGNyZWRlbnRpYWxzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihlcnJvciA9PT0gXCJwYXNzd29yZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoc2NvcGUuZ2V0UGFzc3dvcmQgPT09IG5ldHdvcmsuc3NpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jb25uZWN0TWVzc2FnZSA9IFwiRW50ZXIgZGV2aWNlIHBhc3N3b3JkXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZ2V0UGFzc3dvcmQgPSBuZXR3b3JrLnNzaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvciA9PT0gXCJmYWlsZWRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNvbm5lY3RNZXNzYWdlID0gXCJGYWlsZWQgdG8gY29ubmVjdCB0byBcIiArIChuZXR3b3JrLnNzaWQgfHwgXCJkZXZpY2VcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNvbm5lY3RNZXNzYWdlID0gXCJVbmFibGUgdG8gY29ubmVjdCB0byBkZXZpY2UsIHZlcmlmeSBwYXNzd29yZFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhvbWVDcmVkZW50aWFscyA9IG5ldHdvcmtTZXJ2aWNlLmdldENyZWRlbnRpYWxzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXR3b3JrU2VydmljZS5jb25uZWN0KHsgc3NpZDogaG9tZUNyZWRlbnRpYWxzLnNzaWQgfSwgaG9tZUNyZWRlbnRpYWxzLnBhc3N3b3JkKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmdldFBhc3N3b3JkID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jb25uZWN0TWVzc2FnZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuZ28oXCJtYW5hZ2VcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJtYW5hZ2VcIiwgWyBcInVpLnJvdXRlclwiIF0pXG4gICAgICAgIC5jb25maWcoW1wiJHN0YXRlUHJvdmlkZXJcIiwgXCIkdXJsUm91dGVyUHJvdmlkZXJcIiwgZnVuY3Rpb24gKHN0YXRlUHJvdmlkZXIsIHVybFJvdXRlclByb3ZpZGVyKSB7XG4gICAgICAgICAgICB1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoXCIvXCIpO1xuICAgICAgICAgICAgc3RhdGVQcm92aWRlclxuICAgICAgICAgICAgICAgIC5zdGF0ZShcIm1hbmFnZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogXCIvbWFuYWdlXCIsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIm1hbmFnZS5odG1sXCIsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiTWFuYWdlQ3RybFwiXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1dKVxuICAgICAgICAuY29udHJvbGxlcihcIk1hbmFnZUN0cmxcIiwgWyBcIiRzY29wZVwiLCBcIlRlcm1pbmFsU2VydmljZVwiLCBcIk5ldHdvcmtTZXJ2aWNlXCIsIFwiJHRpbWVvdXRcIiwgXCIkc3RhdGVcIiwgZnVuY3Rpb24gKHNjb3BlLCB0ZXJtaW5hbFNlcnZpY2UsIG5ldHdvcmtTZXJ2aWNlLCB0aW1lb3V0LCBzdGF0ZSkge1xuXG4gICAgICAgICAgICBzY29wZS50ZXJtaW5hbExpc3QgPSB0ZXJtaW5hbFNlcnZpY2UuZ2V0VGVybWluYWxzKCk7XG4gICAgICAgICAgICBpZihzY29wZS50ZXJtaW5hbExpc3QubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgYWxlcnQoXCJZb3UgZG8gbm90IGhhdmUgYW55IHRlcm1pbmFscyB0byBjb25maWd1cmVcIik7XG4gICAgICAgICAgICAgICAgc3RhdGUuZ28oXCJob21lXCIpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBzY29wZS5ob21lQ3JlZGVudGlhbHMgPSBuZXR3b3JrU2VydmljZS5nZXRDcmVkZW50aWFscygpO1xuXG4gICAgICAgICAgICBzY29wZS5kZXZpY2VJZExpc3QgPSBbXTtcblxuICAgICAgICAgICAgc2NvcGUuc3dpdGNoTGlzdCA9IFtdO1xuXG4gICAgICAgICAgICB0ZXJtaW5hbFNlcnZpY2UuZ2V0RGV2aWNlQ29uZmlndXJhdGlvbigpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUuc3dpdGNoTGlzdC5sZW5ndGggPSByZXNwb25zZS5kYXRhLnN3aXRjaENvdW50O1xuICAgICAgICAgICAgICAgIHNjb3BlLmRldmljZUlkTGlzdCA9IHJlc3BvbnNlLmRhdGEuZGV2aWNlSWRMaXN0O1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUubWVzc2FnZSA9IFwiUGxlYXNlIGNoZWNrIGlmIHlvdSBoYXZlIGNvbm5lY3RlZCB0byB0aGUgY29ycmVjdCBkZXZpY2VcIjtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzY29wZS5nZXRUZXJtaW5hbFByb3BlcnR5ID0gZnVuY3Rpb24gKHByb3BlcnR5LCBkZXZpY2VJZCkge1xuICAgICAgICAgICAgICAgIHZhciB0ZXJtaW5hbElkID0gKGRldmljZUlkKSA/IGRldmljZUlkLnNwbGl0KFwiL1wiKVsyXSA6IG51bGw7XG4gICAgICAgICAgICAgICAgdmFyIHByb3BlcnR5VmFsdWUgPSBudWxsO1xuICAgICAgICAgICAgICAgIGlmKHRlcm1pbmFsSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yKHZhciB0ZXJtaW5hbEluZGV4IGluIHNjb3BlLnRlcm1pbmFsTGlzdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRlcm1pbmFsID0gc2NvcGUudGVybWluYWxMaXN0W3Rlcm1pbmFsSW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYodGVybWluYWwudGVybWluYWxJZCA9PT0gdGVybWluYWxJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5VmFsdWUgPSB0ZXJtaW5hbFtwcm9wZXJ0eV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb3BlcnR5VmFsdWU7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5zZXR1cERldmljZSA9IGZ1bmN0aW9uIChob21lQ3JlZGVudGlhbHMsIGRldmljZUlkTGlzdCkge1xuICAgICAgICAgICAgICAgIGRldmljZUlkTGlzdCA9IGRldmljZUlkTGlzdC5tYXAoZnVuY3Rpb24gKGRldmljZUlkLCBkZXZpY2VJZEluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoZGV2aWNlSWQgPyBkZXZpY2VJZCA6IFwiLy9cIik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGVybWluYWxTZXJ2aWNlLmNvbmZpZ3VyZURldmljZShob21lQ3JlZGVudGlhbHMsIGRldmljZUlkTGlzdCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJDb25maWd1cmF0aW9uIFN1Y2Nlc3NcIik7XG4gICAgICAgICAgICAgICAgICAgIG5ldHdvcmtTZXJ2aWNlLmNvbm5lY3QoeyBzc2lkOiBob21lQ3JlZGVudGlhbHMuc3NpZCB9LCBob21lQ3JlZGVudGlhbHMucGFzc3dvcmQsIGZ1bmN0aW9uIChlcnJvciwgY3JlZGVudGlhbHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmdvKFwiaG9tZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ29uZmlndXJhdGlvbiBGYWlsZWRcIik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS50b2dnbGVTd2l0Y2ggPSBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgICAgICAgICB0ZXJtaW5hbFNlcnZpY2UudGVzdFN3aXRjaChpbmRleCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJTd2l0Y2ggaXMgdHVybmVkIFwiICsgKChyZXNwb25zZS5kYXRhLnN0YXRlID09PSAxKSA/IFwib25cIiA6IFwib2ZmXCIpKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJVbmFibGUgdG8gYWNjZXNzIHN3aXRjaFwiKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwibmV0d29ya1wiLCBbIFwidWkucm91dGVyXCIgXSlcbiAgICAgICAgLmNvbmZpZyhbXCIkc3RhdGVQcm92aWRlclwiLCBcIiR1cmxSb3V0ZXJQcm92aWRlclwiLCBmdW5jdGlvbiAoc3RhdGVQcm92aWRlciwgdXJsUm91dGVyUHJvdmlkZXIpIHtcbiAgICAgICAgICAgIHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZShcIi9cIik7XG4gICAgICAgICAgICBzdGF0ZVByb3ZpZGVyXG4gICAgICAgICAgICAgICAgLnN0YXRlKFwibmV0d29ya1wiLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogXCIvbmV0d29ya1wiLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJuZXR3b3JrLmh0bWxcIixcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogXCJOZXR3b3JrQ3RybFwiXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1dKVxuICAgICAgICAuY29udHJvbGxlcihcIk5ldHdvcmtDdHJsXCIsIFsgXCIkc2NvcGVcIiwgXCJOZXR3b3JrU2VydmljZVwiLCBcIiR0aW1lb3V0XCIsIFwiJHN0YXRlXCIsIGZ1bmN0aW9uIChzY29wZSwgbmV0d29ya1NlcnZpY2UsIHRpbWVvdXQsIHN0YXRlKSB7XG5cbiAgICAgICAgICAgIHNjb3BlLnNjYW5NZXNzYWdlID0gXCJMb29raW5nIGZvciBuZXR3b3Jrcy4uLlwiO1xuXG4gICAgICAgICAgICBzY29wZS5jcmVkZW50aWFscyA9IG5ldHdvcmtTZXJ2aWNlLmdldENyZWRlbnRpYWxzKCk7XG5cbiAgICAgICAgICAgIHNjb3BlLmNoYW5nZU5ldHdvcmsgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUuc2hvd05ldHdvcmtMaXN0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBzY29wZS5zY2FuTmV0d29ya3MoKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNjb3BlLnNjYW5OZXR3b3JrcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBzY29wZS5zY2FubmluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgbmV0d29ya1NlcnZpY2UuZmluZChmYWxzZSwgZnVuY3Rpb24gKGVycm9yLCBuZXR3b3Jrcykge1xuICAgICAgICAgICAgICAgICAgICBpZihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2Nhbk1lc3NhZ2UgPSBlcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2Nhbm5pbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5ldHdvcmtzID0gbmV0d29ya3M7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5zY2FuTWVzc2FnZSA9IFwiTm8gTmV0d29ya3MgRm91bmRcIjtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5zZWxlY3ROZXR3b3JrID0gZnVuY3Rpb24gKG5ldHdvcmssIHBhc3N3b3JkKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUuY29ubmVjdE1lc3NhZ2UgPSBudWxsO1xuICAgICAgICAgICAgICAgIG5ldHdvcmtTZXJ2aWNlLmNvbm5lY3QobmV0d29yaywgcGFzc3dvcmQsIGZ1bmN0aW9uIChlcnJvciwgY3JlZGVudGlhbHMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGVycm9yID09PSBcInBhc3N3b3JkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihzY29wZS5nZXRQYXNzd29yZCA9PT0gbmV0d29yay5zc2lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNvbm5lY3RNZXNzYWdlID0gXCJFbnRlciBuZXR3b3JrIHBhc3N3b3JkXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZ2V0UGFzc3dvcmQgPSBuZXR3b3JrLnNzaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvciA9PT0gXCJmYWlsZWRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNvbm5lY3RNZXNzYWdlID0gXCJGYWlsZWQgdG8gY29ubmVjdCB0byBcIiArIChuZXR3b3JrLnNzaWQgfHwgXCJuZXR3b3JrXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jb25uZWN0TWVzc2FnZSA9IFwiVW5hYmxlIHRvIGNvbm5lY3QgdG8gbmV0d29yaywgdmVyaWZ5IHBhc3N3b3JkXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5nZXRQYXNzd29yZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY29ubmVjdE1lc3NhZ2UgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNyZWRlbnRpYWxzID0gY3JlZGVudGlhbHM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2hvd05ldHdvcmtMaXN0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuZ28oXCJkZXZpY2VcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pO1xufSkoKTtcbiJdfQ==
