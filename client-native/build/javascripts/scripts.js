!function(){angular.module("home",["common"]).config(["$stateProvider","$urlRouterProvider",function(e,n){n.otherwise("/"),e.state("home",{url:"/",templateUrl:"home.html",controller:"HomeCtrl"})}]).controller("HomeCtrl",["$scope","$http","TerminalService","$state",function(e,n,t,o){var r=document.querySelector("#dialog");e.fetchTerminals=function(){var n={userName:e.userName,password:e.password};t.fetchTerminals(n).then(function(n){n.data.terminals.length?(t.setTerminals(n.data.terminals),o.go("network")):(e.message="No Terminals Available",r.showModal())},function(n){e.message=n.data.message,r.showModal()})},e.closeDialog=function(){r.close(),e.message=""}}])}(),function(){angular.module("common",["ui.router"]).constant("resolve",{terminals:["$q","TerminalService",function(e,n){var t=e.defer();return n.getTerminals().length>0?t.resolve():t.reject({go:"home"}),t.promise}],network:["$q","NetworkService",function(e,n){var t=e.defer(),o=n.getCredentials();return o.ssid&&o.ssid.length>0?t.resolve():t.reject({go:"network"}),t.promise}],device:["$q","TerminalService","$timeout",function(e,n,t){var o=e.defer();return e.race([n.getDeviceConfiguration(),new Promise(function(e,n){setTimeout(n,3e3)})]).then(function(e){o.resolve()},function(e){o.reject({go:"device"})}),o.promise}]})}(),function(){angular.module("app",["home","manage","network","device"]).controller("AppCtrl",["$scope","TerminalService","$state","$rootScope","$timeout",function(e,n,t,o,r){var i=function(e){var n=document.querySelectorAll(".mdl-layout__tab");angular.forEach(n,function(n,t){n=angular.element(n),n.removeClass("is-active"),n.hasClass(e+"-tab")&&n.addClass("is-active")})};e.goTo=function(e){t.go(e,{},{reload:!0})},o.$on("$stateChangeStart",function(n,t,o,i,s){r(function(){e.loading=!0})}),o.$on("$stateChangeSuccess",function(n,t,o,s,c){r(function(){i(s.name),e.currentState=t,componentHandler.upgradeAllRegistered(),e.loading=!1})}),o.$on("$stateChangeError",function(n,t,o,r,i,s){s.go&&(e.goTo(s.go),e.loading=!1)})}]).factory("TerminalService",["$http",function(e){function n(e){c=e}function t(){return c}function o(n){return e({method:"POST",url:"http://localhost:8080/device/terminals",data:n})}function r(n,t){return e({method:"POST",url:"http://192.168.4.1/configure",data:{homeCredentials:n,deviceIdList:t}})}function i(){return e({method:"GET",url:"http://192.168.4.1/"})}function s(n){return e({method:"GET",url:"http://192.168.4.1/?i="+n})}var c=[];return{setTerminals:n,getTerminals:t,fetchTerminals:o,configureDevice:r,getDeviceConfiguration:i,testSwitch:s}}]).factory("NetworkService",[function(){function e(e,n,t){if(t||(t=function(){}),"NONE"===e.security||n){var i={ssid:e.ssid,password:n};o.connectToAP(i,function(i,s){if(i)t(i);else{var c=o.getIfaceState();s.success&&c.ssid===e.ssid?(e.ssid.indexOf("newDevice-")===-1&&(r={ssid:e.ssid,password:n}),t(null,r)):t("failed")}})}else t("password")}function n(){return r}function t(e,n){o.scanForWiFi(function(t,o){if(t)n(t);else{var r=(o.networks,function(e){var n=[];for(var t in e){var o=!0,r=e[t];for(var i in n){var s=n[i];if(s.ssid===r.ssid){o=!1;break}}o&&n.push(r)}return n}(o.networks));n(null,r.filter(function(n){var t=0===n.ssid.indexOf("newDevice-");return e===t}))}})}var o=require("wifi-control");o.init();var r={ssid:null,password:null};return{find:t,connect:e,getCredentials:n}}]).directive("timeSince",["$timeout",function(e){return{restrict:"A",link:function(n,t,o,r){function i(n){e.cancel(c),c=e(function(){t.html(s(new Date(o.timeSince)))},n)}function s(e){var n=Math.floor((new Date-e)/1e3),t=Math.floor(n/31536e3),o="";return t>=1?(i(7776e6-50),o=t+" year"+(t>1?"s":"")+" ago"):(t=Math.floor(n/2592e3),t>=1?(i(1296e6-50),o=t+" month"+(t>1?"s":"")+" ago"):(t=Math.floor(n/86400),t>=1?(i(86399950),o=t+" day"+(t>1?"s":"")+" ago"):(t=Math.floor(n/3600),t>=1?(i(3599950),o=t+" hour"+(t>1?"s":"")+" ago"):(t=Math.floor(n/60),t>=1?(i(59950),o=t+" minute"+(t>1?"s":"")+" ago"):(i(950),o=Math.floor(n)+" seconds ago"))))),o}var c;i(0)}}}])}(),function(){angular.module("device",["common"]).config(["$stateProvider","$urlRouterProvider","resolve",function(e,n,t){n.otherwise("/"),e.state("device",{url:"/device",templateUrl:"device.html",controller:"DeviceCtrl",resolve:{terminals:t.terminals,network:t.network}})}]).controller("DeviceCtrl",["$scope","NetworkService","$timeout","$state",function(e,n,t,o){e.scanMessage="Scanning...",e.scanDevices=function(){e.timeoutInstance&&t.cancel(e.timeoutInstance),e.scanMessage="Scanning...",e.scanning=!0,n.find(!0,function(n,o){n&&(e.scanMessage=n,console.error(n)),t(function(){e.scanning=!1,e.devices=o,e.devices.length>0?e.scanMessage=e.devices.length+" Device"+(o.length>1?"s":"")+" Found":e.scanMessage="No Devices Found"})}),e.timeoutInstance=t(function(){e.scanDevices()},3e3)},e.scanDevices(),e.connectDevice=function(r){e.selectedDevice=r,e.connectMessage=null,n.connect(r,"setupnewdevice",function(i,s){if(i){"failed"===i?e.connectMessage="Failed to connect to "+(r.ssid||"device"):(e.connectMessage="Unable to connect to device, hold the reset button and try again",console.error(i));var c=n.getCredentials();n.connect({ssid:c.ssid},c.password)}else t(function(){e.connectMessage=null,o.go("manage")})})}}])}(),function(){angular.module("manage",["common"]).config(["$stateProvider","$urlRouterProvider","resolve",function(e,n,t){n.otherwise("/"),e.state("manage",{url:"/manage",templateUrl:"manage.html",controller:"ManageCtrl",resolve:t})}]).controller("ManageCtrl",["$scope","TerminalService","NetworkService","$timeout","$state",function(e,n,t,o,r){e.terminalList=n.getTerminals(),e.homeCredentials=t.getCredentials(),e.deviceIdList=[],e.switchList=[],n.getDeviceConfiguration().then(function(n){e.switchList.length=n.data.switchCount,e.deviceIdList=n.data.deviceIdList},function(e){r.go("device")}),e.getTerminalProperty=function(n,t){var o=t?t.split("/")[2]:null,r=null;if(o)for(var i in e.terminalList){var s=e.terminalList[i];if(s.terminalId===o){r=s[n];break}}return r},e.setupDevice=function(e,o){o=o.map(function(e,n){return e?e:"//"}),n.configureDevice(e,o).then(function(n){console.log("Configuration Success"),t.connect({ssid:e.ssid},e.password,function(e,n){r.go("home")})},function(e){console.log("Configuration Failed")})},e.toggleSwitch=function(e){n.testSwitch(e).then(function(e){console.log("Switch is turned "+(1===e.data.state?"on":"off"))},function(e){console.log("Unable to access switch")})}}])}(),function(){angular.module("network",["common"]).config(["$stateProvider","$urlRouterProvider","resolve",function(e,n,t){n.otherwise("/"),e.state("network",{url:"/network",templateUrl:"network.html",controller:"NetworkCtrl",resolve:{terminals:t.terminals}})}]).controller("NetworkCtrl",["$scope","NetworkService","$timeout","$state",function(e,n,t,o){e.scanMessage="Scanning...",e.credentials=n.getCredentials();var r=document.querySelector("#networkPasswordDialog");e.changeNetwork=function(){e.scanNetworks()},e.scanNetworks=function(){e.timeoutInstance&&t.cancel(e.timeoutInstance),e.scanMessage="Scanning...",e.scanning=!0,n.find(!1,function(n,o){n&&(e.scanMessage=n,console.error(n)),t(function(){e.scanning=!1,e.networks=o,e.networks.length>0?e.scanMessage=e.networks.length+" Network"+(e.networks.length>1?"s":"")+" Found":e.scanMessage="No Networks Found"})}),e.timeoutInstance=t(function(){e.scanNetworks()},3e3)},e.scanNetworks(),e.selectNetwork=function(i,s){e.selectedNetwork=i,e.connectMessage=null,n.connect(i,s,function(n,s){n?"password"===n?r.showModal():"failed"===n?e.connectMessage="Failed to connect to "+(i.ssid||"network"):(e.connectMessage="Unable to connect to network, verify password",console.error(n)):t(function(){e.connectMessage=null,e.credentials=s,o.go("device")})})},e.closeNetworkPasswordDialog=function(){e.password="",e.connectMessage=null,r.close()}}])}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhvbWUuanMiLCJjb21tb24uanMiLCJpbmRleC5qcyIsImRldmljZS9kZXZpY2UuanMiLCJtYW5hZ2UvbWFuYWdlLmpzIiwibmV0d29yay9uZXR3b3JrLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCJzdGF0ZVByb3ZpZGVyIiwidXJsUm91dGVyUHJvdmlkZXIiLCJvdGhlcndpc2UiLCJzdGF0ZSIsInVybCIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsInNjb3BlIiwiaHR0cCIsInRlcm1pbmFsU2VydmljZSIsImRpYWxvZyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImZldGNoVGVybWluYWxzIiwiY3JlZGVudGlhbHMiLCJ1c2VyTmFtZSIsInBhc3N3b3JkIiwidGhlbiIsInJlc3BvbnNlIiwiZGF0YSIsInRlcm1pbmFscyIsImxlbmd0aCIsInNldFRlcm1pbmFscyIsImdvIiwibWVzc2FnZSIsInNob3dNb2RhbCIsImNsb3NlRGlhbG9nIiwiY2xvc2UiLCJjb25zdGFudCIsInEiLCJkZWZlcnJlZCIsImRlZmVyIiwiZ2V0VGVybWluYWxzIiwicmVzb2x2ZSIsInJlamVjdCIsInByb21pc2UiLCJuZXR3b3JrIiwibmV0d29ya1NlcnZpY2UiLCJnZXRDcmVkZW50aWFscyIsInNzaWQiLCJkZXZpY2UiLCJ0aW1lb3V0IiwicmFjZSIsImdldERldmljZUNvbmZpZ3VyYXRpb24iLCJQcm9taXNlIiwic2V0VGltZW91dCIsInJvb3RTY29wZSIsInNlbGVjdFRhYiIsInRhYk5hbWUiLCJlbGVtZW50TGlzdCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiZWxlbWVudCIsImluZGV4IiwicmVtb3ZlQ2xhc3MiLCJoYXNDbGFzcyIsImFkZENsYXNzIiwiZ29UbyIsInJvdXRlTmFtZSIsInJlbG9hZCIsIiRvbiIsImV2ZW50IiwidG9TdGF0ZSIsInRvUGFyYW1zIiwiZnJvbVN0YXRlIiwiZnJvbVBhcmFtcyIsImxvYWRpbmciLCJuYW1lIiwiY3VycmVudFN0YXRlIiwiY29tcG9uZW50SGFuZGxlciIsInVwZ3JhZGVBbGxSZWdpc3RlcmVkIiwiZXJyb3IiLCJmYWN0b3J5IiwidGVybWluYWxzTGlzdCIsIm1ldGhvZCIsImNvbmZpZ3VyZURldmljZSIsImhvbWVDcmVkZW50aWFscyIsImRldmljZUlkTGlzdCIsInRlc3RTd2l0Y2giLCJjb25uZWN0IiwiY2FsbGJhY2siLCJzZWN1cml0eSIsIm5ldHdvcmtDcmVkZW50aWFscyIsIldpRmlDb250cm9sIiwiY29ubmVjdFRvQVAiLCJpbnRlcmZhY2VTdGF0ZSIsImdldElmYWNlU3RhdGUiLCJzdWNjZXNzIiwiaW5kZXhPZiIsImZpbmQiLCJpc0RldmljZSIsInNjYW5Gb3JXaUZpIiwidW5pcXVlTmV0d29ya3MiLCJuZXR3b3JrcyIsIm5ldHdvcmtJbmRleCIsImlzVW5pcXVlIiwidW5pcXVlTmV0d29ya0luZGV4IiwidW5pcXVlTmV0d29yayIsInB1c2giLCJmaWx0ZXIiLCJpc0RldmljZU5ldHdvcmsiLCJyZXF1aXJlIiwiaW5pdCIsImRpcmVjdGl2ZSIsInJlc3RyaWN0IiwibGluayIsImF0dHJzIiwiY3RybCIsInVwZGF0ZVRpbWVvdXQiLCJuZXdUaW1lb3V0IiwiY2FuY2VsIiwidXBkYXRlciIsImh0bWwiLCJ0aW1lU2luY2UiLCJEYXRlIiwiZGF0ZSIsInNlY29uZHMiLCJNYXRoIiwiZmxvb3IiLCJpbnRlcnZhbCIsInRpbWVTaW5jZVRleHQiLCJzY2FuTWVzc2FnZSIsInNjYW5EZXZpY2VzIiwidGltZW91dEluc3RhbmNlIiwic2Nhbm5pbmciLCJkZXZpY2VzIiwiY29uc29sZSIsImNvbm5lY3REZXZpY2UiLCJzZWxlY3RlZERldmljZSIsImNvbm5lY3RNZXNzYWdlIiwidGVybWluYWxMaXN0Iiwic3dpdGNoTGlzdCIsInN3aXRjaENvdW50IiwiZ2V0VGVybWluYWxQcm9wZXJ0eSIsInByb3BlcnR5IiwiZGV2aWNlSWQiLCJ0ZXJtaW5hbElkIiwic3BsaXQiLCJwcm9wZXJ0eVZhbHVlIiwidGVybWluYWxJbmRleCIsInRlcm1pbmFsIiwic2V0dXBEZXZpY2UiLCJtYXAiLCJkZXZpY2VJZEluZGV4IiwibG9nIiwidG9nZ2xlU3dpdGNoIiwibmV0d29ya1Bhc3N3b3JkRGlhbG9nIiwiY2hhbmdlTmV0d29yayIsInNjYW5OZXR3b3JrcyIsInNlbGVjdE5ldHdvcmsiLCJzZWxlY3RlZE5ldHdvcmsiLCJjbG9zZU5ldHdvcmtQYXNzd29yZERpYWxvZyJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDQUEsUUFBQUMsT0FBQSxRQUFBLFdBQ0FDLFFBQUEsaUJBQUEscUJBQUEsU0FBQUMsRUFBQUMsR0FDQUEsRUFBQUMsVUFBQSxLQUNBRixFQUNBRyxNQUFBLFFBQ0FDLElBQUEsSUFDQUMsWUFBQSxZQUNBQyxXQUFBLGdCQUdBQSxXQUFBLFlBQUEsU0FBQSxRQUFBLGtCQUFBLFNBQUEsU0FBQUMsRUFBQUMsRUFBQUMsRUFBQU4sR0FDQSxHQUFBTyxHQUFBQyxTQUFBQyxjQUFBLFVBRUFMLEdBQUFNLGVBQUEsV0FDQSxHQUFBQyxJQUNBQyxTQUFBUixFQUFBUSxTQUNBQyxTQUFBVCxFQUFBUyxTQUVBUCxHQUFBSSxlQUFBQyxHQUFBRyxLQUFBLFNBQUFDLEdBQ0FBLEVBQUFDLEtBQUFDLFVBQUFDLFFBQ0FaLEVBQUFhLGFBQUFKLEVBQUFDLEtBQUFDLFdBQ0FqQixFQUFBb0IsR0FBQSxhQUVBaEIsRUFBQWlCLFFBQUEseUJBQ0FkLEVBQUFlLGNBRUEsU0FBQVAsR0FDQVgsRUFBQWlCLFFBQUFOLEVBQUFDLEtBQUFLLFFBQ0FkLEVBQUFlLGVBSUFsQixFQUFBbUIsWUFBQSxXQUNBaEIsRUFBQWlCLFFBQ0FwQixFQUFBaUIsUUFBQSxVQ25DQSxXQUNBM0IsUUFBQUMsT0FBQSxVQUFBLGNBQ0E4QixTQUFBLFdBQ0FSLFdBQUEsS0FBQSxrQkFBQSxTQUFBUyxFQUFBcEIsR0FDQSxHQUFBcUIsR0FBQUQsRUFBQUUsT0FNQSxPQUxBdEIsR0FBQXVCLGVBQUFYLE9BQUEsRUFDQVMsRUFBQUcs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RUFDQTdCLEVBQUEwSCxlQUFBLEtBQ0E1RixFQUFBMEMsUUFBQTNDLEVBQUFwQixFQUFBLFNBQUF1RCxFQUFBekQsR0FDQXlELEVBQ0EsYUFBQUEsRUFDQTJFLEVBQUF6SCxZQUNBLFdBQUE4QyxFQUNBaEUsRUFBQTBILGVBQUEseUJBQUE3RixFQUFBRyxNQUFBLFlBRUFoQyxFQUFBMEgsZUFBQSxnREFDQUgsUUFBQXZELE1BQUFBLElBR0E5QixFQUFBLFdBQ0FsQyxFQUFBMEgsZUFBQSxLQUNBMUgsRUFBQU8sWUFBQUEsRUFDQVgsRUFBQW9CLEdBQUEsZUFNQWhCLEVBQUFnSiwyQkFBQSxXQUNBaEosRUFBQVMsU0FBQSxHQUNBVCxFQUFBMEgsZUFBQSxLQUNBaUIsRUFBQXZIIiwiZmlsZSI6InNjcmlwdHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwiaG9tZVwiLCBbIFwiY29tbW9uXCIgXSlcbiAgICAgICAgLmNvbmZpZyhbXCIkc3RhdGVQcm92aWRlclwiLCBcIiR1cmxSb3V0ZXJQcm92aWRlclwiLCBmdW5jdGlvbiAoc3RhdGVQcm92aWRlciwgdXJsUm91dGVyUHJvdmlkZXIpIHtcbiAgICAgICAgICAgIHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZShcIi9cIik7XG4gICAgICAgICAgICBzdGF0ZVByb3ZpZGVyXG4gICAgICAgICAgICAgICAgLnN0YXRlKFwiaG9tZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogXCIvXCIsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcImhvbWUuaHRtbFwiLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBcIkhvbWVDdHJsXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfV0pXG4gICAgICAgIC5jb250cm9sbGVyKFwiSG9tZUN0cmxcIiwgWyBcIiRzY29wZVwiLCBcIiRodHRwXCIsIFwiVGVybWluYWxTZXJ2aWNlXCIsIFwiJHN0YXRlXCIsIGZ1bmN0aW9uIChzY29wZSwgaHR0cCwgdGVybWluYWxTZXJ2aWNlLCBzdGF0ZSkge1xuICAgICAgICAgICAgdmFyIGRpYWxvZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGlhbG9nXCIpO1xuXG4gICAgICAgICAgICBzY29wZS5mZXRjaFRlcm1pbmFscyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgY3JlZGVudGlhbHMgPSB7XG4gICAgICAgICAgICAgICAgICAgIFwidXNlck5hbWVcIjogc2NvcGUudXNlck5hbWUsXG4gICAgICAgICAgICAgICAgICAgIFwicGFzc3dvcmRcIjogc2NvcGUucGFzc3dvcmRcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHRlcm1pbmFsU2VydmljZS5mZXRjaFRlcm1pbmFscyhjcmVkZW50aWFscykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYocmVzcG9uc2UuZGF0YS50ZXJtaW5hbHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXJtaW5hbFNlcnZpY2Uuc2V0VGVybWluYWxzKHJlc3BvbnNlLmRhdGEudGVybWluYWxzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmdvKFwibmV0d29ya1wiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm1lc3NhZ2UgPSBcIk5vIFRlcm1pbmFscyBBdmFpbGFibGVcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpYWxvZy5zaG93TW9kYWwoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5tZXNzYWdlID0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlO1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2cuc2hvd01vZGFsKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5jbG9zZURpYWxvZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBkaWFsb2cuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICBzY29wZS5tZXNzYWdlID0gXCJcIjtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwiY29tbW9uXCIsIFsgXCJ1aS5yb3V0ZXJcIiBdKVxuICAgICAgICAuY29uc3RhbnQoXCJyZXNvbHZlXCIsIHtcbiAgICAgICAgICAgIFwidGVybWluYWxzXCIgOiBbIFwiJHFcIiwgXCJUZXJtaW5hbFNlcnZpY2VcIiwgZnVuY3Rpb24gKHEsIHRlcm1pbmFsU2VydmljZSkge1xuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9IHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICBpZih0ZXJtaW5hbFNlcnZpY2UuZ2V0VGVybWluYWxzKCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KHsgZ28gOiBcImhvbWVcIiB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgICAgICB9XSxcbiAgICAgICAgICAgIFwibmV0d29ya1wiIDogWyBcIiRxXCIsIFwiTmV0d29ya1NlcnZpY2VcIiwgZnVuY3Rpb24gKHEsIG5ldHdvcmtTZXJ2aWNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciBjcmVkZW50aWFscyA9IG5ldHdvcmtTZXJ2aWNlLmdldENyZWRlbnRpYWxzKCk7XG4gICAgICAgICAgICAgICAgaWYoY3JlZGVudGlhbHMuc3NpZCAmJiBjcmVkZW50aWFscy5zc2lkLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCh7IGdvIDogXCJuZXR3b3JrXCIgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICBcImRldmljZVwiIDogWyBcIiRxXCIsIFwiVGVybWluYWxTZXJ2aWNlXCIsIFwiJHRpbWVvdXRcIiwgZnVuY3Rpb24gKHEsIHRlcm1pbmFsU2VydmljZSwgdGltZW91dCkge1xuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9IHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICBxLnJhY2UoIFsgdGVybWluYWxTZXJ2aWNlLmdldERldmljZUNvbmZpZ3VyYXRpb24oKSwgKG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChyZWplY3QsIDMwMDApO1xuICAgICAgICAgICAgICAgIH0pKSBdKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCh7IGdvIDogXCJkZXZpY2VcIiB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgICAgICAgIH1dXG4gICAgICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIiwgWyBcImhvbWVcIiwgXCJtYW5hZ2VcIiwgXCJuZXR3b3JrXCIsIFwiZGV2aWNlXCIgXSlcbiAgICAgICAgLmNvbnRyb2xsZXIoXCJBcHBDdHJsXCIsIFsgXCIkc2NvcGVcIiwgXCJUZXJtaW5hbFNlcnZpY2VcIiwgXCIkc3RhdGVcIiwgXCIkcm9vdFNjb3BlXCIsIFwiJHRpbWVvdXRcIiwgZnVuY3Rpb24gKHNjb3BlLCB0ZXJtaW5hbFNlcnZpY2UsIHN0YXRlLCByb290U2NvcGUsIHRpbWVvdXQpIHtcblxuICAgICAgICAgICAgdmFyIHNlbGVjdFRhYiA9IGZ1bmN0aW9uICh0YWJOYW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnRMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tZGwtbGF5b3V0X190YWJcIik7XG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGVsZW1lbnRMaXN0LCBmdW5jdGlvbiAoZWxlbWVudCwgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudCA9IGFuZ3VsYXIuZWxlbWVudChlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDbGFzcyhcImlzLWFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoZWxlbWVudC5oYXNDbGFzcyh0YWJOYW1lICsgXCItdGFiXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwiaXMtYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5nb1RvID0gZnVuY3Rpb24gKHJvdXRlTmFtZSkge1xuICAgICAgICAgICAgICAgIHN0YXRlLmdvKHJvdXRlTmFtZSwge30sIHtyZWxvYWQ6IHRydWV9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJvb3RTY29wZS4kb24oXCIkc3RhdGVDaGFuZ2VTdGFydFwiLCBmdW5jdGlvbiAoZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zLCBmcm9tU3RhdGUsIGZyb21QYXJhbXMpIHtcbiAgICAgICAgICAgICAgICB0aW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcm9vdFNjb3BlLiRvbihcIiRzdGF0ZUNoYW5nZVN1Y2Nlc3NcIiwgZnVuY3Rpb24gKGV2ZW50LCB0b1N0YXRlLCB0b1BhcmFtcywgZnJvbVN0YXRlLCBmcm9tUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdFRhYihmcm9tU3RhdGUubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmN1cnJlbnRTdGF0ZSA9IHRvU3RhdGU7XG4gICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudEhhbmRsZXIudXBncmFkZUFsbFJlZ2lzdGVyZWQoKTtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJvb3RTY29wZS4kb24oXCIkc3RhdGVDaGFuZ2VFcnJvclwiLCBmdW5jdGlvbiAoZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zLCBmcm9tU3RhdGUsIGZyb21QYXJhbXMsIGVycm9yKSB7XG4gICAgICAgICAgICAgICAgaWYoZXJyb3IuZ28pIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuZ29UbyhlcnJvci5nbyk7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfV0pXG4gICAgICAgIC5mYWN0b3J5KFwiVGVybWluYWxTZXJ2aWNlXCIsIFsgXCIkaHR0cFwiLCBmdW5jdGlvbiAoaHR0cCkge1xuXG4gICAgICAgICAgICB2YXIgdGVybWluYWxzID0gW107XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldFRlcm1pbmFscyh0ZXJtaW5hbHNMaXN0KSB7XG4gICAgICAgICAgICAgICAgdGVybWluYWxzID0gdGVybWluYWxzTGlzdDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0VGVybWluYWxzKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0ZXJtaW5hbHM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGZldGNoVGVybWluYWxzKGNyZWRlbnRpYWxzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RldmljZS90ZXJtaW5hbHNcIixcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogY3JlZGVudGlhbHNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gY29uZmlndXJlRGV2aWNlKGhvbWVDcmVkZW50aWFscywgZGV2aWNlSWRMaXN0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiaHR0cDovLzE5Mi4xNjguNC4xL2NvbmZpZ3VyZVwiLFxuICAgICAgICAgICAgICAgICAgICBkYXRhIDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJob21lQ3JlZGVudGlhbHNcIiA6IGhvbWVDcmVkZW50aWFscyxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZGV2aWNlSWRMaXN0XCIgOiBkZXZpY2VJZExpc3RcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXREZXZpY2VDb25maWd1cmF0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiaHR0cDovLzE5Mi4xNjguNC4xL1wiXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHRlc3RTd2l0Y2goaW5kZXgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcImh0dHA6Ly8xOTIuMTY4LjQuMS8/aT1cIiArIGluZGV4XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc2V0VGVybWluYWxzOiBzZXRUZXJtaW5hbHMsXG4gICAgICAgICAgICAgICAgZ2V0VGVybWluYWxzOiBnZXRUZXJtaW5hbHMsXG4gICAgICAgICAgICAgICAgZmV0Y2hUZXJtaW5hbHM6IGZldGNoVGVybWluYWxzLFxuICAgICAgICAgICAgICAgIGNvbmZpZ3VyZURldmljZTogY29uZmlndXJlRGV2aWNlLFxuICAgICAgICAgICAgICAgIGdldERldmljZUNvbmZpZ3VyYXRpb246IGdldERldmljZUNvbmZpZ3VyYXRpb24sXG4gICAgICAgICAgICAgICAgdGVzdFN3aXRjaDogdGVzdFN3aXRjaFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pXG4gICAgICAgIC5mYWN0b3J5KFwiTmV0d29ya1NlcnZpY2VcIiwgWyBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgIHZhciBXaUZpQ29udHJvbCA9IHJlcXVpcmUoXCJ3aWZpLWNvbnRyb2xcIik7XG5cbiAgICAgICAgICAgIFdpRmlDb250cm9sLmluaXQoKTtcblxuICAgICAgICAgICAgdmFyIGhvbWVDcmVkZW50aWFscyA9IHtcbiAgICAgICAgICAgICAgICBcInNzaWRcIiA6IG51bGwsXG4gICAgICAgICAgICAgICAgXCJwYXNzd29yZFwiIDogbnVsbFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gY29ubmVjdChuZXR3b3JrLCBwYXNzd29yZCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBpZighY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7fTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYobmV0d29yay5zZWN1cml0eSA9PT0gXCJOT05FXCIgfHwgcGFzc3dvcmQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ldHdvcmtDcmVkZW50aWFscyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwic3NpZFwiIDogbmV0d29yay5zc2lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJwYXNzd29yZFwiIDogcGFzc3dvcmRcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgV2lGaUNvbnRyb2wuY29ubmVjdFRvQVAobmV0d29ya0NyZWRlbnRpYWxzLCBmdW5jdGlvbiAoZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGludGVyZmFjZVN0YXRlID0gV2lGaUNvbnRyb2wuZ2V0SWZhY2VTdGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlLnN1Y2Nlc3MgJiYgKGludGVyZmFjZVN0YXRlLnNzaWQgPT09IG5ldHdvcmsuc3NpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYobmV0d29yay5zc2lkLmluZGV4T2YoXCJuZXdEZXZpY2UtXCIpID09PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaG9tZUNyZWRlbnRpYWxzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3NpZFwiIDogbmV0d29yay5zc2lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicGFzc3dvcmRcIiA6IHBhc3N3b3JkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIGhvbWVDcmVkZW50aWFscyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soXCJmYWlsZWRcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhcInBhc3N3b3JkXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0Q3JlZGVudGlhbHMoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhvbWVDcmVkZW50aWFscztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZmluZChpc0RldmljZSwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBXaUZpQ29udHJvbC5zY2FuRm9yV2lGaShmdW5jdGlvbiAoZXJyb3IsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgYWxsTmV0d29ya3MgPSByZXNwb25zZS5uZXR3b3JrcztcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1bmlxdWVOZXR3b3JrcyA9IChmdW5jdGlvbiAobmV0d29ya3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdW5pcXVlTmV0d29ya3MgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIG5ldHdvcmtJbmRleCBpbiBuZXR3b3Jrcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXNVbmlxdWUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV0d29yayA9IG5ldHdvcmtzW25ldHdvcmtJbmRleF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgdW5pcXVlTmV0d29ya0luZGV4IGluIHVuaXF1ZU5ldHdvcmtzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdW5pcXVlTmV0d29yayA9IHVuaXF1ZU5ldHdvcmtzW3VuaXF1ZU5ldHdvcmtJbmRleF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih1bmlxdWVOZXR3b3JrLnNzaWQgPT09IG5ldHdvcmsuc3NpZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzVW5pcXVlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoaXNVbmlxdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuaXF1ZU5ldHdvcmtzLnB1c2gobmV0d29yayk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVuaXF1ZU5ldHdvcmtzO1xuICAgICAgICAgICAgICAgICAgICAgICAgfShyZXNwb25zZS5uZXR3b3JrcykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlTmV0d29ya3MuZmlsdGVyKGZ1bmN0aW9uIChuZXR3b3JrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlzRGV2aWNlTmV0d29yayA9IChuZXR3b3JrLnNzaWQuaW5kZXhPZihcIm5ld0RldmljZS1cIikgPT09IDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoaXNEZXZpY2UgPT09IGlzRGV2aWNlTmV0d29yayk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBcImZpbmRcIiA6IGZpbmQsXG4gICAgICAgICAgICAgICAgXCJjb25uZWN0XCIgOiBjb25uZWN0LFxuICAgICAgICAgICAgICAgIFwiZ2V0Q3JlZGVudGlhbHNcIiA6IGdldENyZWRlbnRpYWxzXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XSlcbiAgICAgICAgLmRpcmVjdGl2ZShcInRpbWVTaW5jZVwiLCBbXCIkdGltZW91dFwiLCBmdW5jdGlvbiAodGltZW91dCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBcInJlc3RyaWN0XCIgOiBcIkFcIixcbiAgICAgICAgICAgICAgICBcImxpbmtcIiA6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmwpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgdXBkYXRlcjtcblxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVUaW1lb3V0KDApO1xuXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVRpbWVvdXQobmV3VGltZW91dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dC5jYW5jZWwodXBkYXRlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVyID0gdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5odG1sKHRpbWVTaW5jZShuZXcgRGF0ZShhdHRycy50aW1lU2luY2UpKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBuZXdUaW1lb3V0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHRpbWVTaW5jZShkYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2Vjb25kcyA9IE1hdGguZmxvb3IoKG5ldyBEYXRlKCkgLSBkYXRlKSAvIDEwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGludGVydmFsID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gMzE1MzYwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRpbWVTaW5jZVRleHQgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGludGVydmFsID49IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVUaW1lb3V0KCgxMDAwICogNjAgKiA2MCAqIDI0ICogOTApIC0gNTApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVTaW5jZVRleHQgPSBpbnRlcnZhbCArIFwiIHllYXJcIiArICgoaW50ZXJ2YWwgPiAxKSA/IFwic1wiIDogXCJcIikgKyBcIiBhZ29cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJ2YWwgPSBNYXRoLmZsb29yKHNlY29uZHMgLyAyNTkyMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW50ZXJ2YWwgPj0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVUaW1lb3V0KCgxMDAwICogNjAgKiA2MCAqIDI0ICogMTUpIC0gNTApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lU2luY2VUZXh0ID0gaW50ZXJ2YWwgKyBcIiBtb250aFwiICsgKChpbnRlcnZhbCA+IDEpID8gXCJzXCIgOiBcIlwiKSArIFwiIGFnb1wiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmFsID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gODY0MDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW50ZXJ2YWwgPj0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlVGltZW91dCgoMTAwMCAqIDYwICogNjAgKiAyNCkgLSA1MCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lU2luY2VUZXh0ID0gaW50ZXJ2YWwgKyBcIiBkYXlcIiArICgoaW50ZXJ2YWwgPiAxKSA/IFwic1wiIDogXCJcIikgKyBcIiBhZ29cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmFsID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gMzYwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW50ZXJ2YWwgPj0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVRpbWVvdXQoKDEwMDAgKiA2MCAqIDYwKSAtIDUwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lU2luY2VUZXh0ID0gaW50ZXJ2YWwgKyBcIiBob3VyXCIgKyAoKGludGVydmFsID4gMSkgPyBcInNcIiA6IFwiXCIpICsgXCIgYWdvXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmFsID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gNjApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnRlcnZhbCA+PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVRpbWVvdXQoKDEwMDAgKiA2MCkgLSA1MCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVTaW5jZVRleHQgPSBpbnRlcnZhbCArIFwiIG1pbnV0ZVwiICsgKChpbnRlcnZhbCA+IDEpID8gXCJzXCIgOiBcIlwiKSArIFwiIGFnb1wiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVRpbWVvdXQoMTAwMCAtIDUwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZVNpbmNlVGV4dCA9IE1hdGguZmxvb3Ioc2Vjb25kcykgKyBcIiBzZWNvbmRzIGFnb1wiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aW1lU2luY2VUZXh0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJkZXZpY2VcIiwgWyBcImNvbW1vblwiIF0pXG4gICAgICAgIC5jb25maWcoW1wiJHN0YXRlUHJvdmlkZXJcIiwgXCIkdXJsUm91dGVyUHJvdmlkZXJcIiwgXCJyZXNvbHZlXCIsIGZ1bmN0aW9uIChzdGF0ZVByb3ZpZGVyLCB1cmxSb3V0ZXJQcm92aWRlciwgcmVzb2x2ZSkge1xuICAgICAgICAgICAgdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKFwiL1wiKTtcbiAgICAgICAgICAgIHN0YXRlUHJvdmlkZXJcbiAgICAgICAgICAgICAgICAuc3RhdGUoXCJkZXZpY2VcIiwge1xuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiL2RldmljZVwiLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJkZXZpY2UuaHRtbFwiLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBcIkRldmljZUN0cmxcIixcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0ZXJtaW5hbHNcIiA6IHJlc29sdmUudGVybWluYWxzLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJuZXR3b3JrXCIgOiByZXNvbHZlLm5ldHdvcmtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XSlcbiAgICAgICAgLmNvbnRyb2xsZXIoXCJEZXZpY2VDdHJsXCIsIFsgXCIkc2NvcGVcIiwgXCJOZXR3b3JrU2VydmljZVwiLCBcIiR0aW1lb3V0XCIsIFwiJHN0YXRlXCIsIGZ1bmN0aW9uIChzY29wZSwgbmV0d29ya1NlcnZpY2UsIHRpbWVvdXQsIHN0YXRlKSB7XG5cbiAgICAgICAgICAgIHNjb3BlLnNjYW5NZXNzYWdlID0gXCJTY2FubmluZy4uLlwiO1xuXG4gICAgICAgICAgICBzY29wZS5zY2FuRGV2aWNlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZihzY29wZS50aW1lb3V0SW5zdGFuY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGltZW91dC5jYW5jZWwoc2NvcGUudGltZW91dEluc3RhbmNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc2NvcGUuc2Nhbk1lc3NhZ2UgPSBcIlNjYW5uaW5nLi4uXCI7XG4gICAgICAgICAgICAgICAgc2NvcGUuc2Nhbm5pbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIG5ldHdvcmtTZXJ2aWNlLmZpbmQodHJ1ZSwgZnVuY3Rpb24gKGVycm9yLCBkZXZpY2VzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5zY2FuTWVzc2FnZSA9IGVycm9yO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5zY2FubmluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZGV2aWNlcyA9IGRldmljZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihzY29wZS5kZXZpY2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5zY2FuTWVzc2FnZSA9IHNjb3BlLmRldmljZXMubGVuZ3RoICsgXCIgRGV2aWNlXCIgKyAoZGV2aWNlcy5sZW5ndGggPiAxID8gXCJzXCIgOiBcIlwiKSArIFwiIEZvdW5kXCI7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2Nhbk1lc3NhZ2UgPSBcIk5vIERldmljZXMgRm91bmRcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc2NvcGUudGltZW91dEluc3RhbmNlID0gdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnNjYW5EZXZpY2VzKCk7XG4gICAgICAgICAgICAgICAgfSwgMzAwMCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5zY2FuRGV2aWNlcygpO1xuXG4gICAgICAgICAgICBzY29wZS5jb25uZWN0RGV2aWNlID0gZnVuY3Rpb24gKG5ldHdvcmspIHtcbiAgICAgICAgICAgICAgICBzY29wZS5zZWxlY3RlZERldmljZSA9IG5ldHdvcms7XG4gICAgICAgICAgICAgICAgc2NvcGUuY29ubmVjdE1lc3NhZ2UgPSBudWxsO1xuICAgICAgICAgICAgICAgIG5ldHdvcmtTZXJ2aWNlLmNvbm5lY3QobmV0d29yaywgXCJzZXR1cG5ld2RldmljZVwiLCBmdW5jdGlvbiAoZXJyb3IsIGNyZWRlbnRpYWxzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IgPT09IFwiZmFpbGVkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jb25uZWN0TWVzc2FnZSA9IFwiRmFpbGVkIHRvIGNvbm5lY3QgdG8gXCIgKyAobmV0d29yay5zc2lkIHx8IFwiZGV2aWNlXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jb25uZWN0TWVzc2FnZSA9IFwiVW5hYmxlIHRvIGNvbm5lY3QgdG8gZGV2aWNlLCBob2xkIHRoZSByZXNldCBidXR0b24gYW5kIHRyeSBhZ2FpblwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGhvbWVDcmVkZW50aWFscyA9IG5ldHdvcmtTZXJ2aWNlLmdldENyZWRlbnRpYWxzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXR3b3JrU2VydmljZS5jb25uZWN0KHsgc3NpZDogaG9tZUNyZWRlbnRpYWxzLnNzaWQgfSwgaG9tZUNyZWRlbnRpYWxzLnBhc3N3b3JkKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNvbm5lY3RNZXNzYWdlID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5nbyhcIm1hbmFnZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICBhbmd1bGFyLm1vZHVsZShcIm1hbmFnZVwiLCBbIFwiY29tbW9uXCIgXSlcbiAgICAgICAgLmNvbmZpZyhbXCIkc3RhdGVQcm92aWRlclwiLCBcIiR1cmxSb3V0ZXJQcm92aWRlclwiLCBcInJlc29sdmVcIiwgZnVuY3Rpb24gKHN0YXRlUHJvdmlkZXIsIHVybFJvdXRlclByb3ZpZGVyLCByZXNvbHZlKSB7XG4gICAgICAgICAgICB1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoXCIvXCIpO1xuICAgICAgICAgICAgc3RhdGVQcm92aWRlclxuICAgICAgICAgICAgICAgIC5zdGF0ZShcIm1hbmFnZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogXCIvbWFuYWdlXCIsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIm1hbmFnZS5odG1sXCIsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiTWFuYWdlQ3RybFwiLFxuICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiByZXNvbHZlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1dKVxuICAgICAgICAuY29udHJvbGxlcihcIk1hbmFnZUN0cmxcIiwgWyBcIiRzY29wZVwiLCBcIlRlcm1pbmFsU2VydmljZVwiLCBcIk5ldHdvcmtTZXJ2aWNlXCIsIFwiJHRpbWVvdXRcIiwgXCIkc3RhdGVcIiwgZnVuY3Rpb24gKHNjb3BlLCB0ZXJtaW5hbFNlcnZpY2UsIG5ldHdvcmtTZXJ2aWNlLCB0aW1lb3V0LCBzdGF0ZSkge1xuXG4gICAgICAgICAgICBzY29wZS50ZXJtaW5hbExpc3QgPSB0ZXJtaW5hbFNlcnZpY2UuZ2V0VGVybWluYWxzKCk7XG5cbiAgICAgICAgICAgIHNjb3BlLmhvbWVDcmVkZW50aWFscyA9IG5ldHdvcmtTZXJ2aWNlLmdldENyZWRlbnRpYWxzKCk7XG5cbiAgICAgICAgICAgIHNjb3BlLmRldmljZUlkTGlzdCA9IFtdO1xuXG4gICAgICAgICAgICBzY29wZS5zd2l0Y2hMaXN0ID0gW107XG5cbiAgICAgICAgICAgIHRlcm1pbmFsU2VydmljZS5nZXREZXZpY2VDb25maWd1cmF0aW9uKCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBzY29wZS5zd2l0Y2hMaXN0Lmxlbmd0aCA9IHJlc3BvbnNlLmRhdGEuc3dpdGNoQ291bnQ7XG4gICAgICAgICAgICAgICAgc2NvcGUuZGV2aWNlSWRMaXN0ID0gcmVzcG9uc2UuZGF0YS5kZXZpY2VJZExpc3Q7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBzdGF0ZS5nbyhcImRldmljZVwiKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBzY29wZS5nZXRUZXJtaW5hbFByb3BlcnR5ID0gZnVuY3Rpb24gKHByb3BlcnR5LCBkZXZpY2VJZCkge1xuICAgICAgICAgICAgICAgIHZhciB0ZXJtaW5hbElkID0gKGRldmljZUlkKSA/IGRldmljZUlkLnNwbGl0KFwiL1wiKVsyXSA6IG51bGw7XG4gICAgICAgICAgICAgICAgdmFyIHByb3BlcnR5VmFsdWUgPSBudWxsO1xuICAgICAgICAgICAgICAgIGlmKHRlcm1pbmFsSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yKHZhciB0ZXJtaW5hbEluZGV4IGluIHNjb3BlLnRlcm1pbmFsTGlzdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRlcm1pbmFsID0gc2NvcGUudGVybWluYWxMaXN0W3Rlcm1pbmFsSW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYodGVybWluYWwudGVybWluYWxJZCA9PT0gdGVybWluYWxJZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5VmFsdWUgPSB0ZXJtaW5hbFtwcm9wZXJ0eV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb3BlcnR5VmFsdWU7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5zZXR1cERldmljZSA9IGZ1bmN0aW9uIChob21lQ3JlZGVudGlhbHMsIGRldmljZUlkTGlzdCkge1xuICAgICAgICAgICAgICAgIGRldmljZUlkTGlzdCA9IGRldmljZUlkTGlzdC5tYXAoZnVuY3Rpb24gKGRldmljZUlkLCBkZXZpY2VJZEluZGV4KSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoZGV2aWNlSWQgPyBkZXZpY2VJZCA6IFwiLy9cIik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGVybWluYWxTZXJ2aWNlLmNvbmZpZ3VyZURldmljZShob21lQ3JlZGVudGlhbHMsIGRldmljZUlkTGlzdCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJDb25maWd1cmF0aW9uIFN1Y2Nlc3NcIik7XG4gICAgICAgICAgICAgICAgICAgIG5ldHdvcmtTZXJ2aWNlLmNvbm5lY3QoeyBzc2lkOiBob21lQ3JlZGVudGlhbHMuc3NpZCB9LCBob21lQ3JlZGVudGlhbHMucGFzc3dvcmQsIGZ1bmN0aW9uIChlcnJvciwgY3JlZGVudGlhbHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmdvKFwiaG9tZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ29uZmlndXJhdGlvbiBGYWlsZWRcIik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS50b2dnbGVTd2l0Y2ggPSBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgICAgICAgICB0ZXJtaW5hbFNlcnZpY2UudGVzdFN3aXRjaChpbmRleCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJTd2l0Y2ggaXMgdHVybmVkIFwiICsgKChyZXNwb25zZS5kYXRhLnN0YXRlID09PSAxKSA/IFwib25cIiA6IFwib2ZmXCIpKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJVbmFibGUgdG8gYWNjZXNzIHN3aXRjaFwiKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwibmV0d29ya1wiLCBbIFwiY29tbW9uXCIgXSlcbiAgICAgICAgLmNvbmZpZyhbXCIkc3RhdGVQcm92aWRlclwiLCBcIiR1cmxSb3V0ZXJQcm92aWRlclwiLCBcInJlc29sdmVcIiwgZnVuY3Rpb24gKHN0YXRlUHJvdmlkZXIsIHVybFJvdXRlclByb3ZpZGVyLCByZXNvbHZlKSB7XG4gICAgICAgICAgICB1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoXCIvXCIpO1xuICAgICAgICAgICAgc3RhdGVQcm92aWRlclxuICAgICAgICAgICAgICAgIC5zdGF0ZShcIm5ldHdvcmtcIiwge1xuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiL25ldHdvcmtcIixcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwibmV0d29yay5odG1sXCIsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiTmV0d29ya0N0cmxcIixcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0ZXJtaW5hbHNcIiA6IHJlc29sdmUudGVybWluYWxzXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfV0pXG4gICAgICAgIC5jb250cm9sbGVyKFwiTmV0d29ya0N0cmxcIiwgWyBcIiRzY29wZVwiLCBcIk5ldHdvcmtTZXJ2aWNlXCIsIFwiJHRpbWVvdXRcIiwgXCIkc3RhdGVcIiwgZnVuY3Rpb24gKHNjb3BlLCBuZXR3b3JrU2VydmljZSwgdGltZW91dCwgc3RhdGUpIHtcblxuICAgICAgICAgICAgc2NvcGUuc2Nhbk1lc3NhZ2UgPSBcIlNjYW5uaW5nLi4uXCI7XG5cbiAgICAgICAgICAgIHNjb3BlLmNyZWRlbnRpYWxzID0gbmV0d29ya1NlcnZpY2UuZ2V0Q3JlZGVudGlhbHMoKTtcblxuICAgICAgICAgICAgdmFyIG5ldHdvcmtQYXNzd29yZERpYWxvZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmV0d29ya1Bhc3N3b3JkRGlhbG9nXCIpO1xuXG4gICAgICAgICAgICBzY29wZS5jaGFuZ2VOZXR3b3JrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHNjb3BlLnNjYW5OZXR3b3JrcygpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2NvcGUuc2Nhbk5ldHdvcmtzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmKHNjb3BlLnRpbWVvdXRJbnN0YW5jZSkge1xuICAgICAgICAgICAgICAgICAgICB0aW1lb3V0LmNhbmNlbChzY29wZS50aW1lb3V0SW5zdGFuY2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzY29wZS5zY2FuTWVzc2FnZSA9IFwiU2Nhbm5pbmcuLi5cIjtcbiAgICAgICAgICAgICAgICBzY29wZS5zY2FubmluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgbmV0d29ya1NlcnZpY2UuZmluZChmYWxzZSwgZnVuY3Rpb24gKGVycm9yLCBuZXR3b3Jrcykge1xuICAgICAgICAgICAgICAgICAgICBpZihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2Nhbk1lc3NhZ2UgPSBlcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2Nhbm5pbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5ldHdvcmtzID0gbmV0d29ya3M7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihzY29wZS5uZXR3b3Jrcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2Nhbk1lc3NhZ2UgPSBzY29wZS5uZXR3b3Jrcy5sZW5ndGggKyBcIiBOZXR3b3JrXCIgKyAoc2NvcGUubmV0d29ya3MubGVuZ3RoID4gMSA/IFwic1wiIDogXCJcIikgKyBcIiBGb3VuZFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5zY2FuTWVzc2FnZSA9IFwiTm8gTmV0d29ya3MgRm91bmRcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc2NvcGUudGltZW91dEluc3RhbmNlID0gdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnNjYW5OZXR3b3JrcygpO1xuICAgICAgICAgICAgICAgIH0sIDMwMDApO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2NvcGUuc2Nhbk5ldHdvcmtzKCk7XG5cbiAgICAgICAgICAgIHNjb3BlLnNlbGVjdE5ldHdvcmsgPSBmdW5jdGlvbiAobmV0d29yaywgcGFzc3dvcmQpIHtcbiAgICAgICAgICAgICAgICBzY29wZS5zZWxlY3RlZE5ldHdvcmsgPSBuZXR3b3JrO1xuICAgICAgICAgICAgICAgIHNjb3BlLmNvbm5lY3RNZXNzYWdlID0gbnVsbDtcbiAgICAgICAgICAgICAgICBuZXR3b3JrU2VydmljZS5jb25uZWN0KG5ldHdvcmssIHBhc3N3b3JkLCBmdW5jdGlvbiAoZXJyb3IsIGNyZWRlbnRpYWxzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihlcnJvciA9PT0gXCJwYXNzd29yZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV0d29ya1Bhc3N3b3JkRGlhbG9nLnNob3dNb2RhbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvciA9PT0gXCJmYWlsZWRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNvbm5lY3RNZXNzYWdlID0gXCJGYWlsZWQgdG8gY29ubmVjdCB0byBcIiArIChuZXR3b3JrLnNzaWQgfHwgXCJuZXR3b3JrXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jb25uZWN0TWVzc2FnZSA9IFwiVW5hYmxlIHRvIGNvbm5lY3QgdG8gbmV0d29yaywgdmVyaWZ5IHBhc3N3b3JkXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jb25uZWN0TWVzc2FnZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY3JlZGVudGlhbHMgPSBjcmVkZW50aWFscztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5nbyhcImRldmljZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5jbG9zZU5ldHdvcmtQYXNzd29yZERpYWxvZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBzY29wZS5wYXNzd29yZCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgc2NvcGUuY29ubmVjdE1lc3NhZ2UgPSBudWxsO1xuICAgICAgICAgICAgICAgIG5ldHdvcmtQYXNzd29yZERpYWxvZy5jbG9zZSgpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pO1xufSkoKTtcbiJdfQ==
