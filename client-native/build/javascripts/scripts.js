!function(){angular.module("home",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(e,n){n.otherwise("/"),e.state("home",{url:"/",templateUrl:"home.html",controller:"HomeCtrl"})}]).controller("HomeCtrl",["$scope","$http","TerminalService","$state",function(e,n,o,t){e.fetchTerminals=function(){var n={userName:e.userName,password:e.password};o.fetchTerminals(n).then(function(e){e.data.terminals.length&&(o.setTerminals(e.data.terminals),t.go("manage"))}).finally(function(n){e.message=n.data.message})}}])}(),function(){angular.module("app",["home","manage"]).controller("AppCtrl",["$scope",function(e){e.title="Setup New Device"}]).factory("TerminalService",["$http",function(e){function n(e){s=e}function o(){return s}function t(n){return e({method:"POST",url:"http://localhost:8080/device/free",data:n})}function r(n,o){return e({method:"POST",url:"http://192.168.4.1/configure",data:{homeCredentials:n,deviceId:o}})}var s=[];return{setTerminals:n,getTerminals:o,fetchTerminals:t,configureTerminal:r}}])}(),function(){angular.module("manage",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(e,n){n.otherwise("/"),e.state("manage",{url:"/",templateUrl:"manage.html",controller:"ManageCtrl"})}]).controller("ManageCtrl",["$scope","TerminalService","$timeout",function(e,n,o){var t=require("wifi-control");t.init(),e.terminals=n.getTerminals(),e.scanMessage="Looking for networks...",e.selectedTerminal=null,e.homeNetwork={isSet:!1,configuring:!1,credentials:{ssid:null,password:null},set:function(){this.configuring=!0,e.scanNetworks()}},e.configureTerminal=function(n){e.configuring=!0,e.selectedTerminal=n,e.scanNetworks()},e.changeTerminal=function(n){e.configuring=!1,e.selectedTerminal=null,e.scanning=!1,e.networks=null,e.scanMessage="Looking for networks..."},e.scanNetworks=function(){e.scanning=!0,t.scanForWiFi(function(n,t){n&&console.error(n),o(function(){e.scanning=!1,e.networks=t.networks,e.scanMessage="No Networks Found"})})},e.connectNetwork=function(n,r,s){if(e.connectMessage=null,"Open"===n.security||r||n.ssid===e.getPassword)if("Open"===n.security||r){var i={ssid:n.ssid,password:r};t.connectToAP(i,function(i,a){i&&console.error(i),o(function(){var o=t.getIfaceState();a.success&&o.ssid===n.ssid?s(n,r):e.connectMessage="Failed to connect to "+(n.ssid||"network")})})}else e.connectMessage="Enter network password";else e.getPassword=n.ssid},e.configureTerminalCallback=function(){e.getPassword=null,e.connectMessage=null,e.linking=!0,e.closeLinkModal=!1,e.linkMessage="Linking device to terminal...";var r=[e.selectedTerminal.homeId,e.selectedTerminal.roomId,e.selectedTerminal.terminalId];n.configureTerminal(e.homeNetwork.credentials,r).then(function(e){console.log("Configuration Success")},function(e){console.log("Configuration Failed")}).finally(function(n){var r="Success/Failure in link";n?n.data&&n.data.message&&(r=n.data.message):r="Please check if you've connected to the correct network",e.linkMessage=r,e.closeLinkModal=!0,t.connectToAP(networkCredentials,function(n,r){n&&console.error(n),o(function(){var n=t.getIfaceState();r.success&&n.ssid===network.ssid?callback(network,password):e.connectMessage="Failed to connect to "+(network.ssid||"network")})})})},e.setHomeNetworkCallback=function(n,o){e.getPassword=null,e.connectMessage=null,e.homeNetwork.credentials={ssid:n.ssid,password:o},e.homeNetwork.isSet=!0,e.homeNetwork.configuring=!1},e.closeLinking=function(n){e.linking=!1}}])}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhvbWUuanMiLCJpbmRleC5qcyIsIm1hbmFnZS9tYW5hZ2UuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbmZpZyIsInN0YXRlUHJvdmlkZXIiLCJ1cmxSb3V0ZXJQcm92aWRlciIsIm90aGVyd2lzZSIsInN0YXRlIiwidXJsIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwic2NvcGUiLCJodHRwIiwidGVybWluYWxTZXJ2aWNlIiwiZmV0Y2hUZXJtaW5hbHMiLCJjcmVkZW50aWFscyIsInVzZXJOYW1lIiwicGFzc3dvcmQiLCJ0aGVuIiwicmVzcG9uc2UiLCJkYXRhIiwidGVybWluYWxzIiwibGVuZ3RoIiwic2V0VGVybWluYWxzIiwiZ28iLCJmaW5hbGx5IiwibWVzc2FnZSIsInRpdGxlIiwiZmFjdG9yeSIsInRlcm1pbmFsc0xpc3QiLCJnZXRUZXJtaW5hbHMiLCJtZXRob2QiLCJjb25maWd1cmVUZXJtaW5hbCIsImhvbWVDcmVkZW50aWFscyIsImRldmljZUlkIiwidGltZW91dCIsIldpRmlDb250cm9sIiwicmVxdWlyZSIsImluaXQiLCJzY2FuTWVzc2FnZSIsInNlbGVjdGVkVGVybWluYWwiLCJob21lTmV0d29yayIsImlzU2V0IiwiY29uZmlndXJpbmciLCJzc2lkIiwic2V0IiwidGhpcyIsInNjYW5OZXR3b3JrcyIsInRlcm1pbmFsIiwiY2hhbmdlVGVybWluYWwiLCJzY2FubmluZyIsIm5ldHdvcmtzIiwic2NhbkZvcldpRmkiLCJlcnIiLCJjb25zb2xlIiwiZXJyb3IiLCJjb25uZWN0TmV0d29yayIsIm5ldHdvcmsiLCJjYWxsYmFjayIsImNvbm5lY3RNZXNzYWdlIiwic2VjdXJpdHkiLCJnZXRQYXNzd29yZCIsIm5ldHdvcmtDcmVkZW50aWFscyIsImNvbm5lY3RUb0FQIiwiaW50ZXJmYWNlU3RhdGUiLCJnZXRJZmFjZVN0YXRlIiwic3VjY2VzcyIsImNvbmZpZ3VyZVRlcm1pbmFsQ2FsbGJhY2siLCJsaW5raW5nIiwiY2xvc2VMaW5rTW9kYWwiLCJsaW5rTWVzc2FnZSIsImhvbWVJZCIsInJvb21JZCIsInRlcm1pbmFsSWQiLCJsb2ciLCJzZXRIb21lTmV0d29ya0NhbGxiYWNrIiwiY2xvc2VMaW5raW5nIl0sIm1hcHBpbmdzIjoiQ0FBQSxXQUNBQSxRQUFBQyxPQUFBLFFBQUEsY0FDQUMsUUFBQSxpQkFBQSxxQkFBQSxTQUFBQyxFQUFBQyxHQUNBQSxFQUFBQyxVQUFBLEtBQ0FGLEVBQ0FHLE1BQUEsUUFDQUMsSUFBQSxJQUNBQyxZQUFBLFlBQ0FDLFdBQUEsZ0JBR0FBLFdBQUEsWUFBQSxTQUFBLFFBQUEsa0JBQUEsU0FBQSxTQUFBQyxFQUFBQyxFQUFBQyxFQUFBTixHQUNBSSxFQUFBRyxlQUFBLFdBQ0EsR0FBQUMsSUFDQUMsU0FBQUwsRUFBQUssU0FDQUMsU0FBQU4sRUFBQU0sU0FFQUosR0FBQUMsZUFBQUMsR0FBQUcsS0FBQSxTQUFBQyxHQUNBQSxFQUFBQyxLQUFBQyxVQUFBQyxTQUNBVCxFQUFBVSxhQUFBSixFQUFBQyxLQUFBQyxXQUNBZCxFQUFBaUIsR0FBQSxhQUVBQyxRQUFBLFNBQUFOLEdBQ0FSLEVBQUFlLFFBQUFQLEVBQUFDLEtBQUFNLGlCQ3ZCQSxXQUNBekIsUUFBQUMsT0FBQSxPQUFBLE9BQUEsV0FDQVEsV0FBQSxXQUFBLFNBQUEsU0FBQUMsR0FDQUEsRUFBQWdCLE1BQUEsc0JBRUFDLFFBQUEsbUJBQUEsUUFBQSxTQUFBaEIsR0FJQSxRQUFBVyxHQUFBTSxHQUNBUixFQUFBUSxFQUdBLFFBQUFDLEtBQ0EsTUFBQVQsR0FHQSxRQUFBUCxHQUFBQyxHQUNBLE1BQUFILElBQ0FtQixPQUFBLE9BQ0F2QixJQUFBLG9DQUNBWSxLQUFBTCxJQUlBLFFBQUFpQixHQUFBQyxFQUFBQyxHQUNBLE1BQUF0QixJQUNBbUIsT0FBQSxPQUNBdkIsSUFBQSwrQkFDQVksTUFDQWEsZ0JBQUFBLEVBQ0FDLFNBQUFBLEtBeEJBLEdBQUFiLEtBNkJBLFFBQ0FFLGFBQUFBLEVBQ0FPLGFBQUFBLEVBQ0FoQixlQUFB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QXBCLE9BQUFhLFFBQUFiLEtBQ0FjLFNBQUFELFFBQUF4QyxVQUVBTixFQUFBZ0QsZUFBQSx5QkFBQUYsUUFBQWIsTUFBQSxrQkFPQWpDLEVBQUFnRSx1QkFBQSxTQUFBbEIsRUFBQXhDLEdBQ0FOLEVBQUFrRCxZQUFBLEtBQ0FsRCxFQUFBZ0QsZUFBQSxLQUNBaEQsRUFBQThCLFlBQUExQixhQUNBNkIsS0FBQWEsRUFBQWIsS0FDQTNCLFNBQUFBLEdBRUFOLEVBQUE4QixZQUFBQyxPQUFBLEVBQ0EvQixFQUFBOEIsWUFBQUUsYUFBQSxHQUdBaEMsRUFBQWlFLGFBQUEsU0FBQXpELEdBQ0FSLEVBQUF5RCxTQUFBIiwiZmlsZSI6InNjcmlwdHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwiaG9tZVwiLCBbIFwidWkucm91dGVyXCIgXSlcbiAgICAgICAgLmNvbmZpZyhbXCIkc3RhdGVQcm92aWRlclwiLCBcIiR1cmxSb3V0ZXJQcm92aWRlclwiLCBmdW5jdGlvbiAoc3RhdGVQcm92aWRlciwgdXJsUm91dGVyUHJvdmlkZXIpIHtcbiAgICAgICAgICAgIHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZShcIi9cIik7XG4gICAgICAgICAgICBzdGF0ZVByb3ZpZGVyXG4gICAgICAgICAgICAgICAgLnN0YXRlKFwiaG9tZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogXCIvXCIsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcImhvbWUuaHRtbFwiLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBcIkhvbWVDdHJsXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfV0pXG4gICAgICAgIC5jb250cm9sbGVyKFwiSG9tZUN0cmxcIiwgWyBcIiRzY29wZVwiLCBcIiRodHRwXCIsIFwiVGVybWluYWxTZXJ2aWNlXCIsIFwiJHN0YXRlXCIsIGZ1bmN0aW9uIChzY29wZSwgaHR0cCwgdGVybWluYWxTZXJ2aWNlLCBzdGF0ZSkge1xuICAgICAgICAgICAgc2NvcGUuZmV0Y2hUZXJtaW5hbHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNyZWRlbnRpYWxzID0ge1xuICAgICAgICAgICAgICAgICAgICBcInVzZXJOYW1lXCI6IHNjb3BlLnVzZXJOYW1lLFxuICAgICAgICAgICAgICAgICAgICBcInBhc3N3b3JkXCI6IHNjb3BlLnBhc3N3b3JkXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB0ZXJtaW5hbFNlcnZpY2UuZmV0Y2hUZXJtaW5hbHMoY3JlZGVudGlhbHMpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlLmRhdGEudGVybWluYWxzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVybWluYWxTZXJ2aWNlLnNldFRlcm1pbmFscyhyZXNwb25zZS5kYXRhLnRlcm1pbmFscyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5nbyhcIm1hbmFnZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLm1lc3NhZ2UgPSByZXNwb25zZS5kYXRhLm1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICBhbmd1bGFyLm1vZHVsZShcImFwcFwiLCBbIFwiaG9tZVwiLCBcIm1hbmFnZVwiIF0pXG4gICAgICAgIC5jb250cm9sbGVyKFwiQXBwQ3RybFwiLCBbIFwiJHNjb3BlXCIsIGZ1bmN0aW9uIChzY29wZSkge1xuICAgICAgICAgICAgc2NvcGUudGl0bGUgPSBcIlNldHVwIE5ldyBEZXZpY2VcIjtcbiAgICAgICAgfV0pXG4gICAgICAgIC5mYWN0b3J5KFwiVGVybWluYWxTZXJ2aWNlXCIsIFsgXCIkaHR0cFwiLCBmdW5jdGlvbiAoaHR0cCkge1xuXG4gICAgICAgICAgICB2YXIgdGVybWluYWxzID0gW107XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldFRlcm1pbmFscyh0ZXJtaW5hbHNMaXN0KSB7XG4gICAgICAgICAgICAgICAgdGVybWluYWxzID0gdGVybWluYWxzTGlzdDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0VGVybWluYWxzKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0ZXJtaW5hbHM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGZldGNoVGVybWluYWxzKGNyZWRlbnRpYWxzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RldmljZS9mcmVlXCIsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGNyZWRlbnRpYWxzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGNvbmZpZ3VyZVRlcm1pbmFsKGhvbWVDcmVkZW50aWFscywgZGV2aWNlSWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICAgICAgICAgIHVybDogXCJodHRwOi8vMTkyLjE2OC40LjEvY29uZmlndXJlXCIsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEgOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcImhvbWVDcmVkZW50aWFsc1wiIDogaG9tZUNyZWRlbnRpYWxzLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJkZXZpY2VJZFwiIDogZGV2aWNlSWRcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHNldFRlcm1pbmFsczogc2V0VGVybWluYWxzLFxuICAgICAgICAgICAgICAgIGdldFRlcm1pbmFsczogZ2V0VGVybWluYWxzLFxuICAgICAgICAgICAgICAgIGZldGNoVGVybWluYWxzOiBmZXRjaFRlcm1pbmFscyxcbiAgICAgICAgICAgICAgICBjb25maWd1cmVUZXJtaW5hbDogY29uZmlndXJlVGVybWluYWxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwibWFuYWdlXCIsIFsgXCJ1aS5yb3V0ZXJcIiBdKVxuICAgICAgICAuY29uZmlnKFtcIiRzdGF0ZVByb3ZpZGVyXCIsIFwiJHVybFJvdXRlclByb3ZpZGVyXCIsIGZ1bmN0aW9uIChzdGF0ZVByb3ZpZGVyLCB1cmxSb3V0ZXJQcm92aWRlcikge1xuICAgICAgICAgICAgdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKFwiL1wiKTtcbiAgICAgICAgICAgIHN0YXRlUHJvdmlkZXJcbiAgICAgICAgICAgICAgICAuc3RhdGUoXCJtYW5hZ2VcIiwge1xuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiL1wiLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJtYW5hZ2UuaHRtbFwiLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBcIk1hbmFnZUN0cmxcIlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XSlcbiAgICAgICAgLmNvbnRyb2xsZXIoXCJNYW5hZ2VDdHJsXCIsIFsgXCIkc2NvcGVcIiwgXCJUZXJtaW5hbFNlcnZpY2VcIiwgXCIkdGltZW91dFwiLCBmdW5jdGlvbiAoc2NvcGUsIHRlcm1pbmFsU2VydmljZSwgdGltZW91dCkge1xuXG4gICAgICAgICAgICB2YXIgV2lGaUNvbnRyb2wgPSByZXF1aXJlKFwid2lmaS1jb250cm9sXCIpO1xuXG4gICAgICAgICAgICBXaUZpQ29udHJvbC5pbml0KCk7XG5cbiAgICAgICAgICAgIHNjb3BlLnRlcm1pbmFscyA9IHRlcm1pbmFsU2VydmljZS5nZXRUZXJtaW5hbHMoKTtcbiAgICAgICAgICAgIHNjb3BlLnNjYW5NZXNzYWdlID0gXCJMb29raW5nIGZvciBuZXR3b3Jrcy4uLlwiO1xuXG4gICAgICAgICAgICBzY29wZS5zZWxlY3RlZFRlcm1pbmFsID0gbnVsbDtcblxuICAgICAgICAgICAgc2NvcGUuaG9tZU5ldHdvcmsgPSB7XG4gICAgICAgICAgICAgICAgXCJpc1NldFwiIDogZmFsc2UsXG4gICAgICAgICAgICAgICAgXCJjb25maWd1cmluZ1wiIDogZmFsc2UsXG4gICAgICAgICAgICAgICAgXCJjcmVkZW50aWFsc1wiIDoge1xuICAgICAgICAgICAgICAgICAgICBcInNzaWRcIiA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIFwicGFzc3dvcmRcIiA6IG51bGxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFwic2V0XCIgOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29uZmlndXJpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5zY2FuTmV0d29ya3MoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5jb25maWd1cmVUZXJtaW5hbCA9IGZ1bmN0aW9uICh0ZXJtaW5hbCkge1xuICAgICAgICAgICAgICAgIHNjb3BlLmNvbmZpZ3VyaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBzY29wZS5zZWxlY3RlZFRlcm1pbmFsID0gdGVybWluYWw7XG4gICAgICAgICAgICAgICAgc2NvcGUuc2Nhbk5ldHdvcmtzKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5jaGFuZ2VUZXJtaW5hbCA9IGZ1bmN0aW9uICh0ZXJtaW5hbCkge1xuICAgICAgICAgICAgICAgIHNjb3BlLmNvbmZpZ3VyaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgc2NvcGUuc2VsZWN0ZWRUZXJtaW5hbCA9IG51bGw7XG4gICAgICAgICAgICAgICAgc2NvcGUuc2Nhbm5pbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBzY29wZS5uZXR3b3JrcyA9IG51bGw7XG4gICAgICAgICAgICAgICAgc2NvcGUuc2Nhbk1lc3NhZ2UgPSBcIkxvb2tpbmcgZm9yIG5ldHdvcmtzLi4uXCI7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5zY2FuTmV0d29ya3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUuc2Nhbm5pbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIFdpRmlDb250cm9sLnNjYW5Gb3JXaUZpKGZ1bmN0aW9uIChlcnIsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2Nhbm5pbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5ldHdvcmtzID0gcmVzcG9uc2UubmV0d29ya3M7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5zY2FuTWVzc2FnZSA9IFwiTm8gTmV0d29ya3MgRm91bmRcIjtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5jb25uZWN0TmV0d29yayA9IGZ1bmN0aW9uIChuZXR3b3JrLCBwYXNzd29yZCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBzY29wZS5jb25uZWN0TWVzc2FnZSA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICBpZihuZXR3b3JrLnNlY3VyaXR5ID09PSBcIk9wZW5cIiB8fCBwYXNzd29yZCB8fCAobmV0d29yay5zc2lkID09PSBzY29wZS5nZXRQYXNzd29yZCkpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZihuZXR3b3JrLnNlY3VyaXR5ID09PSBcIk9wZW5cIiB8fCBwYXNzd29yZCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV0d29ya0NyZWRlbnRpYWxzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwic3NpZFwiIDogbmV0d29yay5zc2lkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicGFzc3dvcmRcIiA6IHBhc3N3b3JkXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBXaUZpQ29udHJvbC5jb25uZWN0VG9BUChuZXR3b3JrQ3JlZGVudGlhbHMsIGZ1bmN0aW9uIChlcnIsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoZXJyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnRlcmZhY2VTdGF0ZSA9IFdpRmlDb250cm9sLmdldElmYWNlU3RhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYocmVzcG9uc2Uuc3VjY2VzcyAmJiAoaW50ZXJmYWNlU3RhdGUuc3NpZCA9PT0gbmV0d29yay5zc2lkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobmV0d29yaywgcGFzc3dvcmQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY29ubmVjdE1lc3NhZ2UgPSBcIkZhaWxlZCB0byBjb25uZWN0IHRvIFwiICsgKG5ldHdvcmsuc3NpZCB8fCBcIm5ldHdvcmtcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY29ubmVjdE1lc3NhZ2UgPSBcIkVudGVyIG5ldHdvcmsgcGFzc3dvcmRcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmdldFBhc3N3b3JkID0gbmV0d29yay5zc2lkO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNjb3BlLmNvbmZpZ3VyZVRlcm1pbmFsQ2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUuZ2V0UGFzc3dvcmQgPSBudWxsO1xuICAgICAgICAgICAgICAgIHNjb3BlLmNvbm5lY3RNZXNzYWdlID0gbnVsbDtcbiAgICAgICAgICAgICAgICBzY29wZS5saW5raW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBzY29wZS5jbG9zZUxpbmtNb2RhbCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHNjb3BlLmxpbmtNZXNzYWdlID0gXCJMaW5raW5nIGRldmljZSB0byB0ZXJtaW5hbC4uLlwiO1xuICAgICAgICAgICAgICAgIHZhciBkZXZpY2VJZCA9IFsgc2NvcGUuc2VsZWN0ZWRUZXJtaW5hbC5ob21lSWQsIHNjb3BlLnNlbGVjdGVkVGVybWluYWwucm9vbUlkLCBzY29wZS5zZWxlY3RlZFRlcm1pbmFsLnRlcm1pbmFsSWQgXTtcbiAgICAgICAgICAgICAgICB0ZXJtaW5hbFNlcnZpY2UuY29uZmlndXJlVGVybWluYWwoc2NvcGUuaG9tZU5ldHdvcmsuY3JlZGVudGlhbHMsIGRldmljZUlkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNvbmZpZ3VyYXRpb24gU3VjY2Vzc1wiKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJDb25maWd1cmF0aW9uIEZhaWxlZFwiKTtcbiAgICAgICAgICAgICAgICB9KS5maW5hbGx5KGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9IFwiU3VjY2Vzcy9GYWlsdXJlIGluIGxpbmtcIjtcbiAgICAgICAgICAgICAgICAgICAgaWYoIXJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gXCJQbGVhc2UgY2hlY2sgaWYgeW91J3ZlIGNvbm5lY3RlZCB0byB0aGUgY29ycmVjdCBuZXR3b3JrXCI7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihyZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEubWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSByZXNwb25zZS5kYXRhLm1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc2NvcGUubGlua01lc3NhZ2UgPSBtZXNzYWdlO1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5jbG9zZUxpbmtNb2RhbCA9IHRydWU7XG5cblxuICAgICAgICAgICAgICAgICAgICAgICAgV2lGaUNvbnRyb2wuY29ubmVjdFRvQVAobmV0d29ya0NyZWRlbnRpYWxzLCBmdW5jdGlvbiAoZXJyLCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW50ZXJmYWNlU3RhdGUgPSBXaUZpQ29udHJvbC5nZXRJZmFjZVN0YXRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlLnN1Y2Nlc3MgJiYgKGludGVyZmFjZVN0YXRlLnNzaWQgPT09IG5ldHdvcmsuc3NpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG5ldHdvcmssIHBhc3N3b3JkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNvbm5lY3RNZXNzYWdlID0gXCJGYWlsZWQgdG8gY29ubmVjdCB0byBcIiArIChuZXR3b3JrLnNzaWQgfHwgXCJuZXR3b3JrXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNjb3BlLnNldEhvbWVOZXR3b3JrQ2FsbGJhY2sgPSBmdW5jdGlvbiAobmV0d29yaywgcGFzc3dvcmQpIHtcbiAgICAgICAgICAgICAgICBzY29wZS5nZXRQYXNzd29yZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgc2NvcGUuY29ubmVjdE1lc3NhZ2UgPSBudWxsO1xuICAgICAgICAgICAgICAgIHNjb3BlLmhvbWVOZXR3b3JrLmNyZWRlbnRpYWxzID0ge1xuICAgICAgICAgICAgICAgICAgICBcInNzaWRcIiA6IG5ldHdvcmsuc3NpZCxcbiAgICAgICAgICAgICAgICAgICAgXCJwYXNzd29yZFwiIDogcGFzc3dvcmRcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHNjb3BlLmhvbWVOZXR3b3JrLmlzU2V0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBzY29wZS5ob21lTmV0d29yay5jb25maWd1cmluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2NvcGUuY2xvc2VMaW5raW5nID0gZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUubGlua2luZyA9IGZhbHNlO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pO1xufSkoKTtcbiJdfQ==
