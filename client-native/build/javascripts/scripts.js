!function(){angular.module("home",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(e,n){n.otherwise("/"),e.state("home",{url:"/",templateUrl:"home.html",controller:"HomeCtrl"})}]).controller("HomeCtrl",["$scope","$http","TerminalService","$state",function(e,n,t,o){e.fetchTerminals=function(){var n={userName:e.userName,password:e.password};t.fetchTerminals(n).then(function(n){n.data.terminals.length?(t.setTerminals(n.data.terminals),o.go("network")):e.message="No Terminals Available"},function(n){e.message=n.data.message})}}])}(),function(){angular.module("app",["home","manage","network","device"]).controller("AppCtrl",["$scope",function(e){e.title="Setup New Device"}]).factory("TerminalService",["$http",function(e){function n(e){s=e}function t(){return s}function o(n){return e({method:"POST",url:"http://localhost:8080/device/free",data:n})}function r(n,t){return e({method:"POST",url:"http://192.168.4.1/configure",data:{homeCredentials:n,deviceIdList:t}})}function i(){return e({method:"GET",url:"http://192.168.4.1/"})}var s=[];return{setTerminals:n,getTerminals:t,fetchTerminals:o,configureDevice:r,getDeviceConfiguration:i}}]).factory("NetworkService",[function(){function e(e,n,t){if(t||(t=function(){}),"Open"===e.security||n){var i={ssid:e.ssid,password:n};o.connectToAP(i,function(i,s){if(i)t(i);else{var c=o.getIfaceState();s.success&&c.ssid===e.ssid?(e.ssid.indexOf("newDevice-")===-1&&(r={ssid:e.ssid,password:n}),t(null,r)):t("failed")}})}else t("password")}function n(){return r}function t(e,n){o.scanForWiFi(function(t,o){if(t)n(t);else{var r=(o.networks,function(e){var n=[];for(var t in e){var o=!0,r=e[t];for(var i in n){var s=n[i];if(s.ssid===r.ssid){o=!1;break}}o&&n.push(r)}return n}(o.networks));n(null,r.filter(function(n){var t=0===n.ssid.indexOf("newDevice-");return e===t}))}})}var o=require("wifi-control");o.init();var r={ssid:null,password:null};return{find:t,connect:e,getCredentials:n}}])}(),function(){angular.module("device",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(e,n){n.otherwise("/"),e.state("device",{url:"/device",templateUrl:"device.html",controller:"DeviceCtrl"})}]).controller("DeviceCtrl",["$scope","NetworkService","$timeout","$state",function(e,n,t,o){e.scanMessage="Looking for devices...",e.scanDevices=function(){e.scanning=!0,n.find(!0,function(n,o){n&&(e.scanMessage=n,console.error(n)),t(function(){e.scanning=!1,e.devices=o,e.scanMessage="No Devices Found"})})},e.scanDevices(),e.connectDevice=function(r,i){e.connectMessage=null,n.connect(r,i,function(i,s){if(i){"password"===i?e.getPassword===r.ssid?e.connectMessage="Enter device password":e.getPassword=r.ssid:"failed"===i?e.connectMessage="Failed to connect to "+(r.ssid||"device"):(e.connectMessage="Unable to connect to device, verify password",console.error(i));var c=n.getCredentials();n.connect({ssid:c.ssid},c.password)}else t(function(){e.getPassword=null,e.connectMessage=null,o.go("manage")})})}}])}(),function(){angular.module("manage",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(e,n){n.otherwise("/"),e.state("manage",{url:"/manage",templateUrl:"manage.html",controller:"ManageCtrl"})}]).controller("ManageCtrl",["$scope","TerminalService","NetworkService","$timeout","$state",function(e,n,t,o,r){e.terminalList=n.getTerminals(),0===e.terminalList.length&&(alert("You do not have any terminals to configure"),r.go("home")),e.homeCredentials=t.getCredentials(),e.deviceIdList=[],e.switchList=[],n.getDeviceConfiguration().then(function(n){e.switchList.length=n.data.switchCount,e.deviceIdList=n.data.deviceIdList},function(n){e.message="Please check if you have connected to the correct device"}),e.getTerminalProperty=function(n,t){var o=t?t.split("/")[2]:null,r=null;if(o)for(var i in e.terminalList){var s=e.terminalList[i];if(s.terminalId===o){r=s[n];break}}return r},e.setupDevice=function(e,o){o=o.map(function(e,n){return e?e:"//"}),n.configureDevice(e,o).then(function(n){console.log("Configuration Success"),t.connect({ssid:e.ssid},e.password,function(e,n){r.go("home")})},function(e){console.log("Configuration Failed")})}}])}(),function(){angular.module("network",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(e,n){n.otherwise("/"),e.state("network",{url:"/network",templateUrl:"network.html",controller:"NetworkCtrl"})}]).controller("NetworkCtrl",["$scope","NetworkService","$timeout","$state",function(e,n,t,o){e.scanMessage="Looking for networks...",e.credentials=n.getCredentials(),e.changeNetwork=function(){e.showNetworkList=!0,e.scanNetworks()},e.scanNetworks=function(){e.scanning=!0,n.find(!1,function(n,o){n&&(e.scanMessage=n,console.error(n)),t(function(){e.scanning=!1,e.networks=o,e.scanMessage="No Networks Found"})})},e.selectNetwork=function(r,i){e.connectMessage=null,n.connect(r,i,function(n,i){n?"password"===n?e.getPassword===r.ssid?e.connectMessage="Enter network password":e.getPassword=r.ssid:"failed"===n?e.connectMessage="Failed to connect to "+(r.ssid||"network"):(e.connectMessage="Unable to connect to network, verify password",console.error(n)):t(function(){e.getPassword=null,e.connectMessage=null,e.credentials=i,e.showNetworkList=!1,o.go("device")})})}}])}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhvbWUuanMiLCJpbmRleC5qcyIsImRldmljZS9kZXZpY2UuanMiLCJtYW5hZ2UvbWFuYWdlLmpzIiwibmV0d29yay9uZXR3b3JrLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCJzdGF0ZVByb3ZpZGVyIiwidXJsUm91dGVyUHJvdmlkZXIiLCJvdGhlcndpc2UiLCJzdGF0ZSIsInVybCIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsInNjb3BlIiwiaHR0cCIsInRlcm1pbmFsU2VydmljZSIsImZldGNoVGVybWluYWxzIiwiY3JlZGVudGlhbHMiLCJ1c2VyTmFtZSIsInBhc3N3b3JkIiwidGhlbiIsInJlc3BvbnNlIiwiZGF0YSIsInRlcm1pbmFscyIsImxlbmd0aCIsInNldFRlcm1pbmFscyIsImdvIiwibWVzc2FnZSIsInRpdGxlIiwiZmFjdG9yeSIsInRlcm1pbmFsc0xpc3QiLCJnZXRUZXJtaW5hbHMiLCJtZXRob2QiLCJjb25maWd1cmVEZXZpY2UiLCJob21lQ3JlZGVudGlhbHMiLCJkZXZpY2VJZExpc3QiLCJnZXREZXZpY2VDb25maWd1cmF0aW9uIiwiY29ubmVjdCIsIm5ldHdvcmsiLCJjYWxsYmFjayIsInNlY3VyaXR5IiwibmV0d29ya0NyZWRlbnRpYWxzIiwic3NpZCIsIldpRmlDb250cm9sIiwiY29ubmVjdFRvQVAiLCJlcnJvciIsImludGVyZmFjZVN0YXRlIiwiZ2V0SWZhY2VTdGF0ZSIsInN1Y2Nlc3MiLCJpbmRleE9mIiwiZ2V0Q3JlZGVudGlhbHMiLCJmaW5kIiwiaXNEZXZpY2UiLCJzY2FuRm9yV2lGaSIsInVuaXF1ZU5ldHdvcmtzIiwibmV0d29ya3MiLCJuZXR3b3JrSW5kZXgiLCJpc1VuaXF1ZSIsInVuaXF1ZU5ldHdvcmtJbmRleCIsInVuaXF1ZU5ldHdvcmsiLCJwdXNoIiwiZmlsdGVyIiwiaXNEZXZpY2VOZXR3b3JrIiwicmVxdWlyZSIsImluaXQiLCJuZXR3b3JrU2VydmljZSIsInRpbWVvdXQiLCJzY2FuTWVzc2FnZSIsInNjYW5EZXZpY2VzIiwic2Nhbm5pbmciLCJkZXZpY2VzIiwiY29uc29sZSIsImNvbm5lY3REZXZpY2UiLCJjb25uZWN0TWVzc2FnZSIsImdldFBhc3N3b3JkIiwidGVybWluYWxMaXN0IiwiYWxlcnQiLCJzd2l0Y2hMaXN0Iiwic3dpdGNoQ291bnQiLCJnZXRUZXJtaW5hbFByb3BlcnR5IiwicHJvcGVydHkiLCJkZXZpY2VJZCIsInRlcm1pbmFsSWQiLCJzcGxpdCIsInByb3BlcnR5VmFsdWUiLCJ0ZXJtaW5hbEluZGV4IiwidGVybWluYWwiLCJzZXR1cERldmljZSIsIm1hcCIsImRldmljZUlkSW5kZXgiLCJsb2ciLCJjaGFuZ2VOZXR3b3JrIiwic2hvd05ldHdvcmtMaXN0Iiwic2Nhbk5ldHdvcmtzIiwic2VsZWN0TmV0d29yayJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDQUEsUUFBQUMsT0FBQSxRQUFBLGNBQ0FDLFFBQUEsaUJBQUEscUJBQUEsU0FBQUMsRUFBQUMsR0FDQUEsRUFBQUMsVUFBQSxLQUNBRixFQUNBRyxNQUFBLFFBQ0FDLElBQUEsSUFDQUMsWUFBQSxZQUNBQyxXQUFBLGdCQUdBQSxXQUFBLFlBQUEsU0FBQSxRQUFBLGtCQUFBLFNBQUEsU0FBQUMsRUFBQUMsRUFBQUMsRUFBQU4sR0FDQUksRUFBQUcsZUFBQSxXQUNBLEdBQUFDLElBQ0FDLFNBQUFMLEVBQUFLLFNBQ0FDLFNBQUFOLEVBQUFNLFNBRUFKLEdBQUFDLGVBQUFDLEdBQUFHLEtBQUEsU0FBQUMsR0FDQUEsRUFBQUMsS0FBQUMsVUFBQUMsUUFDQVQsRUFBQVUsYUFBQUosRUFBQUMsS0FBQUMsV0FDQWQsRUFBQWlCLEdBQUEsWUFFQWIsRUFBQWMsUUFBQSwwQkFFQSxTQUFBTixHQUNBUixFQUFBYyxRQUFBTixFQUFBQyxLQUFBSyxpQkN6QkEsV0FDQXhCLFFBQUFDLE9BQUEsT0FBQSxPQUFBLFNBQUEsVUFBQSxXQUNBUSxXQUFBLFdBQUEsU0FBQSxTQUFBQyxHQUNBQSxFQUFBZSxNQUFBLHNC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RUFDQTFDLEVBQUFzRCxZQUFBLHlCQUtBdEQsRUFBQWlGLGNBQUEsU0FBQXhELEVBQUFuQixHQUNBTixFQUFBNEQsZUFBQSxLQUNBUixFQUFBNUIsUUFBQUMsRUFBQW5CLEVBQUEsU0FBQTBCLEVBQUE1QixHQUNBNEIsRUFDQSxhQUFBQSxFQUNBaEMsRUFBQTZELGNBQUFwQyxFQUFBSSxLQUNBN0IsRUFBQTRELGVBQUEseUJBRUE1RCxFQUFBNkQsWUFBQXBDLEVBQUFJLEtBRUEsV0FBQUcsRUFDQWhDLEVBQUE0RCxlQUFBLHlCQUFBbkMsRUFBQUksTUFBQSxZQUVBN0IsRUFBQTRELGVBQUEsZ0RBQ0FGLFFBQUExQixNQUFBQSxJQUdBcUIsRUFBQSxXQUNBckQsRUFBQTZELFlBQUEsS0FDQTdELEVBQUE0RCxlQUFBLEtBQ0E1RCxFQUFBSSxZQUFBQSxFQUNBSixFQUFBK0UsaUJBQUEsRUFDQW5GLEVBQUFpQixHQUFBIiwiZmlsZSI6InNjcmlwdHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwiaG9tZVwiLCBbIFwidWkucm91dGVyXCIgXSlcbiAgICAgICAgLmNvbmZpZyhbXCIkc3RhdGVQcm92aWRlclwiLCBcIiR1cmxSb3V0ZXJQcm92aWRlclwiLCBmdW5jdGlvbiAoc3RhdGVQcm92aWRlciwgdXJsUm91dGVyUHJvdmlkZXIpIHtcbiAgICAgICAgICAgIHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZShcIi9cIik7XG4gICAgICAgICAgICBzdGF0ZVByb3ZpZGVyXG4gICAgICAgICAgICAgICAgLnN0YXRlKFwiaG9tZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogXCIvXCIsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcImhvbWUuaHRtbFwiLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBcIkhvbWVDdHJsXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfV0pXG4gICAgICAgIC5jb250cm9sbGVyKFwiSG9tZUN0cmxcIiwgWyBcIiRzY29wZVwiLCBcIiRodHRwXCIsIFwiVGVybWluYWxTZXJ2aWNlXCIsIFwiJHN0YXRlXCIsIGZ1bmN0aW9uIChzY29wZSwgaHR0cCwgdGVybWluYWxTZXJ2aWNlLCBzdGF0ZSkge1xuICAgICAgICAgICAgc2NvcGUuZmV0Y2hUZXJtaW5hbHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNyZWRlbnRpYWxzID0ge1xuICAgICAgICAgICAgICAgICAgICBcInVzZXJOYW1lXCI6IHNjb3BlLnVzZXJOYW1lLFxuICAgICAgICAgICAgICAgICAgICBcInBhc3N3b3JkXCI6IHNjb3BlLnBhc3N3b3JkXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB0ZXJtaW5hbFNlcnZpY2UuZmV0Y2hUZXJtaW5hbHMoY3JlZGVudGlhbHMpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlLmRhdGEudGVybWluYWxzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGVybWluYWxTZXJ2aWNlLnNldFRlcm1pbmFscyhyZXNwb25zZS5kYXRhLnRlcm1pbmFscyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5nbyhcIm5ldHdvcmtcIik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5tZXNzYWdlID0gXCJObyBUZXJtaW5hbHMgQXZhaWxhYmxlXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUubWVzc2FnZSA9IHJlc3BvbnNlLmRhdGEubWVzc2FnZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwiYXBwXCIsIFsgXCJob21lXCIsIFwibWFuYWdlXCIsIFwibmV0d29ya1wiLCBcImRldmljZVwiIF0pXG4gICAgICAgIC5jb250cm9sbGVyKFwiQXBwQ3RybFwiLCBbIFwiJHNjb3BlXCIsIGZ1bmN0aW9uIChzY29wZSkge1xuICAgICAgICAgICAgc2NvcGUudGl0bGUgPSBcIlNldHVwIE5ldyBEZXZpY2VcIjtcbiAgICAgICAgfV0pXG4gICAgICAgIC5mYWN0b3J5KFwiVGVybWluYWxTZXJ2aWNlXCIsIFsgXCIkaHR0cFwiLCBmdW5jdGlvbiAoaHR0cCkge1xuXG4gICAgICAgICAgICB2YXIgdGVybWluYWxzID0gW107XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldFRlcm1pbmFscyh0ZXJtaW5hbHNMaXN0KSB7XG4gICAgICAgICAgICAgICAgdGVybWluYWxzID0gdGVybWluYWxzTGlzdDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0VGVybWluYWxzKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0ZXJtaW5hbHM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGZldGNoVGVybWluYWxzKGNyZWRlbnRpYWxzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RldmljZS9mcmVlXCIsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGNyZWRlbnRpYWxzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGNvbmZpZ3VyZURldmljZShob21lQ3JlZGVudGlhbHMsIGRldmljZUlkTGlzdCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcImh0dHA6Ly8xOTIuMTY4LjQuMS9jb25maWd1cmVcIixcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaG9tZUNyZWRlbnRpYWxzXCIgOiBob21lQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImRldmljZUlkTGlzdFwiIDogZGV2aWNlSWRMaXN0XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0RGV2aWNlQ29uZmlndXJhdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcImh0dHA6Ly8xOTIuMTY4LjQuMS9cIlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHNldFRlcm1pbmFsczogc2V0VGVybWluYWxzLFxuICAgICAgICAgICAgICAgIGdldFRlcm1pbmFsczogZ2V0VGVybWluYWxzLFxuICAgICAgICAgICAgICAgIGZldGNoVGVybWluYWxzOiBmZXRjaFRlcm1pbmFscyxcbiAgICAgICAgICAgICAgICBjb25maWd1cmVEZXZpY2U6IGNvbmZpZ3VyZURldmljZSxcbiAgICAgICAgICAgICAgICBnZXREZXZpY2VDb25maWd1cmF0aW9uOiBnZXREZXZpY2VDb25maWd1cmF0aW9uXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XSlcbiAgICAgICAgLmZhY3RvcnkoXCJOZXR3b3JrU2VydmljZVwiLCBbIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgdmFyIFdpRmlDb250cm9sID0gcmVxdWlyZShcIndpZmktY29udHJvbFwiKTtcblxuICAgICAgICAgICAgV2lGaUNvbnRyb2wuaW5pdCgpO1xuXG4gICAgICAgICAgICB2YXIgaG9tZUNyZWRlbnRpYWxzID0ge1xuICAgICAgICAgICAgICAgIFwic3NpZFwiIDogbnVsbCxcbiAgICAgICAgICAgICAgICBcInBhc3N3b3JkXCIgOiBudWxsXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBjb25uZWN0KG5ldHdvcmssIHBhc3N3b3JkLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIGlmKCFjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayA9IGZ1bmN0aW9uICgpIHt9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihuZXR3b3JrLnNlY3VyaXR5ID09PSBcIk9wZW5cIiB8fCBwYXNzd29yZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmV0d29ya0NyZWRlbnRpYWxzID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJzc2lkXCIgOiBuZXR3b3JrLnNzaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInBhc3N3b3JkXCIgOiBwYXNzd29yZFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBXaUZpQ29udHJvbC5jb25uZWN0VG9BUChuZXR3b3JrQ3JlZGVudGlhbHMsIGZ1bmN0aW9uIChlcnJvciwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaW50ZXJmYWNlU3RhdGUgPSBXaUZpQ29udHJvbC5nZXRJZmFjZVN0YXRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYocmVzcG9uc2Uuc3VjY2VzcyAmJiAoaW50ZXJmYWNlU3RhdGUuc3NpZCA9PT0gbmV0d29yay5zc2lkKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihuZXR3b3JrLnNzaWQuaW5kZXhPZihcIm5ld0RldmljZS1cIikgPT09IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBob21lQ3JlZGVudGlhbHMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJzc2lkXCIgOiBuZXR3b3JrLnNzaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJwYXNzd29yZFwiIDogcGFzc3dvcmRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgaG9tZUNyZWRlbnRpYWxzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhcImZhaWxlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKFwicGFzc3dvcmRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRDcmVkZW50aWFscygpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaG9tZUNyZWRlbnRpYWxzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBmaW5kKGlzRGV2aWNlLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIFdpRmlDb250cm9sLnNjYW5Gb3JXaUZpKGZ1bmN0aW9uIChlcnJvciwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBhbGxOZXR3b3JrcyA9IHJlc3BvbnNlLm5ldHdvcmtzO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVuaXF1ZU5ldHdvcmtzID0gKGZ1bmN0aW9uIChuZXR3b3Jrcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1bmlxdWVOZXR3b3JrcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIgbmV0d29ya0luZGV4IGluIG5ldHdvcmtzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpc1VuaXF1ZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXR3b3JrID0gbmV0d29ya3NbbmV0d29ya0luZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKHZhciB1bmlxdWVOZXR3b3JrSW5kZXggaW4gdW5pcXVlTmV0d29ya3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB1bmlxdWVOZXR3b3JrID0gdW5pcXVlTmV0d29ya3NbdW5pcXVlTmV0d29ya0luZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHVuaXF1ZU5ldHdvcmsuc3NpZCA9PT0gbmV0d29yay5zc2lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNVbmlxdWUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihpc1VuaXF1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5pcXVlTmV0d29ya3MucHVzaChuZXR3b3JrKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdW5pcXVlTmV0d29ya3M7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KHJlc3BvbnNlLm5ldHdvcmtzKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVOZXR3b3Jrcy5maWx0ZXIoZnVuY3Rpb24gKG5ldHdvcmspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXNEZXZpY2VOZXR3b3JrID0gKG5ldHdvcmsuc3NpZC5pbmRleE9mKFwibmV3RGV2aWNlLVwiKSA9PT0gMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChpc0RldmljZSA9PT0gaXNEZXZpY2VOZXR3b3JrKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIFwiZmluZFwiIDogZmluZCxcbiAgICAgICAgICAgICAgICBcImNvbm5lY3RcIiA6IGNvbm5lY3QsXG4gICAgICAgICAgICAgICAgXCJnZXRDcmVkZW50aWFsc1wiIDogZ2V0Q3JlZGVudGlhbHNcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwiZGV2aWNlXCIsIFsgXCJ1aS5yb3V0ZXJcIiBdKVxuICAgICAgICAuY29uZmlnKFtcIiRzdGF0ZVByb3ZpZGVyXCIsIFwiJHVybFJvdXRlclByb3ZpZGVyXCIsIGZ1bmN0aW9uIChzdGF0ZVByb3ZpZGVyLCB1cmxSb3V0ZXJQcm92aWRlcikge1xuICAgICAgICAgICAgdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKFwiL1wiKTtcbiAgICAgICAgICAgIHN0YXRlUHJvdmlkZXJcbiAgICAgICAgICAgICAgICAuc3RhdGUoXCJkZXZpY2VcIiwge1xuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiL2RldmljZVwiLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJkZXZpY2UuaHRtbFwiLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBcIkRldmljZUN0cmxcIlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XSlcbiAgICAgICAgLmNvbnRyb2xsZXIoXCJEZXZpY2VDdHJsXCIsIFsgXCIkc2NvcGVcIiwgXCJOZXR3b3JrU2VydmljZVwiLCBcIiR0aW1lb3V0XCIsIFwiJHN0YXRlXCIsIGZ1bmN0aW9uIChzY29wZSwgbmV0d29ya1NlcnZpY2UsIHRpbWVvdXQsIHN0YXRlKSB7XG5cbiAgICAgICAgICAgIHNjb3BlLnNjYW5NZXNzYWdlID0gXCJMb29raW5nIGZvciBkZXZpY2VzLi4uXCI7XG5cbiAgICAgICAgICAgIHNjb3BlLnNjYW5EZXZpY2VzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHNjb3BlLnNjYW5uaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBuZXR3b3JrU2VydmljZS5maW5kKHRydWUsIGZ1bmN0aW9uIChlcnJvciwgZGV2aWNlcykge1xuICAgICAgICAgICAgICAgICAgICBpZihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2Nhbk1lc3NhZ2UgPSBlcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2Nhbm5pbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmRldmljZXMgPSBkZXZpY2VzO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2Nhbk1lc3NhZ2UgPSBcIk5vIERldmljZXMgRm91bmRcIjtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5zY2FuRGV2aWNlcygpO1xuXG4gICAgICAgICAgICBzY29wZS5jb25uZWN0RGV2aWNlID0gZnVuY3Rpb24gKG5ldHdvcmssIHBhc3N3b3JkKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUuY29ubmVjdE1lc3NhZ2UgPSBudWxsO1xuICAgICAgICAgICAgICAgIG5ldHdvcmtTZXJ2aWNlLmNvbm5lY3QobmV0d29yaywgcGFzc3dvcmQsIGZ1bmN0aW9uIChlcnJvciwgY3JlZGVudGlhbHMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGVycm9yID09PSBcInBhc3N3b3JkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihzY29wZS5nZXRQYXNzd29yZCA9PT0gbmV0d29yay5zc2lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNvbm5lY3RNZXNzYWdlID0gXCJFbnRlciBkZXZpY2UgcGFzc3dvcmRcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5nZXRQYXNzd29yZCA9IG5ldHdvcmsuc3NpZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yID09PSBcImZhaWxlZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY29ubmVjdE1lc3NhZ2UgPSBcIkZhaWxlZCB0byBjb25uZWN0IHRvIFwiICsgKG5ldHdvcmsuc3NpZCB8fCBcImRldmljZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY29ubmVjdE1lc3NhZ2UgPSBcIlVuYWJsZSB0byBjb25uZWN0IHRvIGRldmljZSwgdmVyaWZ5IHBhc3N3b3JkXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgaG9tZUNyZWRlbnRpYWxzID0gbmV0d29ya1NlcnZpY2UuZ2V0Q3JlZGVudGlhbHMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldHdvcmtTZXJ2aWNlLmNvbm5lY3QoeyBzc2lkOiBob21lQ3JlZGVudGlhbHMuc3NpZCB9LCBob21lQ3JlZGVudGlhbHMucGFzc3dvcmQpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZ2V0UGFzc3dvcmQgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNvbm5lY3RNZXNzYWdlID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5nbyhcIm1hbmFnZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICBhbmd1bGFyLm1vZHVsZShcIm1hbmFnZVwiLCBbIFwidWkucm91dGVyXCIgXSlcbiAgICAgICAgLmNvbmZpZyhbXCIkc3RhdGVQcm92aWRlclwiLCBcIiR1cmxSb3V0ZXJQcm92aWRlclwiLCBmdW5jdGlvbiAoc3RhdGVQcm92aWRlciwgdXJsUm91dGVyUHJvdmlkZXIpIHtcbiAgICAgICAgICAgIHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZShcIi9cIik7XG4gICAgICAgICAgICBzdGF0ZVByb3ZpZGVyXG4gICAgICAgICAgICAgICAgLnN0YXRlKFwibWFuYWdlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcIi9tYW5hZ2VcIixcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwibWFuYWdlLmh0bWxcIixcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogXCJNYW5hZ2VDdHJsXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfV0pXG4gICAgICAgIC5jb250cm9sbGVyKFwiTWFuYWdlQ3RybFwiLCBbIFwiJHNjb3BlXCIsIFwiVGVybWluYWxTZXJ2aWNlXCIsIFwiTmV0d29ya1NlcnZpY2VcIiwgXCIkdGltZW91dFwiLCBcIiRzdGF0ZVwiLCBmdW5jdGlvbiAoc2NvcGUsIHRlcm1pbmFsU2VydmljZSwgbmV0d29ya1NlcnZpY2UsIHRpbWVvdXQsIHN0YXRlKSB7XG5cbiAgICAgICAgICAgIHNjb3BlLnRlcm1pbmFsTGlzdCA9IHRlcm1pbmFsU2VydmljZS5nZXRUZXJtaW5hbHMoKTtcbiAgICAgICAgICAgIGlmKHNjb3BlLnRlcm1pbmFsTGlzdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBhbGVydChcIllvdSBkbyBub3QgaGF2ZSBhbnkgdGVybWluYWxzIHRvIGNvbmZpZ3VyZVwiKTtcbiAgICAgICAgICAgICAgICBzdGF0ZS5nbyhcImhvbWVcIik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNjb3BlLmhvbWVDcmVkZW50aWFscyA9IG5ldHdvcmtTZXJ2aWNlLmdldENyZWRlbnRpYWxzKCk7XG5cbiAgICAgICAgICAgIHNjb3BlLmRldmljZUlkTGlzdCA9IFtdO1xuXG4gICAgICAgICAgICBzY29wZS5zd2l0Y2hMaXN0ID0gW107XG5cbiAgICAgICAgICAgIHRlcm1pbmFsU2VydmljZS5nZXREZXZpY2VDb25maWd1cmF0aW9uKCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBzY29wZS5zd2l0Y2hMaXN0Lmxlbmd0aCA9IHJlc3BvbnNlLmRhdGEuc3dpdGNoQ291bnQ7XG4gICAgICAgICAgICAgICAgc2NvcGUuZGV2aWNlSWRMaXN0ID0gcmVzcG9uc2UuZGF0YS5kZXZpY2VJZExpc3Q7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBzY29wZS5tZXNzYWdlID0gXCJQbGVhc2UgY2hlY2sgaWYgeW91IGhhdmUgY29ubmVjdGVkIHRvIHRoZSBjb3JyZWN0IGRldmljZVwiO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHNjb3BlLmdldFRlcm1pbmFsUHJvcGVydHkgPSBmdW5jdGlvbiAocHJvcGVydHksIGRldmljZUlkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRlcm1pbmFsSWQgPSAoZGV2aWNlSWQpID8gZGV2aWNlSWQuc3BsaXQoXCIvXCIpWzJdIDogbnVsbDtcbiAgICAgICAgICAgICAgICB2YXIgcHJvcGVydHlWYWx1ZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgaWYodGVybWluYWxJZCkge1xuICAgICAgICAgICAgICAgICAgICBmb3IodmFyIHRlcm1pbmFsSW5kZXggaW4gc2NvcGUudGVybWluYWxMaXN0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdGVybWluYWwgPSBzY29wZS50ZXJtaW5hbExpc3RbdGVybWluYWxJbmRleF07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZih0ZXJtaW5hbC50ZXJtaW5hbElkID09PSB0ZXJtaW5hbElkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydHlWYWx1ZSA9IHRlcm1pbmFsW3Byb3BlcnR5XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvcGVydHlWYWx1ZTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNjb3BlLnNldHVwRGV2aWNlID0gZnVuY3Rpb24gKGhvbWVDcmVkZW50aWFscywgZGV2aWNlSWRMaXN0KSB7XG4gICAgICAgICAgICAgICAgZGV2aWNlSWRMaXN0ID0gZGV2aWNlSWRMaXN0Lm1hcChmdW5jdGlvbiAoZGV2aWNlSWQsIGRldmljZUlkSW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChkZXZpY2VJZCA/IGRldmljZUlkIDogXCIvL1wiKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0ZXJtaW5hbFNlcnZpY2UuY29uZmlndXJlRGV2aWNlKGhvbWVDcmVkZW50aWFscywgZGV2aWNlSWRMaXN0KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNvbmZpZ3VyYXRpb24gU3VjY2Vzc1wiKTtcbiAgICAgICAgICAgICAgICAgICAgbmV0d29ya1NlcnZpY2UuY29ubmVjdCh7IHNzaWQ6IGhvbWVDcmVkZW50aWFscy5zc2lkIH0sIGhvbWVDcmVkZW50aWFscy5wYXNzd29yZCwgZnVuY3Rpb24gKGVycm9yLCBjcmVkZW50aWFscykge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuZ28oXCJob21lXCIpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJDb25maWd1cmF0aW9uIEZhaWxlZFwiKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwibmV0d29ya1wiLCBbIFwidWkucm91dGVyXCIgXSlcbiAgICAgICAgLmNvbmZpZyhbXCIkc3RhdGVQcm92aWRlclwiLCBcIiR1cmxSb3V0ZXJQcm92aWRlclwiLCBmdW5jdGlvbiAoc3RhdGVQcm92aWRlciwgdXJsUm91dGVyUHJvdmlkZXIpIHtcbiAgICAgICAgICAgIHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZShcIi9cIik7XG4gICAgICAgICAgICBzdGF0ZVByb3ZpZGVyXG4gICAgICAgICAgICAgICAgLnN0YXRlKFwibmV0d29ya1wiLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogXCIvbmV0d29ya1wiLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJuZXR3b3JrLmh0bWxcIixcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogXCJOZXR3b3JrQ3RybFwiXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1dKVxuICAgICAgICAuY29udHJvbGxlcihcIk5ldHdvcmtDdHJsXCIsIFsgXCIkc2NvcGVcIiwgXCJOZXR3b3JrU2VydmljZVwiLCBcIiR0aW1lb3V0XCIsIFwiJHN0YXRlXCIsIGZ1bmN0aW9uIChzY29wZSwgbmV0d29ya1NlcnZpY2UsIHRpbWVvdXQsIHN0YXRlKSB7XG5cbiAgICAgICAgICAgIHNjb3BlLnNjYW5NZXNzYWdlID0gXCJMb29raW5nIGZvciBuZXR3b3Jrcy4uLlwiO1xuXG4gICAgICAgICAgICBzY29wZS5jcmVkZW50aWFscyA9IG5ldHdvcmtTZXJ2aWNlLmdldENyZWRlbnRpYWxzKCk7XG5cbiAgICAgICAgICAgIHNjb3BlLmNoYW5nZU5ldHdvcmsgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUuc2hvd05ldHdvcmtMaXN0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBzY29wZS5zY2FuTmV0d29ya3MoKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNjb3BlLnNjYW5OZXR3b3JrcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBzY29wZS5zY2FubmluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgbmV0d29ya1NlcnZpY2UuZmluZChmYWxzZSwgZnVuY3Rpb24gKGVycm9yLCBuZXR3b3Jrcykge1xuICAgICAgICAgICAgICAgICAgICBpZihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2Nhbk1lc3NhZ2UgPSBlcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2Nhbm5pbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm5ldHdvcmtzID0gbmV0d29ya3M7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5zY2FuTWVzc2FnZSA9IFwiTm8gTmV0d29ya3MgRm91bmRcIjtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5zZWxlY3ROZXR3b3JrID0gZnVuY3Rpb24gKG5ldHdvcmssIHBhc3N3b3JkKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUuY29ubmVjdE1lc3NhZ2UgPSBudWxsO1xuICAgICAgICAgICAgICAgIG5ldHdvcmtTZXJ2aWNlLmNvbm5lY3QobmV0d29yaywgcGFzc3dvcmQsIGZ1bmN0aW9uIChlcnJvciwgY3JlZGVudGlhbHMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGVycm9yID09PSBcInBhc3N3b3JkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihzY29wZS5nZXRQYXNzd29yZCA9PT0gbmV0d29yay5zc2lkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNvbm5lY3RNZXNzYWdlID0gXCJFbnRlciBuZXR3b3JrIHBhc3N3b3JkXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZ2V0UGFzc3dvcmQgPSBuZXR3b3JrLnNzaWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvciA9PT0gXCJmYWlsZWRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNvbm5lY3RNZXNzYWdlID0gXCJGYWlsZWQgdG8gY29ubmVjdCB0byBcIiArIChuZXR3b3JrLnNzaWQgfHwgXCJuZXR3b3JrXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jb25uZWN0TWVzc2FnZSA9IFwiVW5hYmxlIHRvIGNvbm5lY3QgdG8gbmV0d29yaywgdmVyaWZ5IHBhc3N3b3JkXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5nZXRQYXNzd29yZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY29ubmVjdE1lc3NhZ2UgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNyZWRlbnRpYWxzID0gY3JlZGVudGlhbHM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2hvd05ldHdvcmtMaXN0ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuZ28oXCJkZXZpY2VcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pO1xufSkoKTtcbiJdfQ==
