!function(){angular.module("home",["common"]).config(["$stateProvider","$urlRouterProvider",function(e,n){n.otherwise("/"),e.state("home",{url:"/",templateUrl:"home.html",controller:"HomeCtrl"})}]).controller("HomeCtrl",["$scope","$http","TerminalService","$state",function(e,n,t,o){var r=document.querySelector("#dialog");e.fetchTerminals=function(){var n={userName:e.userName,password:e.password};t.fetchTerminals(n).then(function(n){n.data.terminals.length?(t.setTerminals(n.data.terminals),o.go("network")):(e.message="No Terminals Available",r.showModal())},function(n){e.message=n.data.message,r.showModal()})},e.closeDialog=function(){r.close(),e.message=""}}])}(),function(){angular.module("common",["ui.router"]).constant("resolve",{terminals:["$q","TerminalService",function(e,n){var t=e.defer();return n.getTerminals().length>0?t.resolve():t.reject({go:"home"}),t.promise}],network:["$q","NetworkService",function(e,n){var t=e.defer(),o=n.getCredentials();return o.ssid&&o.ssid.length>0?t.resolve():t.reject({go:"network"}),t.promise}],device:["$q","TerminalService","$timeout",function(e,n,t){var o=e.defer();return e.race([n.getDeviceConfiguration(),new Promise(function(e,n){setTimeout(n,3e3)})]).then(function(e){o.resolve()},function(e){o.reject({go:"device"})}),o.promise}]})}(),function(){angular.module("app",["home","manage","network","device"]).controller("AppCtrl",["$scope","TerminalService","$state","$rootScope","$timeout",function(e,n,t,o,r){var i=function(e){var n=document.querySelectorAll(".mdl-layout__tab");angular.forEach(n,function(n,t){n=angular.element(n),n.removeClass("is-active"),n.hasClass(e+"-tab")&&n.addClass("is-active")})};e.goTo=function(e){t.go(e,{},{reload:!0})},o.$on("$stateChangeStart",function(n,t,o,i,s){r(function(){e.loading=!0})}),o.$on("$stateChangeSuccess",function(n,t,o,s,c){r(function(){i(s.name),e.currentState=t,componentHandler.upgradeAllRegistered(),e.loading=!1})}),o.$on("$stateChangeError",function(n,t,o,r,i,s){s.go&&(e.goTo(s.go),e.loading=!1)})}]).factory("TerminalService",["$http",function(e){function n(e){c=e}function t(){return c}function o(n){return e({method:"POST",url:"http://raidms.com:8080/device/terminals",data:n})}function r(n,t){return e({method:"POST",url:"http://192.168.4.1/configure",data:{homeCredentials:n,deviceIdList:t}})}function i(){return e({method:"GET",url:"http://192.168.4.1/"})}function s(n){return e({method:"GET",url:"http://192.168.4.1/?i="+n})}var c=[];return{setTerminals:n,getTerminals:t,fetchTerminals:o,configureDevice:r,getDeviceConfiguration:i,testSwitch:s}}]).factory("NetworkService",[function(){function e(e,n,t){if(t||(t=function(){}),"NONE"===e.security||n){var i={ssid:e.ssid,password:n};o.connectToAP(i,function(i,s){if(i)t(i);else{var c=o.getIfaceState();s.success&&c.ssid===e.ssid?(e.ssid.indexOf("newDevice-")===-1&&(r={ssid:e.ssid,password:n}),t(null,r)):t("failed")}})}else t("password")}function n(){return r}function t(e,n){o.scanForWiFi(function(t,o){if(t)n(t);else{var r=(o.networks,function(e){var n=[];for(var t in e){var o=!0,r=e[t];for(var i in n){var s=n[i];if(s.ssid===r.ssid){o=!1;break}}o&&n.push(r)}return n}(o.networks));n(null,r.filter(function(n){var t=0===n.ssid.indexOf("newDevice-");return e===t}))}})}var o=require("wifi-control");o.init({debug:!0});var r={ssid:null,password:null};return console.log(o.findInterface()),{find:t,connect:e,getCredentials:n}}]).directive("timeSince",["$timeout",function(e){return{restrict:"A",link:function(n,t,o,r){function i(n){e.cancel(c),c=e(function(){t.html(s(new Date(o.timeSince)))},n)}function s(e){var n=Math.floor((new Date-e)/1e3),t=Math.floor(n/31536e3),o="";return t>=1?(i(7776e6-50),o=t+" year"+(t>1?"s":"")+" ago"):(t=Math.floor(n/2592e3),t>=1?(i(1296e6-50),o=t+" month"+(t>1?"s":"")+" ago"):(t=Math.floor(n/86400),t>=1?(i(86399950),o=t+" day"+(t>1?"s":"")+" ago"):(t=Math.floor(n/3600),t>=1?(i(3599950),o=t+" hour"+(t>1?"s":"")+" ago"):(t=Math.floor(n/60),t>=1?(i(59950),o=t+" minute"+(t>1?"s":"")+" ago"):(i(950),o=Math.floor(n)+" seconds ago"))))),o}var c;i(0)}}}])}(),function(){angular.module("device",["common"]).config(["$stateProvider","$urlRouterProvider","resolve",function(e,n,t){n.otherwise("/"),e.state("device",{url:"/device",templateUrl:"device.html",controller:"DeviceCtrl",resolve:{terminals:t.terminals,network:t.network}})}]).controller("DeviceCtrl",["$scope","NetworkService","$timeout","$state",function(e,n,t,o){e.scanMessage="Scanning...",e.scanDevices=function(){e.timeoutInstance&&t.cancel(e.timeoutInstance),e.scanMessage="Scanning...",e.scanning=!0,n.find(!0,function(n,o){n&&(e.scanMessage=n,console.error(n)),t(function(){e.scanning=!1,e.devices=o,e.devices.length>0?e.scanMessage=e.devices.length+" Device"+(o.length>1?"s":"")+" Found":e.scanMessage="No Devices Found"})}),e.timeoutInstance=t(function(){e.scanDevices()},3e3)},e.scanDevices(),e.connectDevice=function(r){e.selectedDevice=r,e.connectMessage=null,n.connect(r,"setupnewdevice",function(i,s){if(i){"failed"===i?e.connectMessage="Failed to connect to "+(r.ssid||"device"):(e.connectMessage="Unable to connect to device, hold the reset button and try again",console.error(i));var c=n.getCredentials();n.connect({ssid:c.ssid},c.password)}else t(function(){e.connectMessage=null,o.go("manage")})})}}])}(),function(){angular.module("manage",["common"]).config(["$stateProvider","$urlRouterProvider","resolve",function(e,n,t){n.otherwise("/"),e.state("manage",{url:"/manage",templateUrl:"manage.html",controller:"ManageCtrl",resolve:t})}]).controller("ManageCtrl",["$scope","TerminalService","NetworkService","$timeout","$state",function(e,n,t,o,r){e.terminalList=n.getTerminals(),e.homeCredentials=t.getCredentials(),e.deviceIdList=[],e.switchList=[],n.getDeviceConfiguration().then(function(n){e.switchList.length=n.data.switchCount,e.deviceIdList=n.data.deviceIdList},function(e){r.go("device")}),e.getTerminalProperty=function(n,t){var o=t?t.split("/")[2]:null,r=null;if(o)for(var i in e.terminalList){var s=e.terminalList[i];if(s.terminalId===o){r=s[n];break}}return r},e.setupDevice=function(e,o){o=o.map(function(e,n){return e?e:"//"}),n.configureDevice(e,o).then(function(n){console.log("Configuration Success"),t.connect({ssid:e.ssid},e.password,function(e,n){r.go("home")})},function(e){console.log("Configuration Failed")})},e.toggleSwitch=function(e){n.testSwitch(e).then(function(e){console.log("Switch is turned "+(1===e.data.state?"on":"off"))},function(e){console.log("Unable to access switch")})}}])}(),function(){angular.module("network",["common"]).config(["$stateProvider","$urlRouterProvider","resolve",function(e,n,t){n.otherwise("/"),e.state("network",{url:"/network",templateUrl:"network.html",controller:"NetworkCtrl",resolve:{terminals:t.terminals}})}]).controller("NetworkCtrl",["$scope","NetworkService","$timeout","$state",function(e,n,t,o){e.scanMessage="Scanning...",e.credentials=n.getCredentials();var r=document.querySelector("#networkPasswordDialog");e.changeNetwork=function(){e.scanNetworks()},e.scanNetworks=function(){e.timeoutInstance&&t.cancel(e.timeoutInstance),e.scanMessage="Scanning...",e.scanning=!0,n.find(!1,function(n,o){n&&(e.scanMessage=n,console.error(n)),t(function(){e.scanning=!1,e.networks=o,e.networks.length>0?e.scanMessage=e.networks.length+" Network"+(e.networks.length>1?"s":"")+" Found":e.scanMessage="No Networks Found"})}),e.timeoutInstance=t(function(){e.scanNetworks()},3e3)},e.scanNetworks(),e.selectNetwork=function(i,s){e.selectedNetwork=i,e.connectMessage=null,n.connect(i,s,function(n,s){n?"password"===n?r.showModal():"failed"===n?e.connectMessage="Failed to connect to "+(i.ssid||"network"):(e.connectMessage="Unable to connect to network, verify password",console.error(n)):t(function(){e.connectMessage=null,e.credentials=s,o.go("device")})})},e.closeNetworkPasswordDialog=function(){e.password="",e.connectMessage=null,r.close()}}])}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhvbWUuanMiLCJjb21tb24uanMiLCJpbmRleC5qcyIsImRldmljZS9kZXZpY2UuanMiLCJtYW5hZ2UvbWFuYWdlLmpzIiwibmV0d29yay9uZXR3b3JrLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCJzdGF0ZVByb3ZpZGVyIiwidXJsUm91dGVyUHJvdmlkZXIiLCJvdGhlcndpc2UiLCJzdGF0ZSIsInVybCIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsInNjb3BlIiwiaHR0cCIsInRlcm1pbmFsU2VydmljZSIsImRpYWxvZyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImZldGNoVGVybWluYWxzIiwiY3JlZGVudGlhbHMiLCJ1c2VyTmFtZSIsInBhc3N3b3JkIiwidGhlbiIsInJlc3BvbnNlIiwiZGF0YSIsInRlcm1pbmFscyIsImxlbmd0aCIsInNldFRlcm1pbmFscyIsImdvIiwibWVzc2FnZSIsInNob3dNb2RhbCIsImNsb3NlRGlhbG9nIiwiY2xvc2UiLCJjb25zdGFudCIsInEiLCJkZWZlcnJlZCIsImRlZmVyIiwiZ2V0VGVybWluYWxzIiwicmVzb2x2ZSIsInJlamVjdCIsInByb21pc2UiLCJuZXR3b3JrIiwibmV0d29ya1NlcnZpY2UiLCJnZXRDcmVkZW50aWFscyIsInNzaWQiLCJkZXZpY2UiLCJ0aW1lb3V0IiwicmFjZSIsImdldERldmljZUNvbmZpZ3VyYXRpb24iLCJQcm9taXNlIiwic2V0VGltZW91dCIsInJvb3RTY29wZSIsInNlbGVjdFRhYiIsInRhYk5hbWUiLCJlbGVtZW50TGlzdCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwiZWxlbWVudCIsImluZGV4IiwicmVtb3ZlQ2xhc3MiLCJoYXNDbGFzcyIsImFkZENsYXNzIiwiZ29UbyIsInJvdXRlTmFtZSIsInJlbG9hZCIsIiRvbiIsImV2ZW50IiwidG9TdGF0ZSIsInRvUGFyYW1zIiwiZnJvbVN0YXRlIiwiZnJvbVBhcmFtcyIsImxvYWRpbmciLCJuYW1lIiwiY3VycmVudFN0YXRlIiwiY29tcG9uZW50SGFuZGxlciIsInVwZ3JhZGVBbGxSZWdpc3RlcmVkIiwiZXJyb3IiLCJmYWN0b3J5IiwidGVybWluYWxzTGlzdCIsIm1ldGhvZCIsImNvbmZpZ3VyZURldmljZSIsImhvbWVDcmVkZW50aWFscyIsImRldmljZUlkTGlzdCIsInRlc3RTd2l0Y2giLCJjb25uZWN0IiwiY2FsbGJhY2siLCJzZWN1cml0eSIsIm5ldHdvcmtDcmVkZW50aWFscyIsIldpRmlDb250cm9sIiwiY29ubmVjdFRvQVAiLCJpbnRlcmZhY2VTdGF0ZSIsImdldElmYWNlU3RhdGUiLCJzdWNjZXNzIiwiaW5kZXhPZiIsImZpbmQiLCJpc0RldmljZSIsInNjYW5Gb3JXaUZpIiwidW5pcXVlTmV0d29ya3MiLCJuZXR3b3JrcyIsIm5ldHdvcmtJbmRleCIsImlzVW5pcXVlIiwidW5pcXVlTmV0d29ya0luZGV4IiwidW5pcXVlTmV0d29yayIsInB1c2giLCJmaWx0ZXIiLCJpc0RldmljZU5ldHdvcmsiLCJyZXF1aXJlIiwiaW5pdCIsImRlYnVnIiwiY29uc29sZSIsImxvZyIsImZpbmRJbnRlcmZhY2UiLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsImxpbmsiLCJhdHRycyIsImN0cmwiLCJ1cGRhdGVUaW1lb3V0IiwibmV3VGltZW91dCIsImNhbmNlbCIsInVwZGF0ZXIiLCJodG1sIiwidGltZVNpbmNlIiwiRGF0ZSIsImRhdGUiLCJzZWNvbmRzIiwiTWF0aCIsImZsb29yIiwiaW50ZXJ2YWwiLCJ0aW1lU2luY2VUZXh0Iiwic2Nhbk1lc3NhZ2UiLCJzY2FuRGV2aWNlcyIsInRpbWVvdXRJbnN0YW5jZSIsInNjYW5uaW5nIiwiZGV2aWNlcyIsImNvbm5lY3REZXZpY2UiLCJzZWxlY3RlZERldmljZSIsImNvbm5lY3RNZXNzYWdlIiwidGVybWluYWxMaXN0Iiwic3dpdGNoTGlzdCIsInN3aXRjaENvdW50IiwiZ2V0VGVybWluYWxQcm9wZXJ0eSIsInByb3BlcnR5IiwiZGV2aWNlSWQiLCJ0ZXJtaW5hbElkIiwic3BsaXQiLCJwcm9wZXJ0eVZhbHVlIiwidGVybWluYWxJbmRleCIsInRlcm1pbmFsIiwic2V0dXBEZXZpY2UiLCJtYXAiLCJkZXZpY2VJZEluZGV4IiwidG9nZ2xlU3dpdGNoIiwibmV0d29ya1Bhc3N3b3JkRGlhbG9nIiwiY2hhbmdlTmV0d29yayIsInNjYW5OZXR3b3JrcyIsInNlbGVjdE5ldHdvcmsiLCJzZWxlY3RlZE5ldHdvcmsiLCJjbG9zZU5ldHdvcmtQYXNzd29yZERpYWxvZyJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDQUEsUUFBQUMsT0FBQSxRQUFBLFdBQ0FDLFFBQUEsaUJBQUEscUJBQUEsU0FBQUMsRUFBQUMsR0FDQUEsRUFBQUMsVUFBQSxLQUNBRixFQUNBRyxNQUFBLFFBQ0FDLElBQUEsSUFDQUMsWUFBQSxZQUNBQyxXQUFBLGdCQUdBQSxXQUFBLFlBQUEsU0FBQSxRQUFBLGtCQUFBLFNBQUEsU0FBQUMsRUFBQUMsRUFBQUMsRUFBQU4sR0FDQSxHQUFBTyxHQUFBQyxTQUFBQyxjQUFBLFVBRUFMLEdBQUFNLGVBQUEsV0FDQSxHQUFBQyxJQUNBQyxTQUFBUixFQUFBUSxTQUNBQyxTQUFBVCxFQUFBUyxTQUVBUCxHQUFBSSxlQUFBQyxHQUFBRyxLQUFBLFNBQUFDLEdBQ0FBLEVBQUFDLEtBQUFDLFVBQUFDLFFBQ0FaLEVBQUFhLGFBQUFKLEVBQUFDLEtBQUFDLFdBQ0FqQixFQUFBb0IsR0FBQSxhQUVBaEIsRUFBQWlCLFFBQUEseUJBQ0FkLEVBQUFlLGNBRUEsU0FBQVAsR0FDQVgsRUFBQWlCLFFBQUFOLEVBQUFDLEtBQUFLLFFBQ0FkLEVBQUFlLGVBSUFsQixFQUFBbUIsWUFBQSxXQUNBaEIsRUFBQWlCLFFBQ0FwQixFQUFBaUIsUUFBQSxVQ25DQSxXQUNBM0IsUUFBQUMsT0FBQSxVQUFBLGNBQ0E4QixTQUFBLFdBQ0FSLFdBQUEsS0FBQSxrQkFBQSxTQUFBUyxFQUFBcEIsR0FDQSxHQUFBcUIsR0FBQUQsRUFBQUUsT0FNQSxPQUxBdEIsR0FBQXVC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LEVBQUErSSxlQUVBL0ksRUFBQWdKLGNBQUEsU0FBQW5ILEVBQUFwQixHQUNBVCxFQUFBaUosZ0JBQUFwSCxFQUNBN0IsRUFBQTZILGVBQUEsS0FDQS9GLEVBQUEwQyxRQUFBM0MsRUFBQXBCLEVBQUEsU0FBQXVELEVBQUF6RCxHQUNBeUQsRUFDQSxhQUFBQSxFQUNBNkUsRUFBQTNILFlBQ0EsV0FBQThDLEVBQ0FoRSxFQUFBNkgsZUFBQSx5QkFBQWhHLEVBQUFHLE1BQUEsWUFFQWhDLEVBQUE2SCxlQUFBLGdEQUNBNUIsUUFBQWpDLE1BQUFBLElBR0E5QixFQUFBLFdBQ0FsQyxFQUFBNkgsZUFBQSxLQUNBN0gsRUFBQU8sWUFBQUEsRUFDQVgsRUFBQW9CLEdBQUEsZUFNQWhCLEVBQUFrSiwyQkFBQSxXQUNBbEosRUFBQVMsU0FBQSxHQUNBVCxFQUFBNkgsZUFBQSxLQUNBZ0IsRUFBQXpIIiwiZmlsZSI6InNjcmlwdHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwiaG9tZVwiLCBbIFwiY29tbW9uXCIgXSlcbiAgICAgICAgLmNvbmZpZyhbXCIkc3RhdGVQcm92aWRlclwiLCBcIiR1cmxSb3V0ZXJQcm92aWRlclwiLCBmdW5jdGlvbiAoc3RhdGVQcm92aWRlciwgdXJsUm91dGVyUHJvdmlkZXIpIHtcbiAgICAgICAgICAgIHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZShcIi9cIik7XG4gICAgICAgICAgICBzdGF0ZVByb3ZpZGVyXG4gICAgICAgICAgICAgICAgLnN0YXRlKFwiaG9tZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogXCIvXCIsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcImhvbWUuaHRtbFwiLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBcIkhvbWVDdHJsXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfV0pXG4gICAgICAgIC5jb250cm9sbGVyKFwiSG9tZUN0cmxcIiwgWyBcIiRzY29wZVwiLCBcIiRodHRwXCIsIFwiVGVybWluYWxTZXJ2aWNlXCIsIFwiJHN0YXRlXCIsIGZ1bmN0aW9uIChzY29wZSwgaHR0cCwgdGVybWluYWxTZXJ2aWNlLCBzdGF0ZSkge1xuICAgICAgICAgICAgdmFyIGRpYWxvZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGlhbG9nXCIpO1xuXG4gICAgICAgICAgICBzY29wZS5mZXRjaFRlcm1pbmFscyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgY3JlZGVudGlhbHMgPSB7XG4gICAgICAgICAgICAgICAgICAgIFwidXNlck5hbWVcIjogc2NvcGUudXNlck5hbWUsXG4gICAgICAgICAgICAgICAgICAgIFwicGFzc3dvcmRcIjogc2NvcGUucGFzc3dvcmRcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHRlcm1pbmFsU2VydmljZS5mZXRjaFRlcm1pbmFscyhjcmVkZW50aWFscykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYocmVzcG9uc2UuZGF0YS50ZXJtaW5hbHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXJtaW5hbFNlcnZpY2Uuc2V0VGVybWluYWxzKHJlc3BvbnNlLmRhdGEudGVybWluYWxzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmdvKFwibmV0d29ya1wiKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm1lc3NhZ2UgPSBcIk5vIFRlcm1pbmFscyBBdmFpbGFibGVcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpYWxvZy5zaG93TW9kYWwoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5tZXNzYWdlID0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlO1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2cuc2hvd01vZGFsKCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5jbG9zZURpYWxvZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBkaWFsb2cuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICBzY29wZS5tZXNzYWdlID0gXCJcIjtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwiY29tbW9uXCIsIFsgXCJ1aS5yb3V0ZXJcIiBdKVxuICAgICAgICAuY29uc3RhbnQoXCJyZXNvbHZlXCIsIHtcbiAgICAgICAgICAgIFwidGVybWluYWxzXCIgOiBbIFwiJHFcIiwgXCJUZXJtaW5hbFNlcnZpY2VcIiwgZnVuY3Rpb24gKHEsIHRlcm1pbmFsU2VydmljZSkge1xuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9IHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICBpZih0ZXJtaW5hbFNlcnZpY2UuZ2V0VGVybWluYWxzKCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KHsgZ28gOiBcImhvbWVcIiB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgICAgICB9XSxcbiAgICAgICAgICAgIFwibmV0d29ya1wiIDogWyBcIiRxXCIsIFwiTmV0d29ya1NlcnZpY2VcIiwgZnVuY3Rpb24gKHEsIG5ldHdvcmtTZXJ2aWNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciBjcmVkZW50aWFscyA9IG5ldHdvcmtTZXJ2aWNlLmdldENyZWRlbnRpYWxzKCk7XG4gICAgICAgICAgICAgICAgaWYoY3JlZGVudGlhbHMuc3NpZCAmJiBjcmVkZW50aWFscy5zc2lkLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCh7IGdvIDogXCJuZXR3b3JrXCIgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICBcImRldmljZVwiIDogWyBcIiRxXCIsIFwiVGVybWluYWxTZXJ2aWNlXCIsIFwiJHRpbWVvdXRcIiwgZnVuY3Rpb24gKHEsIHRlcm1pbmFsU2VydmljZSwgdGltZW91dCkge1xuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9IHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICBxLnJhY2UoIFsgdGVybWluYWxTZXJ2aWNlLmdldERldmljZUNvbmZpZ3VyYXRpb24oKSwgKG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChyZWplY3QsIDMwMDApO1xuICAgICAgICAgICAgICAgIH0pKSBdKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCh7IGdvIDogXCJkZXZpY2VcIiB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgICAgICAgIH1dXG4gICAgICAgIH0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIiwgWyBcImhvbWVcIiwgXCJtYW5hZ2VcIiwgXCJuZXR3b3JrXCIsIFwiZGV2aWNlXCIgXSlcbiAgICAgICAgLmNvbnRyb2xsZXIoXCJBcHBDdHJsXCIsIFsgXCIkc2NvcGVcIiwgXCJUZXJtaW5hbFNlcnZpY2VcIiwgXCIkc3RhdGVcIiwgXCIkcm9vdFNjb3BlXCIsIFwiJHRpbWVvdXRcIiwgZnVuY3Rpb24gKHNjb3BlLCB0ZXJtaW5hbFNlcnZpY2UsIHN0YXRlLCByb290U2NvcGUsIHRpbWVvdXQpIHtcblxuICAgICAgICAgICAgdmFyIHNlbGVjdFRhYiA9IGZ1bmN0aW9uICh0YWJOYW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnRMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tZGwtbGF5b3V0X190YWJcIik7XG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGVsZW1lbnRMaXN0LCBmdW5jdGlvbiAoZWxlbWVudCwgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudCA9IGFuZ3VsYXIuZWxlbWVudChlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDbGFzcyhcImlzLWFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoZWxlbWVudC5oYXNDbGFzcyh0YWJOYW1lICsgXCItdGFiXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwiaXMtYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5nb1RvID0gZnVuY3Rpb24gKHJvdXRlTmFtZSkge1xuICAgICAgICAgICAgICAgIHN0YXRlLmdvKHJvdXRlTmFtZSwge30sIHtyZWxvYWQ6IHRydWV9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJvb3RTY29wZS4kb24oXCIkc3RhdGVDaGFuZ2VTdGFydFwiLCBmdW5jdGlvbiAoZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zLCBmcm9tU3RhdGUsIGZyb21QYXJhbXMpIHtcbiAgICAgICAgICAgICAgICB0aW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcm9vdFNjb3BlLiRvbihcIiRzdGF0ZUNoYW5nZVN1Y2Nlc3NcIiwgZnVuY3Rpb24gKGV2ZW50LCB0b1N0YXRlLCB0b1BhcmFtcywgZnJvbVN0YXRlLCBmcm9tUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdFRhYihmcm9tU3RhdGUubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmN1cnJlbnRTdGF0ZSA9IHRvU3RhdGU7XG4gICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudEhhbmRsZXIudXBncmFkZUFsbFJlZ2lzdGVyZWQoKTtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJvb3RTY29wZS4kb24oXCIkc3RhdGVDaGFuZ2VFcnJvclwiLCBmdW5jdGlvbiAoZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zLCBmcm9tU3RhdGUsIGZyb21QYXJhbXMsIGVycm9yKSB7XG4gICAgICAgICAgICAgICAgaWYoZXJyb3IuZ28pIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuZ29UbyhlcnJvci5nbyk7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfV0pXG4gICAgICAgIC5mYWN0b3J5KFwiVGVybWluYWxTZXJ2aWNlXCIsIFsgXCIkaHR0cFwiLCBmdW5jdGlvbiAoaHR0cCkge1xuXG4gICAgICAgICAgICB2YXIgdGVybWluYWxzID0gW107XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHNldFRlcm1pbmFscyh0ZXJtaW5hbHNMaXN0KSB7XG4gICAgICAgICAgICAgICAgdGVybWluYWxzID0gdGVybWluYWxzTGlzdDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0VGVybWluYWxzKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0ZXJtaW5hbHM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGZldGNoVGVybWluYWxzKGNyZWRlbnRpYWxzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiaHR0cDovL3JhaWRtcy5jb206ODA4MC9kZXZpY2UvdGVybWluYWxzXCIsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGNyZWRlbnRpYWxzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGNvbmZpZ3VyZURldmljZShob21lQ3JlZGVudGlhbHMsIGRldmljZUlkTGlzdCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcImh0dHA6Ly8xOTIuMTY4LjQuMS9jb25maWd1cmVcIixcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaG9tZUNyZWRlbnRpYWxzXCIgOiBob21lQ3JlZGVudGlhbHMsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImRldmljZUlkTGlzdFwiIDogZGV2aWNlSWRMaXN0XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0RGV2aWNlQ29uZmlndXJhdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcImh0dHA6Ly8xOTIuMTY4LjQuMS9cIlxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiB0ZXN0U3dpdGNoKGluZGV4KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgICAgICAgICAgICAgIHVybDogXCJodHRwOi8vMTkyLjE2OC40LjEvP2k9XCIgKyBpbmRleFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHNldFRlcm1pbmFsczogc2V0VGVybWluYWxzLFxuICAgICAgICAgICAgICAgIGdldFRlcm1pbmFsczogZ2V0VGVybWluYWxzLFxuICAgICAgICAgICAgICAgIGZldGNoVGVybWluYWxzOiBmZXRjaFRlcm1pbmFscyxcbiAgICAgICAgICAgICAgICBjb25maWd1cmVEZXZpY2U6IGNvbmZpZ3VyZURldmljZSxcbiAgICAgICAgICAgICAgICBnZXREZXZpY2VDb25maWd1cmF0aW9uOiBnZXREZXZpY2VDb25maWd1cmF0aW9uLFxuICAgICAgICAgICAgICAgIHRlc3RTd2l0Y2g6IHRlc3RTd2l0Y2hcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKVxuICAgICAgICAuZmFjdG9yeShcIk5ldHdvcmtTZXJ2aWNlXCIsIFsgZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICB2YXIgV2lGaUNvbnRyb2wgPSByZXF1aXJlKFwid2lmaS1jb250cm9sXCIpO1xuXG4gICAgICAgICAgICBXaUZpQ29udHJvbC5pbml0KHtcbiAgICAgICAgICAgICAgICBkZWJ1ZzogdHJ1ZVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHZhciBob21lQ3JlZGVudGlhbHMgPSB7XG4gICAgICAgICAgICAgICAgXCJzc2lkXCIgOiBudWxsLFxuICAgICAgICAgICAgICAgIFwicGFzc3dvcmRcIiA6IG51bGxcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFdpRmlDb250cm9sLmZpbmRJbnRlcmZhY2UoKSk7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGNvbm5lY3QobmV0d29yaywgcGFzc3dvcmQsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgaWYoIWNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrID0gZnVuY3Rpb24gKCkge307XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmKG5ldHdvcmsuc2VjdXJpdHkgPT09IFwiTk9ORVwiIHx8IHBhc3N3b3JkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXR3b3JrQ3JlZGVudGlhbHMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcInNzaWRcIiA6IG5ldHdvcmsuc3NpZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwicGFzc3dvcmRcIiA6IHBhc3N3b3JkXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIFdpRmlDb250cm9sLmNvbm5lY3RUb0FQKG5ldHdvcmtDcmVkZW50aWFscywgZnVuY3Rpb24gKGVycm9yLCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnRlcmZhY2VTdGF0ZSA9IFdpRmlDb250cm9sLmdldElmYWNlU3RhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihyZXNwb25zZS5zdWNjZXNzICYmIChpbnRlcmZhY2VTdGF0ZS5zc2lkID09PSBuZXR3b3JrLnNzaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKG5ldHdvcmsuc3NpZC5pbmRleE9mKFwibmV3RGV2aWNlLVwiKSA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhvbWVDcmVkZW50aWFscyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInNzaWRcIiA6IG5ldHdvcmsuc3NpZCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInBhc3N3b3JkXCIgOiBwYXNzd29yZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCBob21lQ3JlZGVudGlhbHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKFwiZmFpbGVkXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soXCJwYXNzd29yZFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldENyZWRlbnRpYWxzKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBob21lQ3JlZGVudGlhbHM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGZpbmQoaXNEZXZpY2UsIGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgV2lGaUNvbnRyb2wuc2NhbkZvcldpRmkoZnVuY3Rpb24gKGVycm9yLCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBpZihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFsbE5ldHdvcmtzID0gcmVzcG9uc2UubmV0d29ya3M7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdW5pcXVlTmV0d29ya3MgPSAoZnVuY3Rpb24gKG5ldHdvcmtzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVuaXF1ZU5ldHdvcmtzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBuZXR3b3JrSW5kZXggaW4gbmV0d29ya3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlzVW5pcXVlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ldHdvcmsgPSBuZXR3b3Jrc1tuZXR3b3JrSW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIHVuaXF1ZU5ldHdvcmtJbmRleCBpbiB1bmlxdWVOZXR3b3Jrcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVuaXF1ZU5ldHdvcmsgPSB1bmlxdWVOZXR3b3Jrc1t1bmlxdWVOZXR3b3JrSW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodW5pcXVlTmV0d29yay5zc2lkID09PSBuZXR3b3JrLnNzaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1VuaXF1ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGlzVW5pcXVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmlxdWVOZXR3b3Jrcy5wdXNoKG5ldHdvcmspO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmlxdWVOZXR3b3JrcztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0ocmVzcG9uc2UubmV0d29ya3MpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5ldHdvcmtzLmZpbHRlcihmdW5jdGlvbiAobmV0d29yaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpc0RldmljZU5ldHdvcmsgPSAobmV0d29yay5zc2lkLmluZGV4T2YoXCJuZXdEZXZpY2UtXCIpID09PSAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGlzRGV2aWNlID09PSBpc0RldmljZU5ldHdvcmspO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgXCJmaW5kXCIgOiBmaW5kLFxuICAgICAgICAgICAgICAgIFwiY29ubmVjdFwiIDogY29ubmVjdCxcbiAgICAgICAgICAgICAgICBcImdldENyZWRlbnRpYWxzXCIgOiBnZXRDcmVkZW50aWFsc1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pXG4gICAgICAgIC5kaXJlY3RpdmUoXCJ0aW1lU2luY2VcIiwgW1wiJHRpbWVvdXRcIiwgZnVuY3Rpb24gKHRpbWVvdXQpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgXCJyZXN0cmljdFwiIDogXCJBXCIsXG4gICAgICAgICAgICAgICAgXCJsaW5rXCIgOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjdHJsKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHVwZGF0ZXI7XG5cbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlVGltZW91dCgwKTtcblxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVUaW1lb3V0KG5ld1RpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQuY2FuY2VsKHVwZGF0ZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlciA9IHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuaHRtbCh0aW1lU2luY2UobmV3IERhdGUoYXR0cnMudGltZVNpbmNlKSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgbmV3VGltZW91dCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiB0aW1lU2luY2UoZGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlY29uZHMgPSBNYXRoLmZsb29yKChuZXcgRGF0ZSgpIC0gZGF0ZSkgLyAxMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnRlcnZhbCA9IE1hdGguZmxvb3Ioc2Vjb25kcyAvIDMxNTM2MDAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0aW1lU2luY2VUZXh0ID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnRlcnZhbCA+PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlVGltZW91dCgoMTAwMCAqIDYwICogNjAgKiAyNCAqIDkwKSAtIDUwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lU2luY2VUZXh0ID0gaW50ZXJ2YWwgKyBcIiB5ZWFyXCIgKyAoKGludGVydmFsID4gMSkgPyBcInNcIiA6IFwiXCIpICsgXCIgYWdvXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmFsID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gMjU5MjAwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGludGVydmFsID49IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlVGltZW91dCgoMTAwMCAqIDYwICogNjAgKiAyNCAqIDE1KSAtIDUwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZVNpbmNlVGV4dCA9IGludGVydmFsICsgXCIgbW9udGhcIiArICgoaW50ZXJ2YWwgPiAxKSA/IFwic1wiIDogXCJcIikgKyBcIiBhZ29cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnZhbCA9IE1hdGguZmxvb3Ioc2Vjb25kcyAvIDg2NDAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGludGVydmFsID49IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVRpbWVvdXQoKDEwMDAgKiA2MCAqIDYwICogMjQpIC0gNTApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZVNpbmNlVGV4dCA9IGludGVydmFsICsgXCIgZGF5XCIgKyAoKGludGVydmFsID4gMSkgPyBcInNcIiA6IFwiXCIpICsgXCIgYWdvXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnZhbCA9IE1hdGguZmxvb3Ioc2Vjb25kcyAvIDM2MDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGludGVydmFsID49IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVUaW1lb3V0KCgxMDAwICogNjAgKiA2MCkgLSA1MCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZVNpbmNlVGV4dCA9IGludGVydmFsICsgXCIgaG91clwiICsgKChpbnRlcnZhbCA+IDEpID8gXCJzXCIgOiBcIlwiKSArIFwiIGFnb1wiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnZhbCA9IE1hdGguZmxvb3Ioc2Vjb25kcyAvIDYwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW50ZXJ2YWwgPj0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVUaW1lb3V0KCgxMDAwICogNjApIC0gNTApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lU2luY2VUZXh0ID0gaW50ZXJ2YWwgKyBcIiBtaW51dGVcIiArICgoaW50ZXJ2YWwgPiAxKSA/IFwic1wiIDogXCJcIikgKyBcIiBhZ29cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVUaW1lb3V0KDEwMDAgLSA1MCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVTaW5jZVRleHQgPSBNYXRoLmZsb29yKHNlY29uZHMpICsgXCIgc2Vjb25kcyBhZ29cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGltZVNpbmNlVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwiZGV2aWNlXCIsIFsgXCJjb21tb25cIiBdKVxuICAgICAgICAuY29uZmlnKFtcIiRzdGF0ZVByb3ZpZGVyXCIsIFwiJHVybFJvdXRlclByb3ZpZGVyXCIsIFwicmVzb2x2ZVwiLCBmdW5jdGlvbiAoc3RhdGVQcm92aWRlciwgdXJsUm91dGVyUHJvdmlkZXIsIHJlc29sdmUpIHtcbiAgICAgICAgICAgIHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZShcIi9cIik7XG4gICAgICAgICAgICBzdGF0ZVByb3ZpZGVyXG4gICAgICAgICAgICAgICAgLnN0YXRlKFwiZGV2aWNlXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcIi9kZXZpY2VcIixcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6IFwiZGV2aWNlLmh0bWxcIixcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogXCJEZXZpY2VDdHJsXCIsXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidGVybWluYWxzXCIgOiByZXNvbHZlLnRlcm1pbmFscyxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibmV0d29ya1wiIDogcmVzb2x2ZS5uZXR3b3JrXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfV0pXG4gICAgICAgIC5jb250cm9sbGVyKFwiRGV2aWNlQ3RybFwiLCBbIFwiJHNjb3BlXCIsIFwiTmV0d29ya1NlcnZpY2VcIiwgXCIkdGltZW91dFwiLCBcIiRzdGF0ZVwiLCBmdW5jdGlvbiAoc2NvcGUsIG5ldHdvcmtTZXJ2aWNlLCB0aW1lb3V0LCBzdGF0ZSkge1xuXG4gICAgICAgICAgICBzY29wZS5zY2FuTWVzc2FnZSA9IFwiU2Nhbm5pbmcuLi5cIjtcblxuICAgICAgICAgICAgc2NvcGUuc2NhbkRldmljZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYoc2NvcGUudGltZW91dEluc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWVvdXQuY2FuY2VsKHNjb3BlLnRpbWVvdXRJbnN0YW5jZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNjb3BlLnNjYW5NZXNzYWdlID0gXCJTY2FubmluZy4uLlwiO1xuICAgICAgICAgICAgICAgIHNjb3BlLnNjYW5uaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBuZXR3b3JrU2VydmljZS5maW5kKHRydWUsIGZ1bmN0aW9uIChlcnJvciwgZGV2aWNlcykge1xuICAgICAgICAgICAgICAgICAgICBpZihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2Nhbk1lc3NhZ2UgPSBlcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2Nhbm5pbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmRldmljZXMgPSBkZXZpY2VzO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoc2NvcGUuZGV2aWNlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2Nhbk1lc3NhZ2UgPSBzY29wZS5kZXZpY2VzLmxlbmd0aCArIFwiIERldmljZVwiICsgKGRldmljZXMubGVuZ3RoID4gMSA/IFwic1wiIDogXCJcIikgKyBcIiBGb3VuZFwiO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnNjYW5NZXNzYWdlID0gXCJObyBEZXZpY2VzIEZvdW5kXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHNjb3BlLnRpbWVvdXRJbnN0YW5jZSA9IHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5zY2FuRGV2aWNlcygpO1xuICAgICAgICAgICAgICAgIH0sIDMwMDApO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2NvcGUuc2NhbkRldmljZXMoKTtcblxuICAgICAgICAgICAgc2NvcGUuY29ubmVjdERldmljZSA9IGZ1bmN0aW9uIChuZXR3b3JrKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUuc2VsZWN0ZWREZXZpY2UgPSBuZXR3b3JrO1xuICAgICAgICAgICAgICAgIHNjb3BlLmNvbm5lY3RNZXNzYWdlID0gbnVsbDtcbiAgICAgICAgICAgICAgICBuZXR3b3JrU2VydmljZS5jb25uZWN0KG5ldHdvcmssIFwic2V0dXBuZXdkZXZpY2VcIiwgZnVuY3Rpb24gKGVycm9yLCBjcmVkZW50aWFscykge1xuICAgICAgICAgICAgICAgICAgICBpZihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yID09PSBcImZhaWxlZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY29ubmVjdE1lc3NhZ2UgPSBcIkZhaWxlZCB0byBjb25uZWN0IHRvIFwiICsgKG5ldHdvcmsuc3NpZCB8fCBcImRldmljZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY29ubmVjdE1lc3NhZ2UgPSBcIlVuYWJsZSB0byBjb25uZWN0IHRvIGRldmljZSwgaG9sZCB0aGUgcmVzZXQgYnV0dG9uIGFuZCB0cnkgYWdhaW5cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBob21lQ3JlZGVudGlhbHMgPSBuZXR3b3JrU2VydmljZS5nZXRDcmVkZW50aWFscygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV0d29ya1NlcnZpY2UuY29ubmVjdCh7IHNzaWQ6IGhvbWVDcmVkZW50aWFscy5zc2lkIH0sIGhvbWVDcmVkZW50aWFscy5wYXNzd29yZCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jb25uZWN0TWVzc2FnZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuZ28oXCJtYW5hZ2VcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJtYW5hZ2VcIiwgWyBcImNvbW1vblwiIF0pXG4gICAgICAgIC5jb25maWcoW1wiJHN0YXRlUHJvdmlkZXJcIiwgXCIkdXJsUm91dGVyUHJvdmlkZXJcIiwgXCJyZXNvbHZlXCIsIGZ1bmN0aW9uIChzdGF0ZVByb3ZpZGVyLCB1cmxSb3V0ZXJQcm92aWRlciwgcmVzb2x2ZSkge1xuICAgICAgICAgICAgdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKFwiL1wiKTtcbiAgICAgICAgICAgIHN0YXRlUHJvdmlkZXJcbiAgICAgICAgICAgICAgICAuc3RhdGUoXCJtYW5hZ2VcIiwge1xuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiL21hbmFnZVwiLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJtYW5hZ2UuaHRtbFwiLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBcIk1hbmFnZUN0cmxcIixcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZTogcmVzb2x2ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XSlcbiAgICAgICAgLmNvbnRyb2xsZXIoXCJNYW5hZ2VDdHJsXCIsIFsgXCIkc2NvcGVcIiwgXCJUZXJtaW5hbFNlcnZpY2VcIiwgXCJOZXR3b3JrU2VydmljZVwiLCBcIiR0aW1lb3V0XCIsIFwiJHN0YXRlXCIsIGZ1bmN0aW9uIChzY29wZSwgdGVybWluYWxTZXJ2aWNlLCBuZXR3b3JrU2VydmljZSwgdGltZW91dCwgc3RhdGUpIHtcblxuICAgICAgICAgICAgc2NvcGUudGVybWluYWxMaXN0ID0gdGVybWluYWxTZXJ2aWNlLmdldFRlcm1pbmFscygpO1xuXG4gICAgICAgICAgICBzY29wZS5ob21lQ3JlZGVudGlhbHMgPSBuZXR3b3JrU2VydmljZS5nZXRDcmVkZW50aWFscygpO1xuXG4gICAgICAgICAgICBzY29wZS5kZXZpY2VJZExpc3QgPSBbXTtcblxuICAgICAgICAgICAgc2NvcGUuc3dpdGNoTGlzdCA9IFtdO1xuXG4gICAgICAgICAgICB0ZXJtaW5hbFNlcnZpY2UuZ2V0RGV2aWNlQ29uZmlndXJhdGlvbigpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUuc3dpdGNoTGlzdC5sZW5ndGggPSByZXNwb25zZS5kYXRhLnN3aXRjaENvdW50O1xuICAgICAgICAgICAgICAgIHNjb3BlLmRldmljZUlkTGlzdCA9IHJlc3BvbnNlLmRhdGEuZGV2aWNlSWRMaXN0O1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgc3RhdGUuZ28oXCJkZXZpY2VcIik7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgc2NvcGUuZ2V0VGVybWluYWxQcm9wZXJ0eSA9IGZ1bmN0aW9uIChwcm9wZXJ0eSwgZGV2aWNlSWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGVybWluYWxJZCA9IChkZXZpY2VJZCkgPyBkZXZpY2VJZC5zcGxpdChcIi9cIilbMl0gOiBudWxsO1xuICAgICAgICAgICAgICAgIHZhciBwcm9wZXJ0eVZhbHVlID0gbnVsbDtcbiAgICAgICAgICAgICAgICBpZih0ZXJtaW5hbElkKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcih2YXIgdGVybWluYWxJbmRleCBpbiBzY29wZS50ZXJtaW5hbExpc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZXJtaW5hbCA9IHNjb3BlLnRlcm1pbmFsTGlzdFt0ZXJtaW5hbEluZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRlcm1pbmFsLnRlcm1pbmFsSWQgPT09IHRlcm1pbmFsSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eVZhbHVlID0gdGVybWluYWxbcHJvcGVydHldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0eVZhbHVlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2NvcGUuc2V0dXBEZXZpY2UgPSBmdW5jdGlvbiAoaG9tZUNyZWRlbnRpYWxzLCBkZXZpY2VJZExpc3QpIHtcbiAgICAgICAgICAgICAgICBkZXZpY2VJZExpc3QgPSBkZXZpY2VJZExpc3QubWFwKGZ1bmN0aW9uIChkZXZpY2VJZCwgZGV2aWNlSWRJbmRleCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGRldmljZUlkID8gZGV2aWNlSWQgOiBcIi8vXCIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHRlcm1pbmFsU2VydmljZS5jb25maWd1cmVEZXZpY2UoaG9tZUNyZWRlbnRpYWxzLCBkZXZpY2VJZExpc3QpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ29uZmlndXJhdGlvbiBTdWNjZXNzXCIpO1xuICAgICAgICAgICAgICAgICAgICBuZXR3b3JrU2VydmljZS5jb25uZWN0KHsgc3NpZDogaG9tZUNyZWRlbnRpYWxzLnNzaWQgfSwgaG9tZUNyZWRlbnRpYWxzLnBhc3N3b3JkLCBmdW5jdGlvbiAoZXJyb3IsIGNyZWRlbnRpYWxzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5nbyhcImhvbWVcIik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNvbmZpZ3VyYXRpb24gRmFpbGVkXCIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2NvcGUudG9nZ2xlU3dpdGNoID0gZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgICAgICAgICAgdGVybWluYWxTZXJ2aWNlLnRlc3RTd2l0Y2goaW5kZXgpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU3dpdGNoIGlzIHR1cm5lZCBcIiArICgocmVzcG9uc2UuZGF0YS5zdGF0ZSA9PT0gMSkgPyBcIm9uXCIgOiBcIm9mZlwiKSk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVW5hYmxlIHRvIGFjY2VzcyBzd2l0Y2hcIik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICBhbmd1bGFyLm1vZHVsZShcIm5ldHdvcmtcIiwgWyBcImNvbW1vblwiIF0pXG4gICAgICAgIC5jb25maWcoW1wiJHN0YXRlUHJvdmlkZXJcIiwgXCIkdXJsUm91dGVyUHJvdmlkZXJcIiwgXCJyZXNvbHZlXCIsIGZ1bmN0aW9uIChzdGF0ZVByb3ZpZGVyLCB1cmxSb3V0ZXJQcm92aWRlciwgcmVzb2x2ZSkge1xuICAgICAgICAgICAgdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKFwiL1wiKTtcbiAgICAgICAgICAgIHN0YXRlUHJvdmlkZXJcbiAgICAgICAgICAgICAgICAuc3RhdGUoXCJuZXR3b3JrXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcIi9uZXR3b3JrXCIsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIm5ldHdvcmsuaHRtbFwiLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBcIk5ldHdvcmtDdHJsXCIsXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidGVybWluYWxzXCIgOiByZXNvbHZlLnRlcm1pbmFsc1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1dKVxuICAgICAgICAuY29udHJvbGxlcihcIk5ldHdvcmtDdHJsXCIsIFsgXCIkc2NvcGVcIiwgXCJOZXR3b3JrU2VydmljZVwiLCBcIiR0aW1lb3V0XCIsIFwiJHN0YXRlXCIsIGZ1bmN0aW9uIChzY29wZSwgbmV0d29ya1NlcnZpY2UsIHRpbWVvdXQsIHN0YXRlKSB7XG5cbiAgICAgICAgICAgIHNjb3BlLnNjYW5NZXNzYWdlID0gXCJTY2FubmluZy4uLlwiO1xuXG4gICAgICAgICAgICBzY29wZS5jcmVkZW50aWFscyA9IG5ldHdvcmtTZXJ2aWNlLmdldENyZWRlbnRpYWxzKCk7XG5cbiAgICAgICAgICAgIHZhciBuZXR3b3JrUGFzc3dvcmREaWFsb2cgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25ldHdvcmtQYXNzd29yZERpYWxvZ1wiKTtcblxuICAgICAgICAgICAgc2NvcGUuY2hhbmdlTmV0d29yayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBzY29wZS5zY2FuTmV0d29ya3MoKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNjb3BlLnNjYW5OZXR3b3JrcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZihzY29wZS50aW1lb3V0SW5zdGFuY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGltZW91dC5jYW5jZWwoc2NvcGUudGltZW91dEluc3RhbmNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc2NvcGUuc2Nhbk1lc3NhZ2UgPSBcIlNjYW5uaW5nLi4uXCI7XG4gICAgICAgICAgICAgICAgc2NvcGUuc2Nhbm5pbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIG5ldHdvcmtTZXJ2aWNlLmZpbmQoZmFsc2UsIGZ1bmN0aW9uIChlcnJvciwgbmV0d29ya3MpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnNjYW5NZXNzYWdlID0gZXJyb3I7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnNjYW5uaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5uZXR3b3JrcyA9IG5ldHdvcmtzO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoc2NvcGUubmV0d29ya3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnNjYW5NZXNzYWdlID0gc2NvcGUubmV0d29ya3MubGVuZ3RoICsgXCIgTmV0d29ya1wiICsgKHNjb3BlLm5ldHdvcmtzLmxlbmd0aCA+IDEgPyBcInNcIiA6IFwiXCIpICsgXCIgRm91bmRcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2Nhbk1lc3NhZ2UgPSBcIk5vIE5ldHdvcmtzIEZvdW5kXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHNjb3BlLnRpbWVvdXRJbnN0YW5jZSA9IHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5zY2FuTmV0d29ya3MoKTtcbiAgICAgICAgICAgICAgICB9LCAzMDAwKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNjb3BlLnNjYW5OZXR3b3JrcygpO1xuXG4gICAgICAgICAgICBzY29wZS5zZWxlY3ROZXR3b3JrID0gZnVuY3Rpb24gKG5ldHdvcmssIHBhc3N3b3JkKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUuc2VsZWN0ZWROZXR3b3JrID0gbmV0d29yaztcbiAgICAgICAgICAgICAgICBzY29wZS5jb25uZWN0TWVzc2FnZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgbmV0d29ya1NlcnZpY2UuY29ubmVjdChuZXR3b3JrLCBwYXNzd29yZCwgZnVuY3Rpb24gKGVycm9yLCBjcmVkZW50aWFscykge1xuICAgICAgICAgICAgICAgICAgICBpZihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoZXJyb3IgPT09IFwicGFzc3dvcmRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldHdvcmtQYXNzd29yZERpYWxvZy5zaG93TW9kYWwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3IgPT09IFwiZmFpbGVkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jb25uZWN0TWVzc2FnZSA9IFwiRmFpbGVkIHRvIGNvbm5lY3QgdG8gXCIgKyAobmV0d29yay5zc2lkIHx8IFwibmV0d29ya1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY29ubmVjdE1lc3NhZ2UgPSBcIlVuYWJsZSB0byBjb25uZWN0IHRvIG5ldHdvcmssIHZlcmlmeSBwYXNzd29yZFwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY29ubmVjdE1lc3NhZ2UgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNyZWRlbnRpYWxzID0gY3JlZGVudGlhbHM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuZ28oXCJkZXZpY2VcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2NvcGUuY2xvc2VOZXR3b3JrUGFzc3dvcmREaWFsb2cgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUucGFzc3dvcmQgPSBcIlwiO1xuICAgICAgICAgICAgICAgIHNjb3BlLmNvbm5lY3RNZXNzYWdlID0gbnVsbDtcbiAgICAgICAgICAgICAgICBuZXR3b3JrUGFzc3dvcmREaWFsb2cuY2xvc2UoKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKTtcbn0pKCk7XG4iXX0=
