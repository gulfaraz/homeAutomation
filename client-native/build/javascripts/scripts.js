!function(){angular.module("home",["common"]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("home",{url:"/",templateUrl:"home.html",controller:"HomeCtrl"})}]).controller("HomeCtrl",["$scope","$http","TerminalService","$state",function(e,t,n,o){var r=document.querySelector("#dialog");e.fetchTerminals=function(){var t={userName:e.userName,password:e.password};n.fetchTerminals(t).then(function(t){t.data.terminals.length?(n.setTerminals(t.data.terminals),o.go("device")):(e.message="No Terminals Available",r.showModal())},function(t){e.message=t.data?t.data.message:"Server Unavailable",r.showModal()})},e.closeDialog=function(){r.close(),e.message=""}}])}(),function(){angular.module("common",["ui.router"]).constant("settings",{serverAddress:"raidms.com:8080",deviceServerAddress:"192.168.4.1",deviceNetworkPrefix:"HomeConnect-",deviceNetworkPassword:"setupnewdevice",requestTimeout:3e3,networkScanInterval:6e4,deviceScanInterval:3e3}).constant("resolve",{terminals:["$q","TerminalService",function(e,t){var n=e.defer();return t.getTerminals().length>0?n.resolve():n.reject({go:"home"}),n.promise}],network:["$q","ConfigurationService",function(e,t){var n=e.defer(),o=t.getCredentials();return o.ssid&&o.ssid.length>0?n.resolve():n.reject({go:"network"}),n.promise}],device:["$q","DeviceService","settings",function(e,t,n){var o=e.defer();return e.race([t.getDeviceConfiguration(),new Promise(function(e,t){setTimeout(t,n.requestTimeout)})]).then(function(e){o.resolve()},function(e){o.reject({go:"device"})}),o.promise}]}).factory("DeviceService",["$http","settings",function(e,t){function n(n,o){return e({method:"POST",url:"http://"+t.deviceServerAddress+"/",data:{homeCredentials:n,deviceIdList:o}})}function o(){return e({method:"GET",url:"http://"+t.deviceServerAddress+"/"})}function r(){return e({method:"PUT",url:"http://"+t.deviceServerAddress+"/?s",data:{}})}function i(n){return e({method:"PUT",url:"http://"+t.deviceServerAddress+"/",data:n})}function s(n){return e({method:"GET",url:"http://"+t.deviceServerAddress+"/?i="+n})}return{configureDevice:n,getDeviceConfiguration:o,scanNetworks:r,testNetwork:i,testSwitch:s}}]).factory("TerminalService",["$http","settings",function(e,t){function n(e){i=e}function o(){return i}function r(n){return e({method:"POST",url:"http://"+t.serverAddress+"/device/terminals",data:n})}var i=[];return{setTerminals:n,getTerminals:o,fetchTerminals:r}}]).factory("ConfigurationService",[function(){function e(){return n}function t(e){return n=e}var n={ssid:null,password:null};return{getCredentials:e,setCredentials:t}}]).factory("NetworkService",["settings",function(e){function t(t){r.scanForWiFi(function(n,o){if(n)t(n);else{var r=(o.networks,function(e){var t=[];for(var n in e){var o=!0,r=e[n];for(var i in t){var s=t[i];if(s.ssid===r.ssid){o=!1;break}}o&&t.push(r)}return t}(o.networks));t(null,r.filter(function(t){return 0===t.ssid.indexOf(e.deviceNetworkPrefix)}))}})}function n(t,n){r.connectToAP({ssid:t,password:e.deviceNetworkPassword},function(e,o){if(e)n(e);else{var i=r.getIfaceState();o.success&&i.ssid===t?n(null,t):n("Failed to connect to "+(t||"device"))}})}function o(e,t){r.connectToAP({ssid:e.ssid,password:e.password},function(n,o){if(n)t(n);else{var i=r.getIfaceState();o.success&&i.ssid===e.ssid?t(null,e.ssid):t("Failed to connect to "+(e.ssid||"network"))}})}var r=require("wifi-control");return r.init(),{find:t,connect:n,restore:o}}]).directive("timeSince",["$timeout",function(e){return{restrict:"A",link:function(t,n,o,r){function i(t){e.cancel(c),c=e(function(){n.html(s(new Date(o.timeSince)))},t)}function s(e){var t=Math.floor((new Date-e)/1e3),n=Math.floor(t/31536e3),o="";return n>=1?(i(7776e6-50),o=n+" year"+(n>1?"s":"")+" ago"):(n=Math.floor(t/2592e3),n>=1?(i(1296e6-50),o=n+" month"+(n>1?"s":"")+" ago"):(n=Math.floor(t/86400),n>=1?(i(86399950),o=n+" day"+(n>1?"s":"")+" ago"):(n=Math.floor(t/3600),n>=1?(i(3599950),o=n+" hour"+(n>1?"s":"")+" ago"):(n=Math.floor(t/60),n>=1?(i(59950),o=n+" minute"+(n>1?"s":"")+" ago"):(i(950),o=Math.floor(t)+" seconds ago"))))),o}var c;i(0)}}}])}(),function(){angular.module("app",["home","manage","network","device"]).controller("AppCtrl",["$scope","TerminalService","$state","$rootScope","$timeout",function(e,t,n,o,r){var i=function(e){var t=document.querySelectorAll(".mdl-layout__tab");angular.forEach(t,function(t,n){t=angular.element(t),t.removeClass("is-active"),t.hasClass(e+"-tab")&&t.addClass("is-active")})};e.goTo=function(e){n.go(e,{},{reload:!0})},o.$on("$stateChangeStart",function(t,n,o,i,s){r(function(){e.loading=!0})}),o.$on("$stateChangeSuccess",function(t,n,o,s,c){r(function(){i(s.name),e.currentState=n,componentHandler.upgradeAllRegistered(),e.loading=!1})}),o.$on("$stateChangeError",function(t,n,o,r,i,s){s.go&&(e.goTo(s.go),e.loading=!1)})}])}(),function(){angular.module("device",["common"]).config(["$stateProvider","$urlRouterProvider","resolve",function(e,t,n){t.otherwise("/"),e.state("device",{url:"/device",templateUrl:"device.html",controller:"DeviceCtrl",resolve:{terminals:n.terminals}})}]).controller("DeviceCtrl",["$scope","NetworkService","$timeout","$state","settings",function(e,t,n,o,r){var i=document.querySelector("#dialog");e.scanMessage="Scanning...",e.scanDevices=function(){e.timeoutInstance&&n.cancel(e.timeoutInstance),e.scanMessage="Scanning...",e.scanning=!0,t.find(function(t,o){t&&(e.scanMessage=t,console.error(t)),n(function(){e.scanning=!1,e.devices=o,e.devices.length>0?e.scanMessage=e.devices.length+" Device"+(o.length>1?"s":"")+" Found":e.scanMessage="No Devices Found"})}),e.timeoutInstance=n(function(){e.scanDevices()},r.deviceScanInterval)},e.scanDevices(),e.connectDevice=function(n){e.selectedDevice=n,e.message=null,t.connect(n,function(t,n){t?(e.message="Could not connect to device",console.error(t),i.showModal()):(e.message=null,o.go("network"))})},e.closeDialog=function(){i.close(),e.message=""}}])}(),function(){angular.module("manage",["common"]).config(["$stateProvider","$urlRouterProvider","resolve",function(e,t,n){t.otherwise("/"),e.state("manage",{url:"/manage",templateUrl:"manage.html",controller:"ManageCtrl",resolve:n})}]).controller("ManageCtrl",["$scope","TerminalService","NetworkService","ConfigurationService","DeviceService","$timeout","$state",function(e,t,n,o,r,i,s){e.terminalList=t.getTerminals(),e.homeCredentials=o.getCredentials(),e.deviceIdList=[],e.switchList=[],r.getDeviceConfiguration().then(function(t){e.switchList.length=t.data.switchCount,e.deviceIdList=t.data.deviceIdList},function(e){s.go("network")}),e.getTerminalProperty=function(t,n){var o=n?n.split("/")[2]:null,r=null;if(o)for(var i in e.terminalList){var s=e.terminalList[i];if(s.terminalId===o){r=s[t];break}}return r},e.setupDevice=function(e,t){t=t.map(function(e,t){return e?e:"//"}),r.configureDevice(e,t).then(function(t){console.log("Configuration Success"),n.restore(e,function(e,t){s.go("home")})},function(e){console.log("Configuration Failed")})},e.toggleSwitch=function(e){r.testSwitch(e).then(function(e){console.log("Switch is turned "+(1===e.data.state?"on":"off"))},function(e){console.log("Unable to access switch")})}}])}(),function(){angular.module("network",["common"]).config(["$stateProvider","$urlRouterProvider","resolve",function(e,t,n){t.otherwise("/"),e.state("network",{url:"/network",templateUrl:"network.html",controller:"NetworkCtrl",resolve:{terminals:n.terminals,device:n.device}})}]).controller("NetworkCtrl",["$scope","DeviceService","ConfigurationService","$timeout","$state","settings",function(e,t,n,o,r,i){e.scanMessage="Scanning...",e.credentials=n.getCredentials();var s=document.querySelector("#networkPasswordDialog");e.changeNetwork=function(){e.scanNetworks()},e.scanNetworks=function(){e.timeoutInstance&&o.cancel(e.timeoutInstance),e.scanMessage="Scanning...",e.scanning=!0,t.scanNetworks().then(function(t){e.scanning=!1,e.networks=t.data,e.networks.length>0?e.scanMessage=e.networks.length+" Network"+(e.networks.length>1?"s":"")+" Found":e.scanMessage="No Networks Found"},function(t){e.scanMessage="Failed to scan networks",console.error(t)}),e.timeoutInstance=o(function(){e.scanNetworks()},i.networkScanInterval)},e.scanNetworks(),e.openNetworkPasswordModal=function(t){e.selectedNetwork=t,e.connectMessage=null,s.showModal()},e.testNetwork=function(o){var i={ssid:e.selectedNetwork,password:o};t.testNetwork(i).then(function(t){e.connectMessage=null,e.credentials=n.setCredentials(i),r.go("manage")},function(t){e.connectMessage="Unable to connect to network, verify password",console.error(t)})},e.closeNetworkPasswordDialog=function(){e.password="",e.connectMessage=null,s.close()}}])}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhvbWUuanMiLCJjb21tb24uanMiLCJpbmRleC5qcyIsImRldmljZS9kZXZpY2UuanMiLCJtYW5hZ2UvbWFuYWdlLmpzIiwibmV0d29yay9uZXR3b3JrLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjb25maWciLCJzdGF0ZVByb3ZpZGVyIiwidXJsUm91dGVyUHJvdmlkZXIiLCJvdGhlcndpc2UiLCJzdGF0ZSIsInVybCIsInRlbXBsYXRlVXJsIiwiY29udHJvbGxlciIsInNjb3BlIiwiaHR0cCIsInRlcm1pbmFsU2VydmljZSIsImRpYWxvZyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImZldGNoVGVybWluYWxzIiwiY3JlZGVudGlhbHMiLCJ1c2VyTmFtZSIsInBhc3N3b3JkIiwidGhlbiIsInJlc3BvbnNlIiwiZGF0YSIsInRlcm1pbmFscyIsImxlbmd0aCIsInNldFRlcm1pbmFscyIsImdvIiwibWVzc2FnZSIsInNob3dNb2RhbCIsImNsb3NlRGlhbG9nIiwiY2xvc2UiLCJjb25zdGFudCIsInNlcnZlckFkZHJlc3MiLCJkZXZpY2VTZXJ2ZXJBZGRyZXNzIiwiZGV2aWNlTmV0d29ya1ByZWZpeCIsImRldmljZU5ldHdvcmtQYXNzd29yZCIsInJlcXVlc3RUaW1lb3V0IiwibmV0d29ya1NjYW5JbnRlcnZhbCIsImRldmljZVNjYW5JbnRlcnZhbCIsInEiLCJkZWZlcnJlZCIsImRlZmVyIiwiZ2V0VGVybWluYWxzIiwicmVzb2x2ZSIsInJlamVjdCIsInByb21pc2UiLCJuZXR3b3JrIiwiY29uZmlndXJhdGlvblNlcnZpY2UiLCJnZXRDcmVkZW50aWFscyIsInNzaWQiLCJkZXZpY2UiLCJkZXZpY2VTZXJ2aWNlIiwic2V0dGluZ3MiLCJyYWNlIiwiZ2V0RGV2aWNlQ29uZmlndXJhdGlvbiIsIlByb21pc2UiLCJzZXRUaW1lb3V0IiwiZmFjdG9yeSIsImNvbmZpZ3VyZURldmljZSIsImhvbWVDcmVkZW50aWFscyIsImRldmljZUlkTGlzdCIsIm1ldGhvZCIsInNjYW5OZXR3b3JrcyIsInRlc3ROZXR3b3JrIiwidGVzdFN3aXRjaCIsImluZGV4IiwidGVybWluYWxzTGlzdCIsInNldENyZWRlbnRpYWxzIiwiZmluZCIsImNhbGxiYWNrIiwiV2lGaUNvbnRyb2wiLCJzY2FuRm9yV2lGaSIsImVycm9yIiwidW5pcXVlTmV0d29ya3MiLCJuZXR3b3JrcyIsIm5ldHdvcmtJbmRleCIsImlzVW5pcXVlIiwidW5pcXVlTmV0d29ya0luZGV4IiwidW5pcXVlTmV0d29yayIsInB1c2giLCJmaWx0ZXIiLCJpbmRleE9mIiwiY29ubmVjdCIsImNvbm5lY3RUb0FQIiwiaW50ZXJmYWNlU3RhdGUiLCJnZXRJZmFjZVN0YXRlIiwic3VjY2VzcyIsInJlc3RvcmUiLCJyZXF1aXJlIiwiaW5pdCIsImRpcmVjdGl2ZSIsInRpbWVvdXQiLCJyZXN0cmljdCIsImxpbmsiLCJlbGVtZW50IiwiYXR0cnMiLCJjdHJsIiwidXBkYXRlVGltZW91dCIsIm5ld1RpbWVvdXQiLCJjYW5jZWwiLCJ1cGRhdGVyIiwiaHRtbCIsInRpbWVTaW5jZSIsIkRhdGUiLCJkYXRlIiwic2Vjb25kcyIsIk1hdGgiLCJmbG9vciIsImludGVydmFsIiwidGltZVNpbmNlVGV4dCIsInJvb3RTY29wZSIsInNlbGVjdFRhYiIsInRhYk5hbWUiLCJlbGVtZW50TGlzdCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJmb3JFYWNoIiwicmVtb3ZlQ2xhc3MiLCJoYXNDbGFzcyIsImFkZENsYXNzIiwiZ29UbyIsInJvdXRlTmFtZSIsInJlbG9hZCIsIiRvbiIsImV2ZW50IiwidG9TdGF0ZSIsInRvUGFyYW1zIiwiZnJvbVN0YXRlIiwiZnJvbVBhcmFtcyIsImxvYWRpbmciLCJuYW1lIiwiY3VycmVudFN0YXRlIiwiY29tcG9uZW50SGFuZGxlciIsInVwZ3JhZGVBbGxSZWdpc3RlcmVkIiwibmV0d29ya1NlcnZpY2UiLCJzY2FuTWVzc2FnZSIsInNjYW5EZXZpY2VzIiwidGltZW91dEluc3RhbmNlIiwic2Nhbm5pbmciLCJkZXZpY2VzIiwiY29uc29sZSIsImNvbm5lY3REZXZpY2UiLCJkZXZpY2VTU0lEIiwic2VsZWN0ZWREZXZpY2UiLCJ0ZXJtaW5hbExpc3QiLCJzd2l0Y2hMaXN0Iiwic3dpdGNoQ291bnQiLCJnZXRUZXJtaW5hbFByb3BlcnR5IiwicHJvcGVydHkiLCJkZXZpY2VJZCIsInRlcm1pbmFsSWQiLCJzcGxpdCIsInByb3BlcnR5VmFsdWUiLCJ0ZXJtaW5hbEluZGV4IiwidGVybWluYWwiLCJzZXR1cERldmljZSIsIm1hcCIsImRldmljZUlkSW5kZXgiLCJsb2ciLCJ0b2dnbGVTd2l0Y2giLCJuZXR3b3JrUGFzc3dvcmREaWFsb2ciLCJjaGFuZ2VOZXR3b3JrIiwib3Blbk5ldHdvcmtQYXNzd29yZE1vZGFsIiwibmV0d29ya1NTSUQiLCJzZWxlY3RlZE5ldHdvcmsiLCJjb25uZWN0TWVzc2FnZSIsImNsb3NlTmV0d29ya1Bhc3N3b3JkRGlhbG9nIl0sIm1hcHBpbmdzIjoiQ0FBQSxXQUNBQSxRQUFBQyxPQUFBLFFBQUEsV0FDQUMsUUFBQSxpQkFBQSxxQkFBQSxTQUFBQyxFQUFBQyxHQUNBQSxFQUFBQyxVQUFBLEtBQ0FGLEVBQ0FHLE1BQUEsUUFDQUMsSUFBQSxJQUNBQyxZQUFBLFlBQ0FDLFdBQUEsZ0JBR0FBLFdBQUEsWUFBQSxTQUFBLFFBQUEsa0JBQUEsU0FBQSxTQUFBQyxFQUFBQyxFQUFBQyxFQUFBTixHQUNBLEdBQUFPLEdBQUFDLFNBQUFDLGNBQUEsVUFFQUwsR0FBQU0sZUFBQSxXQUNBLEdBQUFDLElBQ0FDLFNBQUFSLEVBQUFRLFNBQ0FDLFNBQUFULEVBQUFTLFNBRUFQLEdBQUFJLGVBQUFDLEdBQUFHLEtBQUEsU0FBQUMsR0FDQUEsRUFBQUMsS0FBQUMsVUFBQUMsUUFDQVosRUFBQWEsYUFBQUosRUFBQUMsS0FBQUMsV0FDQWpCLEVBQUFvQixHQUFBLFlBRUFoQixFQUFBaUIsUUFBQSx5QkFDQWQsRUFBQWUsY0FFQSxTQUFBUCxHQUNBWCxFQUFBaUIsUUFBQU4sRUFBQUMs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U0FBQUEsRUFDQWdDLEdBQUFZLFlBQUE5QyxHQUFBRyxLQUFBLFNBQUFDLEdBQ0FYLEVBQUEwSixlQUFBLEtBQ0ExSixFQUFBTyxZQUFBOEIsRUFBQW9CLGVBQUFsRCxHQUNBWCxFQUFBb0IsR0FBQSxXQUNBLFNBQUFrQixHQUNBbEMsRUFBQTBKLGVBQUEsZ0RBQ0F6QixRQUFBbkUsTUFBQTVCLE1BSUFsQyxFQUFBMkosMkJBQUEsV0FDQTNKLEVBQUFTLFNBQUEsR0FDQVQsRUFBQTBKLGVBQUEsS0FDQUwsRUFBQWpJIiwiZmlsZSI6InNjcmlwdHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuICAgIGFuZ3VsYXIubW9kdWxlKFwiaG9tZVwiLCBbIFwiY29tbW9uXCIgXSlcbiAgICAgICAgLmNvbmZpZyhbXCIkc3RhdGVQcm92aWRlclwiLCBcIiR1cmxSb3V0ZXJQcm92aWRlclwiLCBmdW5jdGlvbiAoc3RhdGVQcm92aWRlciwgdXJsUm91dGVyUHJvdmlkZXIpIHtcbiAgICAgICAgICAgIHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZShcIi9cIik7XG4gICAgICAgICAgICBzdGF0ZVByb3ZpZGVyXG4gICAgICAgICAgICAgICAgLnN0YXRlKFwiaG9tZVwiLCB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogXCIvXCIsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcImhvbWUuaHRtbFwiLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBcIkhvbWVDdHJsXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfV0pXG4gICAgICAgIC5jb250cm9sbGVyKFwiSG9tZUN0cmxcIiwgWyBcIiRzY29wZVwiLCBcIiRodHRwXCIsIFwiVGVybWluYWxTZXJ2aWNlXCIsIFwiJHN0YXRlXCIsIGZ1bmN0aW9uIChzY29wZSwgaHR0cCwgdGVybWluYWxTZXJ2aWNlLCBzdGF0ZSkge1xuICAgICAgICAgICAgdmFyIGRpYWxvZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGlhbG9nXCIpO1xuXG4gICAgICAgICAgICBzY29wZS5mZXRjaFRlcm1pbmFscyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgY3JlZGVudGlhbHMgPSB7XG4gICAgICAgICAgICAgICAgICAgIFwidXNlck5hbWVcIjogc2NvcGUudXNlck5hbWUsXG4gICAgICAgICAgICAgICAgICAgIFwicGFzc3dvcmRcIjogc2NvcGUucGFzc3dvcmRcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIHRlcm1pbmFsU2VydmljZS5mZXRjaFRlcm1pbmFscyhjcmVkZW50aWFscykudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYocmVzcG9uc2UuZGF0YS50ZXJtaW5hbHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXJtaW5hbFNlcnZpY2Uuc2V0VGVybWluYWxzKHJlc3BvbnNlLmRhdGEudGVybWluYWxzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmdvKFwiZGV2aWNlXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubWVzc2FnZSA9IFwiTm8gVGVybWluYWxzIEF2YWlsYWJsZVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlhbG9nLnNob3dNb2RhbCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLm1lc3NhZ2UgPSByZXNwb25zZS5kYXRhID8gcmVzcG9uc2UuZGF0YS5tZXNzYWdlIDogXCJTZXJ2ZXIgVW5hdmFpbGFibGVcIjtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nLnNob3dNb2RhbCgpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2NvcGUuY2xvc2VEaWFsb2cgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgZGlhbG9nLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgc2NvcGUubWVzc2FnZSA9IFwiXCI7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICBhbmd1bGFyLm1vZHVsZShcImNvbW1vblwiLCBbIFwidWkucm91dGVyXCIgXSlcbiAgICAgICAgLmNvbnN0YW50KFwic2V0dGluZ3NcIiwge1xuICAgICAgICAgICAgXCJzZXJ2ZXJBZGRyZXNzXCIgOiBcInJhaWRtcy5jb206ODA4MFwiLFxuICAgICAgICAgICAgXCJkZXZpY2VTZXJ2ZXJBZGRyZXNzXCIgOiBcIjE5Mi4xNjguNC4xXCIsXG4gICAgICAgICAgICBcImRldmljZU5ldHdvcmtQcmVmaXhcIiA6IFwiSG9tZUNvbm5lY3QtXCIsXG4gICAgICAgICAgICBcImRldmljZU5ldHdvcmtQYXNzd29yZFwiIDogXCJzZXR1cG5ld2RldmljZVwiLFxuICAgICAgICAgICAgXCJyZXF1ZXN0VGltZW91dFwiIDogMzAwMCxcbiAgICAgICAgICAgIFwibmV0d29ya1NjYW5JbnRlcnZhbFwiIDogNjAwMDAsXG4gICAgICAgICAgICBcImRldmljZVNjYW5JbnRlcnZhbFwiIDogMzAwMFxuICAgICAgICB9KVxuICAgICAgICAuY29uc3RhbnQoXCJyZXNvbHZlXCIsIHtcbiAgICAgICAgICAgIFwidGVybWluYWxzXCIgOiBbIFwiJHFcIiwgXCJUZXJtaW5hbFNlcnZpY2VcIiwgZnVuY3Rpb24gKHEsIHRlcm1pbmFsU2VydmljZSkge1xuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9IHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICBpZih0ZXJtaW5hbFNlcnZpY2UuZ2V0VGVybWluYWxzKCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KHsgZ28gOiBcImhvbWVcIiB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgICAgICB9XSxcbiAgICAgICAgICAgIFwibmV0d29ya1wiIDogWyBcIiRxXCIsIFwiQ29uZmlndXJhdGlvblNlcnZpY2VcIiwgZnVuY3Rpb24gKHEsIGNvbmZpZ3VyYXRpb25TZXJ2aWNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgIHZhciBjcmVkZW50aWFscyA9IGNvbmZpZ3VyYXRpb25TZXJ2aWNlLmdldENyZWRlbnRpYWxzKCk7XG4gICAgICAgICAgICAgICAgaWYoY3JlZGVudGlhbHMuc3NpZCAmJiBjcmVkZW50aWFscy5zc2lkLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdCh7IGdvIDogXCJuZXR3b3JrXCIgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICAgICAgfV0sXG4gICAgICAgICAgICBcImRldmljZVwiIDogWyBcIiRxXCIsIFwiRGV2aWNlU2VydmljZVwiLCBcInNldHRpbmdzXCIsIGZ1bmN0aW9uIChxLCBkZXZpY2VTZXJ2aWNlLCBzZXR0aW5ncykge1xuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9IHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICBxLnJhY2UoIFsgZGV2aWNlU2VydmljZS5nZXREZXZpY2VDb25maWd1cmF0aW9uKCksIChuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQocmVqZWN0LCBzZXR0aW5ncy5yZXF1ZXN0VGltZW91dCk7XG4gICAgICAgICAgICAgICAgfSkpIF0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KHsgZ28gOiBcImRldmljZVwiIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICAgICAgfV1cbiAgICAgICAgfSlcbiAgICAgICAgLmZhY3RvcnkoXCJEZXZpY2VTZXJ2aWNlXCIsIFsgXCIkaHR0cFwiLCBcInNldHRpbmdzXCIsIGZ1bmN0aW9uIChodHRwLCBzZXR0aW5ncykge1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBjb25maWd1cmVEZXZpY2UoaG9tZUNyZWRlbnRpYWxzLCBkZXZpY2VJZExpc3QpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaHR0cCh7XG4gICAgICAgICAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgICAgICAgICAgICAgIHVybDogXCJodHRwOi8vXCIgKyBzZXR0aW5ncy5kZXZpY2VTZXJ2ZXJBZGRyZXNzICsgXCIvXCIsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEgOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcImhvbWVDcmVkZW50aWFsc1wiIDogaG9tZUNyZWRlbnRpYWxzLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJkZXZpY2VJZExpc3RcIiA6IGRldmljZUlkTGlzdFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldERldmljZUNvbmZpZ3VyYXRpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgICAgICAgICAgICAgIHVybDogXCJodHRwOi8vXCIgKyBzZXR0aW5ncy5kZXZpY2VTZXJ2ZXJBZGRyZXNzICsgXCIvXCJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gc2Nhbk5ldHdvcmtzKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBcIlBVVFwiLFxuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiaHR0cDovL1wiICsgc2V0dGluZ3MuZGV2aWNlU2VydmVyQWRkcmVzcyArIFwiLz9zXCIsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHt9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHRlc3ROZXR3b3JrKGNyZWRlbnRpYWxzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IFwiUFVUXCIsXG4gICAgICAgICAgICAgICAgICAgIHVybDogXCJodHRwOi8vXCIgKyBzZXR0aW5ncy5kZXZpY2VTZXJ2ZXJBZGRyZXNzICsgXCIvXCIsXG4gICAgICAgICAgICAgICAgICAgIGRhdGEgOiBjcmVkZW50aWFsc1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiB0ZXN0U3dpdGNoKGluZGV4KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGh0dHAoe1xuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgICAgICAgICAgICAgIHVybDogXCJodHRwOi8vXCIgKyBzZXR0aW5ncy5kZXZpY2VTZXJ2ZXJBZGRyZXNzICsgXCIvP2k9XCIgKyBpbmRleFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGNvbmZpZ3VyZURldmljZTogY29uZmlndXJlRGV2aWNlLFxuICAgICAgICAgICAgICAgIGdldERldmljZUNvbmZpZ3VyYXRpb246IGdldERldmljZUNvbmZpZ3VyYXRpb24sXG4gICAgICAgICAgICAgICAgc2Nhbk5ldHdvcmtzOiBzY2FuTmV0d29ya3MsXG4gICAgICAgICAgICAgICAgdGVzdE5ldHdvcms6IHRlc3ROZXR3b3JrLFxuICAgICAgICAgICAgICAgIHRlc3RTd2l0Y2g6IHRlc3RTd2l0Y2hcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKVxuICAgICAgICAuZmFjdG9yeShcIlRlcm1pbmFsU2VydmljZVwiLCBbIFwiJGh0dHBcIiwgXCJzZXR0aW5nc1wiLCBmdW5jdGlvbiAoaHR0cCwgc2V0dGluZ3MpIHtcblxuICAgICAgICAgICAgdmFyIHRlcm1pbmFscyA9IFtdO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBzZXRUZXJtaW5hbHModGVybWluYWxzTGlzdCkge1xuICAgICAgICAgICAgICAgIHRlcm1pbmFscyA9IHRlcm1pbmFsc0xpc3Q7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGdldFRlcm1pbmFscygpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGVybWluYWxzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiBmZXRjaFRlcm1pbmFscyhjcmVkZW50aWFscykge1xuICAgICAgICAgICAgICAgIHJldHVybiBodHRwKHtcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcImh0dHA6Ly9cIiArIHNldHRpbmdzLnNlcnZlckFkZHJlc3MgKyBcIi9kZXZpY2UvdGVybWluYWxzXCIsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IGNyZWRlbnRpYWxzXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgc2V0VGVybWluYWxzOiBzZXRUZXJtaW5hbHMsXG4gICAgICAgICAgICAgICAgZ2V0VGVybWluYWxzOiBnZXRUZXJtaW5hbHMsXG4gICAgICAgICAgICAgICAgZmV0Y2hUZXJtaW5hbHM6IGZldGNoVGVybWluYWxzXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XSlcbiAgICAgICAgLmZhY3RvcnkoXCJDb25maWd1cmF0aW9uU2VydmljZVwiLCBbIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgdmFyIGhvbWVDcmVkZW50aWFscyA9IHtcbiAgICAgICAgICAgICAgICBcInNzaWRcIiA6IG51bGwsXG4gICAgICAgICAgICAgICAgXCJwYXNzd29yZFwiIDogbnVsbFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZnVuY3Rpb24gZ2V0Q3JlZGVudGlhbHMoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhvbWVDcmVkZW50aWFscztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gc2V0Q3JlZGVudGlhbHMoY3JlZGVudGlhbHMpIHtcbiAgICAgICAgICAgICAgICBob21lQ3JlZGVudGlhbHMgPSBjcmVkZW50aWFscztcbiAgICAgICAgICAgICAgICByZXR1cm4gaG9tZUNyZWRlbnRpYWxzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGdldENyZWRlbnRpYWxzOiBnZXRDcmVkZW50aWFscyxcbiAgICAgICAgICAgICAgICBzZXRDcmVkZW50aWFsczogc2V0Q3JlZGVudGlhbHNcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKVxuICAgICAgICAuZmFjdG9yeShcIk5ldHdvcmtTZXJ2aWNlXCIsIFsgXCJzZXR0aW5nc1wiLCBmdW5jdGlvbiAoc2V0dGluZ3MpIHtcblxuICAgICAgICAgICAgdmFyIFdpRmlDb250cm9sID0gcmVxdWlyZShcIndpZmktY29udHJvbFwiKTtcblxuICAgICAgICAgICAgV2lGaUNvbnRyb2wuaW5pdCgpO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBmaW5kKGNhbGxiYWNrKSB7XG4gICAgICAgICAgICAgICAgV2lGaUNvbnRyb2wuc2NhbkZvcldpRmkoZnVuY3Rpb24gKGVycm9yLCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBpZihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFsbE5ldHdvcmtzID0gcmVzcG9uc2UubmV0d29ya3M7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdW5pcXVlTmV0d29ya3MgPSAoZnVuY3Rpb24gKG5ldHdvcmtzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVuaXF1ZU5ldHdvcmtzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yKHZhciBuZXR3b3JrSW5kZXggaW4gbmV0d29ya3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlzVW5pcXVlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ldHdvcmsgPSBuZXR3b3Jrc1tuZXR3b3JrSW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIHVuaXF1ZU5ldHdvcmtJbmRleCBpbiB1bmlxdWVOZXR3b3Jrcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHVuaXF1ZU5ldHdvcmsgPSB1bmlxdWVOZXR3b3Jrc1t1bmlxdWVOZXR3b3JrSW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYodW5pcXVlTmV0d29yay5zc2lkID09PSBuZXR3b3JrLnNzaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1VuaXF1ZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKGlzVW5pcXVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmlxdWVOZXR3b3Jrcy5wdXNoKG5ldHdvcmspO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmlxdWVOZXR3b3JrcztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0ocmVzcG9uc2UubmV0d29ya3MpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5ldHdvcmtzLmZpbHRlcihmdW5jdGlvbiAobmV0d29yaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAobmV0d29yay5zc2lkLmluZGV4T2Yoc2V0dGluZ3MuZGV2aWNlTmV0d29ya1ByZWZpeCkgPT09IDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGNvbm5lY3Qoc3NpZCwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBXaUZpQ29udHJvbC5jb25uZWN0VG9BUCh7XG4gICAgICAgICAgICAgICAgICAgIFwic3NpZFwiIDogc3NpZCxcbiAgICAgICAgICAgICAgICAgICAgXCJwYXNzd29yZFwiIDogc2V0dGluZ3MuZGV2aWNlTmV0d29ya1Bhc3N3b3JkXG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yLCByZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBpZihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGludGVyZmFjZVN0YXRlID0gV2lGaUNvbnRyb2wuZ2V0SWZhY2VTdGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYocmVzcG9uc2Uuc3VjY2VzcyAmJiAoaW50ZXJmYWNlU3RhdGUuc3NpZCA9PT0gc3NpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCBzc2lkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soXCJGYWlsZWQgdG8gY29ubmVjdCB0byBcIiArIChzc2lkIHx8IFwiZGV2aWNlXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmdW5jdGlvbiByZXN0b3JlKGNyZWRlbnRpYWxzLCBjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIFdpRmlDb250cm9sLmNvbm5lY3RUb0FQKHtcbiAgICAgICAgICAgICAgICAgICAgXCJzc2lkXCIgOiBjcmVkZW50aWFscy5zc2lkLFxuICAgICAgICAgICAgICAgICAgICBcInBhc3N3b3JkXCIgOiBjcmVkZW50aWFscy5wYXNzd29yZFxuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvciwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbnRlcmZhY2VTdGF0ZSA9IFdpRmlDb250cm9sLmdldElmYWNlU3RhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlLnN1Y2Nlc3MgJiYgKGludGVyZmFjZVN0YXRlLnNzaWQgPT09IGNyZWRlbnRpYWxzLnNzaWQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgY3JlZGVudGlhbHMuc3NpZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKFwiRmFpbGVkIHRvIGNvbm5lY3QgdG8gXCIgKyAoY3JlZGVudGlhbHMuc3NpZCB8fCBcIm5ldHdvcmtcIikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgXCJmaW5kXCIgOiBmaW5kLFxuICAgICAgICAgICAgICAgIFwiY29ubmVjdFwiIDogY29ubmVjdCxcbiAgICAgICAgICAgICAgICBcInJlc3RvcmVcIiA6IHJlc3RvcmVcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1dKVxuICAgICAgICAuZGlyZWN0aXZlKFwidGltZVNpbmNlXCIsIFsgXCIkdGltZW91dFwiLCBmdW5jdGlvbiAodGltZW91dCkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBcInJlc3RyaWN0XCIgOiBcIkFcIixcbiAgICAgICAgICAgICAgICBcImxpbmtcIiA6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmwpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgdXBkYXRlcjtcblxuICAgICAgICAgICAgICAgICAgICB1cGRhdGVUaW1lb3V0KDApO1xuXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVRpbWVvdXQobmV3VGltZW91dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGltZW91dC5jYW5jZWwodXBkYXRlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVyID0gdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5odG1sKHRpbWVTaW5jZShuZXcgRGF0ZShhdHRycy50aW1lU2luY2UpKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBuZXdUaW1lb3V0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHRpbWVTaW5jZShkYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2Vjb25kcyA9IE1hdGguZmxvb3IoKG5ldyBEYXRlKCkgLSBkYXRlKSAvIDEwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGludGVydmFsID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gMzE1MzYwMDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRpbWVTaW5jZVRleHQgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGludGVydmFsID49IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVUaW1lb3V0KCgxMDAwICogNjAgKiA2MCAqIDI0ICogOTApIC0gNTApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVTaW5jZVRleHQgPSBpbnRlcnZhbCArIFwiIHllYXJcIiArICgoaW50ZXJ2YWwgPiAxKSA/IFwic1wiIDogXCJcIikgKyBcIiBhZ29cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50ZXJ2YWwgPSBNYXRoLmZsb29yKHNlY29uZHMgLyAyNTkyMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW50ZXJ2YWwgPj0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVUaW1lb3V0KCgxMDAwICogNjAgKiA2MCAqIDI0ICogMTUpIC0gNTApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lU2luY2VUZXh0ID0gaW50ZXJ2YWwgKyBcIiBtb250aFwiICsgKChpbnRlcnZhbCA+IDEpID8gXCJzXCIgOiBcIlwiKSArIFwiIGFnb1wiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmFsID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gODY0MDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW50ZXJ2YWwgPj0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlVGltZW91dCgoMTAwMCAqIDYwICogNjAgKiAyNCkgLSA1MCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lU2luY2VUZXh0ID0gaW50ZXJ2YWwgKyBcIiBkYXlcIiArICgoaW50ZXJ2YWwgPiAxKSA/IFwic1wiIDogXCJcIikgKyBcIiBhZ29cIjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmFsID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gMzYwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaW50ZXJ2YWwgPj0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVRpbWVvdXQoKDEwMDAgKiA2MCAqIDYwKSAtIDUwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lU2luY2VUZXh0ID0gaW50ZXJ2YWwgKyBcIiBob3VyXCIgKyAoKGludGVydmFsID4gMSkgPyBcInNcIiA6IFwiXCIpICsgXCIgYWdvXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludGVydmFsID0gTWF0aC5mbG9vcihzZWNvbmRzIC8gNjApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbnRlcnZhbCA+PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVRpbWVvdXQoKDEwMDAgKiA2MCkgLSA1MCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVTaW5jZVRleHQgPSBpbnRlcnZhbCArIFwiIG1pbnV0ZVwiICsgKChpbnRlcnZhbCA+IDEpID8gXCJzXCIgOiBcIlwiKSArIFwiIGFnb1wiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVRpbWVvdXQoMTAwMCAtIDUwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZVNpbmNlVGV4dCA9IE1hdGguZmxvb3Ioc2Vjb25kcykgKyBcIiBzZWNvbmRzIGFnb1wiO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aW1lU2luY2VUZXh0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJhcHBcIiwgWyBcImhvbWVcIiwgXCJtYW5hZ2VcIiwgXCJuZXR3b3JrXCIsIFwiZGV2aWNlXCIgXSlcbiAgICAgICAgLmNvbnRyb2xsZXIoXCJBcHBDdHJsXCIsIFsgXCIkc2NvcGVcIiwgXCJUZXJtaW5hbFNlcnZpY2VcIiwgXCIkc3RhdGVcIiwgXCIkcm9vdFNjb3BlXCIsIFwiJHRpbWVvdXRcIiwgZnVuY3Rpb24gKHNjb3BlLCB0ZXJtaW5hbFNlcnZpY2UsIHN0YXRlLCByb290U2NvcGUsIHRpbWVvdXQpIHtcblxuICAgICAgICAgICAgdmFyIHNlbGVjdFRhYiA9IGZ1bmN0aW9uICh0YWJOYW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnRMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tZGwtbGF5b3V0X190YWJcIik7XG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGVsZW1lbnRMaXN0LCBmdW5jdGlvbiAoZWxlbWVudCwgaW5kZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudCA9IGFuZ3VsYXIuZWxlbWVudChlbGVtZW50KTtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDbGFzcyhcImlzLWFjdGl2ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoZWxlbWVudC5oYXNDbGFzcyh0YWJOYW1lICsgXCItdGFiXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKFwiaXMtYWN0aXZlXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5nb1RvID0gZnVuY3Rpb24gKHJvdXRlTmFtZSkge1xuICAgICAgICAgICAgICAgIHN0YXRlLmdvKHJvdXRlTmFtZSwge30sIHtyZWxvYWQ6IHRydWV9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJvb3RTY29wZS4kb24oXCIkc3RhdGVDaGFuZ2VTdGFydFwiLCBmdW5jdGlvbiAoZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zLCBmcm9tU3RhdGUsIGZyb21QYXJhbXMpIHtcbiAgICAgICAgICAgICAgICB0aW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUubG9hZGluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcm9vdFNjb3BlLiRvbihcIiRzdGF0ZUNoYW5nZVN1Y2Nlc3NcIiwgZnVuY3Rpb24gKGV2ZW50LCB0b1N0YXRlLCB0b1BhcmFtcywgZnJvbVN0YXRlLCBmcm9tUGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdFRhYihmcm9tU3RhdGUubmFtZSk7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmN1cnJlbnRTdGF0ZSA9IHRvU3RhdGU7XG4gICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudEhhbmRsZXIudXBncmFkZUFsbFJlZ2lzdGVyZWQoKTtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUubG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJvb3RTY29wZS4kb24oXCIkc3RhdGVDaGFuZ2VFcnJvclwiLCBmdW5jdGlvbiAoZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zLCBmcm9tU3RhdGUsIGZyb21QYXJhbXMsIGVycm9yKSB7XG4gICAgICAgICAgICAgICAgaWYoZXJyb3IuZ28pIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuZ29UbyhlcnJvci5nbyk7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfV0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJkZXZpY2VcIiwgWyBcImNvbW1vblwiIF0pXG4gICAgICAgIC5jb25maWcoW1wiJHN0YXRlUHJvdmlkZXJcIiwgXCIkdXJsUm91dGVyUHJvdmlkZXJcIiwgXCJyZXNvbHZlXCIsIGZ1bmN0aW9uIChzdGF0ZVByb3ZpZGVyLCB1cmxSb3V0ZXJQcm92aWRlciwgcmVzb2x2ZSkge1xuICAgICAgICAgICAgdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKFwiL1wiKTtcbiAgICAgICAgICAgIHN0YXRlUHJvdmlkZXJcbiAgICAgICAgICAgICAgICAuc3RhdGUoXCJkZXZpY2VcIiwge1xuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiL2RldmljZVwiLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJkZXZpY2UuaHRtbFwiLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBcIkRldmljZUN0cmxcIixcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJ0ZXJtaW5hbHNcIiA6IHJlc29sdmUudGVybWluYWxzXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfV0pXG4gICAgICAgIC5jb250cm9sbGVyKFwiRGV2aWNlQ3RybFwiLCBbIFwiJHNjb3BlXCIsIFwiTmV0d29ya1NlcnZpY2VcIiwgXCIkdGltZW91dFwiLCBcIiRzdGF0ZVwiLCBcInNldHRpbmdzXCIsIGZ1bmN0aW9uIChzY29wZSwgbmV0d29ya1NlcnZpY2UsIHRpbWVvdXQsIHN0YXRlLCBzZXR0aW5ncykge1xuICAgICAgICAgICAgdmFyIGRpYWxvZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGlhbG9nXCIpO1xuXG4gICAgICAgICAgICBzY29wZS5zY2FuTWVzc2FnZSA9IFwiU2Nhbm5pbmcuLi5cIjtcblxuICAgICAgICAgICAgc2NvcGUuc2NhbkRldmljZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYoc2NvcGUudGltZW91dEluc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWVvdXQuY2FuY2VsKHNjb3BlLnRpbWVvdXRJbnN0YW5jZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNjb3BlLnNjYW5NZXNzYWdlID0gXCJTY2FubmluZy4uLlwiO1xuICAgICAgICAgICAgICAgIHNjb3BlLnNjYW5uaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBuZXR3b3JrU2VydmljZS5maW5kKGZ1bmN0aW9uIChlcnJvciwgZGV2aWNlcykge1xuICAgICAgICAgICAgICAgICAgICBpZihlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2Nhbk1lc3NhZ2UgPSBlcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2Nhbm5pbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmRldmljZXMgPSBkZXZpY2VzO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoc2NvcGUuZGV2aWNlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2Nhbk1lc3NhZ2UgPSBzY29wZS5kZXZpY2VzLmxlbmd0aCArIFwiIERldmljZVwiICsgKGRldmljZXMubGVuZ3RoID4gMSA/IFwic1wiIDogXCJcIikgKyBcIiBGb3VuZFwiO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnNjYW5NZXNzYWdlID0gXCJObyBEZXZpY2VzIEZvdW5kXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHNjb3BlLnRpbWVvdXRJbnN0YW5jZSA9IHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5zY2FuRGV2aWNlcygpO1xuICAgICAgICAgICAgICAgIH0sIHNldHRpbmdzLmRldmljZVNjYW5JbnRlcnZhbCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5zY2FuRGV2aWNlcygpO1xuXG4gICAgICAgICAgICBzY29wZS5jb25uZWN0RGV2aWNlID0gZnVuY3Rpb24gKGRldmljZVNTSUQpIHtcbiAgICAgICAgICAgICAgICBzY29wZS5zZWxlY3RlZERldmljZSA9IGRldmljZVNTSUQ7XG4gICAgICAgICAgICAgICAgc2NvcGUubWVzc2FnZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgbmV0d29ya1NlcnZpY2UuY29ubmVjdChkZXZpY2VTU0lELCBmdW5jdGlvbiAoZXJyb3IsIGNyZWRlbnRpYWxzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5tZXNzYWdlID0gXCJDb3VsZCBub3QgY29ubmVjdCB0byBkZXZpY2VcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlhbG9nLnNob3dNb2RhbCgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUubWVzc2FnZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5nbyhcIm5ldHdvcmtcIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHNjb3BlLmNsb3NlRGlhbG9nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGRpYWxvZy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIHNjb3BlLm1lc3NhZ2UgPSBcIlwiO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgYW5ndWxhci5tb2R1bGUoXCJtYW5hZ2VcIiwgWyBcImNvbW1vblwiIF0pXG4gICAgICAgIC5jb25maWcoW1wiJHN0YXRlUHJvdmlkZXJcIiwgXCIkdXJsUm91dGVyUHJvdmlkZXJcIiwgXCJyZXNvbHZlXCIsIGZ1bmN0aW9uIChzdGF0ZVByb3ZpZGVyLCB1cmxSb3V0ZXJQcm92aWRlciwgcmVzb2x2ZSkge1xuICAgICAgICAgICAgdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKFwiL1wiKTtcbiAgICAgICAgICAgIHN0YXRlUHJvdmlkZXJcbiAgICAgICAgICAgICAgICAuc3RhdGUoXCJtYW5hZ2VcIiwge1xuICAgICAgICAgICAgICAgICAgICB1cmw6IFwiL21hbmFnZVwiLFxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogXCJtYW5hZ2UuaHRtbFwiLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBcIk1hbmFnZUN0cmxcIixcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZTogcmVzb2x2ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XSlcbiAgICAgICAgLmNvbnRyb2xsZXIoXCJNYW5hZ2VDdHJsXCIsIFsgXCIkc2NvcGVcIiwgXCJUZXJtaW5hbFNlcnZpY2VcIiwgXCJOZXR3b3JrU2VydmljZVwiLCBcIkNvbmZpZ3VyYXRpb25TZXJ2aWNlXCIsIFwiRGV2aWNlU2VydmljZVwiLCBcIiR0aW1lb3V0XCIsIFwiJHN0YXRlXCIsIGZ1bmN0aW9uIChzY29wZSwgdGVybWluYWxTZXJ2aWNlLCBuZXR3b3JrU2VydmljZSwgY29uZmlndXJhdGlvblNlcnZpY2UsIGRldmljZVNlcnZpY2UsIHRpbWVvdXQsIHN0YXRlKSB7XG5cbiAgICAgICAgICAgIHNjb3BlLnRlcm1pbmFsTGlzdCA9IHRlcm1pbmFsU2VydmljZS5nZXRUZXJtaW5hbHMoKTtcblxuICAgICAgICAgICAgc2NvcGUuaG9tZUNyZWRlbnRpYWxzID0gY29uZmlndXJhdGlvblNlcnZpY2UuZ2V0Q3JlZGVudGlhbHMoKTtcblxuICAgICAgICAgICAgc2NvcGUuZGV2aWNlSWRMaXN0ID0gW107XG5cbiAgICAgICAgICAgIHNjb3BlLnN3aXRjaExpc3QgPSBbXTtcblxuICAgICAgICAgICAgZGV2aWNlU2VydmljZS5nZXREZXZpY2VDb25maWd1cmF0aW9uKCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBzY29wZS5zd2l0Y2hMaXN0Lmxlbmd0aCA9IHJlc3BvbnNlLmRhdGEuc3dpdGNoQ291bnQ7XG4gICAgICAgICAgICAgICAgc2NvcGUuZGV2aWNlSWRMaXN0ID0gcmVzcG9uc2UuZGF0YS5kZXZpY2VJZExpc3Q7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBzdGF0ZS5nbyhcIm5ldHdvcmtcIik7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgc2NvcGUuZ2V0VGVybWluYWxQcm9wZXJ0eSA9IGZ1bmN0aW9uIChwcm9wZXJ0eSwgZGV2aWNlSWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGVybWluYWxJZCA9IChkZXZpY2VJZCkgPyBkZXZpY2VJZC5zcGxpdChcIi9cIilbMl0gOiBudWxsO1xuICAgICAgICAgICAgICAgIHZhciBwcm9wZXJ0eVZhbHVlID0gbnVsbDtcbiAgICAgICAgICAgICAgICBpZih0ZXJtaW5hbElkKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvcih2YXIgdGVybWluYWxJbmRleCBpbiBzY29wZS50ZXJtaW5hbExpc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0ZXJtaW5hbCA9IHNjb3BlLnRlcm1pbmFsTGlzdFt0ZXJtaW5hbEluZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHRlcm1pbmFsLnRlcm1pbmFsSWQgPT09IHRlcm1pbmFsSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0eVZhbHVlID0gdGVybWluYWxbcHJvcGVydHldO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBwcm9wZXJ0eVZhbHVlO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2NvcGUuc2V0dXBEZXZpY2UgPSBmdW5jdGlvbiAoaG9tZUNyZWRlbnRpYWxzLCBkZXZpY2VJZExpc3QpIHtcbiAgICAgICAgICAgICAgICBkZXZpY2VJZExpc3QgPSBkZXZpY2VJZExpc3QubWFwKGZ1bmN0aW9uIChkZXZpY2VJZCwgZGV2aWNlSWRJbmRleCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGRldmljZUlkID8gZGV2aWNlSWQgOiBcIi8vXCIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGRldmljZVNlcnZpY2UuY29uZmlndXJlRGV2aWNlKGhvbWVDcmVkZW50aWFscywgZGV2aWNlSWRMaXN0KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNvbmZpZ3VyYXRpb24gU3VjY2Vzc1wiKTtcbiAgICAgICAgICAgICAgICAgICAgbmV0d29ya1NlcnZpY2UucmVzdG9yZShob21lQ3JlZGVudGlhbHMsIGZ1bmN0aW9uIChlcnJvciwgY3JlZGVudGlhbHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmdvKFwiaG9tZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ29uZmlndXJhdGlvbiBGYWlsZWRcIik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS50b2dnbGVTd2l0Y2ggPSBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgICAgICAgICBkZXZpY2VTZXJ2aWNlLnRlc3RTd2l0Y2goaW5kZXgpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU3dpdGNoIGlzIHR1cm5lZCBcIiArICgocmVzcG9uc2UuZGF0YS5zdGF0ZSA9PT0gMSkgPyBcIm9uXCIgOiBcIm9mZlwiKSk7XG4gICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVW5hYmxlIHRvIGFjY2VzcyBzd2l0Y2hcIik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICBhbmd1bGFyLm1vZHVsZShcIm5ldHdvcmtcIiwgWyBcImNvbW1vblwiIF0pXG4gICAgICAgIC5jb25maWcoW1wiJHN0YXRlUHJvdmlkZXJcIiwgXCIkdXJsUm91dGVyUHJvdmlkZXJcIiwgXCJyZXNvbHZlXCIsIGZ1bmN0aW9uIChzdGF0ZVByb3ZpZGVyLCB1cmxSb3V0ZXJQcm92aWRlciwgcmVzb2x2ZSkge1xuICAgICAgICAgICAgdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKFwiL1wiKTtcbiAgICAgICAgICAgIHN0YXRlUHJvdmlkZXJcbiAgICAgICAgICAgICAgICAuc3RhdGUoXCJuZXR3b3JrXCIsIHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBcIi9uZXR3b3JrXCIsXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiBcIm5ldHdvcmsuaHRtbFwiLFxuICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBcIk5ldHdvcmtDdHJsXCIsXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwidGVybWluYWxzXCIgOiByZXNvbHZlLnRlcm1pbmFscyxcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZGV2aWNlXCIgOiByZXNvbHZlLmRldmljZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1dKVxuICAgICAgICAuY29udHJvbGxlcihcIk5ldHdvcmtDdHJsXCIsIFsgXCIkc2NvcGVcIiwgXCJEZXZpY2VTZXJ2aWNlXCIsIFwiQ29uZmlndXJhdGlvblNlcnZpY2VcIiwgXCIkdGltZW91dFwiLCBcIiRzdGF0ZVwiLCBcInNldHRpbmdzXCIsIGZ1bmN0aW9uIChzY29wZSwgZGV2aWNlU2VydmljZSwgY29uZmlndXJhdGlvblNlcnZpY2UsIHRpbWVvdXQsIHN0YXRlLCBzZXR0aW5ncykge1xuXG4gICAgICAgICAgICBzY29wZS5zY2FuTWVzc2FnZSA9IFwiU2Nhbm5pbmcuLi5cIjtcblxuICAgICAgICAgICAgc2NvcGUuY3JlZGVudGlhbHMgPSBjb25maWd1cmF0aW9uU2VydmljZS5nZXRDcmVkZW50aWFscygpO1xuXG4gICAgICAgICAgICB2YXIgbmV0d29ya1Bhc3N3b3JkRGlhbG9nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNuZXR3b3JrUGFzc3dvcmREaWFsb2dcIik7XG5cbiAgICAgICAgICAgIHNjb3BlLmNoYW5nZU5ldHdvcmsgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgc2NvcGUuc2Nhbk5ldHdvcmtzKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5zY2FuTmV0d29ya3MgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYoc2NvcGUudGltZW91dEluc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRpbWVvdXQuY2FuY2VsKHNjb3BlLnRpbWVvdXRJbnN0YW5jZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNjb3BlLnNjYW5NZXNzYWdlID0gXCJTY2FubmluZy4uLlwiO1xuICAgICAgICAgICAgICAgIHNjb3BlLnNjYW5uaW5nID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBkZXZpY2VTZXJ2aWNlLnNjYW5OZXR3b3JrcygpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnNjYW5uaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLm5ldHdvcmtzID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgaWYoc2NvcGUubmV0d29ya3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2Nhbk1lc3NhZ2UgPSBzY29wZS5uZXR3b3Jrcy5sZW5ndGggKyBcIiBOZXR3b3JrXCIgKyAoc2NvcGUubmV0d29ya3MubGVuZ3RoID4gMSA/IFwic1wiIDogXCJcIikgKyBcIiBGb3VuZFwiO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuc2Nhbk1lc3NhZ2UgPSBcIk5vIE5ldHdvcmtzIEZvdW5kXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAocmVqZWN0KSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnNjYW5NZXNzYWdlID0gXCJGYWlsZWQgdG8gc2NhbiBuZXR3b3Jrc1wiO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKHJlamVjdCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc2NvcGUudGltZW91dEluc3RhbmNlID0gdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnNjYW5OZXR3b3JrcygpO1xuICAgICAgICAgICAgICAgIH0sIHNldHRpbmdzLm5ldHdvcmtTY2FuSW50ZXJ2YWwpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2NvcGUuc2Nhbk5ldHdvcmtzKCk7XG5cbiAgICAgICAgICAgIHNjb3BlLm9wZW5OZXR3b3JrUGFzc3dvcmRNb2RhbCA9IGZ1bmN0aW9uIChuZXR3b3JrU1NJRCkge1xuICAgICAgICAgICAgICAgIHNjb3BlLnNlbGVjdGVkTmV0d29yayA9IG5ldHdvcmtTU0lEO1xuICAgICAgICAgICAgICAgIHNjb3BlLmNvbm5lY3RNZXNzYWdlID0gbnVsbDtcbiAgICAgICAgICAgICAgICBuZXR3b3JrUGFzc3dvcmREaWFsb2cuc2hvd01vZGFsKCk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS50ZXN0TmV0d29yayA9IGZ1bmN0aW9uIChwYXNzd29yZCkge1xuICAgICAgICAgICAgICAgIHZhciBjcmVkZW50aWFscyA9IHsgc3NpZCA6IHNjb3BlLnNlbGVjdGVkTmV0d29yaywgcGFzc3dvcmQgOiBwYXNzd29yZCB9O1xuICAgICAgICAgICAgICAgIGRldmljZVNlcnZpY2UudGVzdE5ldHdvcmsoY3JlZGVudGlhbHMpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmNvbm5lY3RNZXNzYWdlID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuY3JlZGVudGlhbHMgPSBjb25maWd1cmF0aW9uU2VydmljZS5zZXRDcmVkZW50aWFscyhjcmVkZW50aWFscyk7XG4gICAgICAgICAgICAgICAgICAgIHN0YXRlLmdvKFwibWFuYWdlXCIpO1xuICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChyZWplY3QpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuY29ubmVjdE1lc3NhZ2UgPSBcIlVuYWJsZSB0byBjb25uZWN0IHRvIG5ldHdvcmssIHZlcmlmeSBwYXNzd29yZFwiO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKHJlamVjdCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBzY29wZS5jbG9zZU5ldHdvcmtQYXNzd29yZERpYWxvZyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBzY29wZS5wYXNzd29yZCA9IFwiXCI7XG4gICAgICAgICAgICAgICAgc2NvcGUuY29ubmVjdE1lc3NhZ2UgPSBudWxsO1xuICAgICAgICAgICAgICAgIG5ldHdvcmtQYXNzd29yZERpYWxvZy5jbG9zZSgpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfV0pO1xufSkoKTtcbiJdfQ==
